<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Advanced &amp; Miscellaneous Topics | rxode2 user manual</title>
  <meta name="description" content="This book is the user manual for rxode2" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Advanced &amp; Miscellaneous Topics | rxode2 user manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book is the user manual for rxode2" />
  <meta name="github-repo" content="nlmixr2/rxode2-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Advanced &amp; Miscellaneous Topics | rxode2 user manual" />
  
  <meta name="twitter:description" content="This book is the user manual for rxode2" />
  

<meta name="author" content="Matthew Fidler, Melissa Hallow, Wenping Wang" />


<meta name="date" content="2023-08-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="examples.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.28/datatables.js"></script>
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i><b>2</b> Authors and Acknowledgments</a>
<ul>
<li class="chapter" data-level="2.1" data-path="author.html"><a href="author.html#authors"><i class="fa fa-check"></i><b>2.1</b> Authors</a></li>
<li class="chapter" data-level="2.2" data-path="author.html"><a href="author.html#contributors"><i class="fa fa-check"></i><b>2.2</b> Contributors</a></li>
<li class="chapter" data-level="2.3" data-path="author.html"><a href="author.html#rxode-acknowledgments"><i class="fa fa-check"></i><b>2.3</b> RxODE acknowledgments:</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="related.html"><a href="related.html"><i class="fa fa-check"></i><b>3</b> Related R packages</a>
<ul>
<li class="chapter" data-level="3.1" data-path="related.html"><a href="related.html#ode-solving"><i class="fa fa-check"></i><b>3.1</b> ODE solving</a></li>
<li class="chapter" data-level="3.2" data-path="related.html"><a href="related.html#pk-solved-systems"><i class="fa fa-check"></i><b>3.2</b> PK Solved systems</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="related.html"><a href="related.html#the-following-packages-for-solved-pk-systems-are-on-cran"><i class="fa fa-check"></i><b>3.2.1</b> The following packages for solved PK systems are on CRAN</a></li>
<li class="chapter" data-level="3.2.2" data-path="related.html"><a href="related.html#non-cran-libraries"><i class="fa fa-check"></i><b>3.2.2</b> Non-CRAN libraries:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>4</b> Installation</a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="install.html"><a href="install.html#windows"><i class="fa fa-check"></i><b>4.0.1</b> Windows</a></li>
<li class="chapter" data-level="4.0.2" data-path="install.html"><a href="install.html#mac-osx"><i class="fa fa-check"></i><b>4.0.2</b> Mac OSX</a></li>
<li class="chapter" data-level="4.0.3" data-path="install.html"><a href="install.html#linux"><i class="fa fa-check"></i><b>4.0.3</b> Linux</a></li>
<li class="chapter" data-level="4.0.4" data-path="install.html"><a href="install.html#r-versions-4.0-and-4.1"><i class="fa fa-check"></i><b>4.0.4</b> R versions 4.0 and 4.1</a></li>
<li class="chapter" data-level="4.1" data-path="install.html"><a href="install.html#development-version"><i class="fa fa-check"></i><b>4.1</b> Development version</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="gettingStarted.html"><a href="gettingStarted.html"><i class="fa fa-check"></i><b>5</b> Getting Started</a>
<ul>
<li class="chapter" data-level="5.1" data-path="gettingStarted.html"><a href="gettingStarted.html#specify-dosing-and-sampling-in-rxode2"><i class="fa fa-check"></i><b>5.1</b> Specify Dosing and sampling in rxode2</a></li>
<li class="chapter" data-level="5.2" data-path="gettingStarted.html"><a href="gettingStarted.html#solving-odes"><i class="fa fa-check"></i><b>5.2</b> Solving ODEs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="syntax.html"><a href="syntax.html"><i class="fa fa-check"></i><b>6</b> rxode2 syntax</a>
<ul>
<li class="chapter" data-level="6.1" data-path="syntax.html"><a href="syntax.html#example"><i class="fa fa-check"></i><b>6.1</b> Example</a></li>
<li class="chapter" data-level="6.2" data-path="syntax.html"><a href="syntax.html#syntax-1"><i class="fa fa-check"></i><b>6.2</b> Syntax</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="syntax.html"><a href="syntax.html#identifiers"><i class="fa fa-check"></i><b>6.2.1</b> Identifiers</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="syntax.html"><a href="syntax.html#logical-operators"><i class="fa fa-check"></i><b>6.3</b> Logical Operators</a></li>
<li class="chapter" data-level="6.4" data-path="syntax.html"><a href="syntax.html#supported-functions"><i class="fa fa-check"></i><b>6.4</b> Supported functions</a></li>
<li class="chapter" data-level="6.5" data-path="syntax.html"><a href="syntax.html#reserved-keywords"><i class="fa fa-check"></i><b>6.5</b> Reserved keywords</a></li>
<li class="chapter" data-level="6.6" data-path="syntax.html"><a href="syntax.html#residual-functions-when-using-rxode2-functions"><i class="fa fa-check"></i><b>6.6</b> Residual functions when using rxode2 functions</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="syntax.html"><a href="syntax.html#transformations"><i class="fa fa-check"></i><b>6.6.1</b> Transformations</a></li>
<li class="chapter" data-level="6.6.2" data-path="syntax.html"><a href="syntax.html#normal-and-t-related-distributions"><i class="fa fa-check"></i><b>6.6.2</b> Normal and t-related distributions</a></li>
<li class="chapter" data-level="6.6.3" data-path="syntax.html"><a href="syntax.html#notes-on-additive-proportional-models"><i class="fa fa-check"></i><b>6.6.3</b> Notes on additive + proportional models</a></li>
<li class="chapter" data-level="6.6.4" data-path="syntax.html"><a href="syntax.html#distributions-of-known-likelihoods"><i class="fa fa-check"></i><b>6.6.4</b> Distributions of known likelihoods</a></li>
<li class="chapter" data-level="6.6.5" data-path="syntax.html"><a href="syntax.html#ordinal-likelihoods"><i class="fa fa-check"></i><b>6.6.5</b> Ordinal likelihoods</a></li>
<li class="chapter" data-level="6.6.6" data-path="syntax.html"><a href="syntax.html#general-table-of-supported-residual-distributions"><i class="fa fa-check"></i><b>6.6.6</b> General table of supported residual distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="syntax.html"><a href="syntax.html#cmt-changing-compartment-numbers-for-states"><i class="fa fa-check"></i><b>6.7</b> cmt() changing compartment numbers for states</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="syntax.html"><a href="syntax.html#how-rxode2-numbers-compartments"><i class="fa fa-check"></i><b>6.7.1</b> How rxode2 numbers compartments</a></li>
<li class="chapter" data-level="6.7.2" data-path="syntax.html"><a href="syntax.html#changing-compartments-by-pre-declaring-with-cmt"><i class="fa fa-check"></i><b>6.7.2</b> Changing compartments by pre-declaring with <code>cmt()</code></a></li>
<li class="chapter" data-level="6.7.3" data-path="syntax.html"><a href="syntax.html#appending-compartments-to-the-model-with-cmt"><i class="fa fa-check"></i><b>6.7.3</b> Appending compartments to the model with <code>cmt()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="events.html"><a href="events.html"><i class="fa fa-check"></i><b>7</b> rxode2 events</a>
<ul>
<li class="chapter" data-level="7.1" data-path="events.html"><a href="events.html#rxode2-event-tables"><i class="fa fa-check"></i><b>7.1</b> rxode2 event tables</a></li>
<li class="chapter" data-level="7.2" data-path="events.html"><a href="events.html#bolusadditive-doses"><i class="fa fa-check"></i><b>7.2</b> Bolus/Additive Doses</a></li>
<li class="chapter" data-level="7.3" data-path="events.html"><a href="events.html#infusion-doses"><i class="fa fa-check"></i><b>7.3</b> Infusion Doses</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="events.html"><a href="events.html#constant-infusion-in-terms-of-duration-and-rate"><i class="fa fa-check"></i><b>7.3.1</b> Constant Infusion (in terms of duration and rate)</a></li>
<li class="chapter" data-level="7.3.2" data-path="events.html"><a href="events.html#modeled-rate-and-duration-of-infusion"><i class="fa fa-check"></i><b>7.3.2</b> Modeled Rate and Duration of Infusion</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="events.html"><a href="events.html#steady-state"><i class="fa fa-check"></i><b>7.4</b> Steady State</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="events.html"><a href="events.html#steady-state-for-complex-dosing"><i class="fa fa-check"></i><b>7.4.1</b> Steady state for complex dosing</a></li>
<li class="chapter" data-level="7.4.2" data-path="events.html"><a href="events.html#steady-state-for-constant-infusion-or-zero-order-processes"><i class="fa fa-check"></i><b>7.4.2</b> Steady state for constant infusion or zero order processes</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="events.html"><a href="events.html#reset-events"><i class="fa fa-check"></i><b>7.5</b> Reset Events</a></li>
<li class="chapter" data-level="7.6" data-path="events.html"><a href="events.html#turning-off-compartments"><i class="fa fa-check"></i><b>7.6</b> Turning off compartments</a></li>
<li class="chapter" data-level="7.7" data-path="events.html"><a href="events.html#classic-et"><i class="fa fa-check"></i><b>7.7</b> Classic rxode2 events</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="events.html"><a href="events.html#bolus-dose-examples"><i class="fa fa-check"></i><b>7.7.1</b> Bolus Dose Examples</a></li>
<li class="chapter" data-level="7.7.2" data-path="events.html"><a href="events.html#infusion-event-examples"><i class="fa fa-check"></i><b>7.7.2</b> Infusion Event Examples</a></li>
<li class="chapter" data-level="7.7.3" data-path="events.html"><a href="events.html#steady-state-for-classic-rxode-evid-example"><i class="fa fa-check"></i><b>7.7.3</b> Steady State for classic RxODE EVID example</a></li>
<li class="chapter" data-level="7.7.4" data-path="events.html"><a href="events.html#steady-state-with-lagged-dose-for-classic-rxode-evid"><i class="fa fa-check"></i><b>7.7.4</b> Steady state with lagged dose for classic RxODE evid</a></li>
<li class="chapter" data-level="7.7.5" data-path="events.html"><a href="events.html#turning-off-a-compartment-with-classic-rxode-evid"><i class="fa fa-check"></i><b>7.7.5</b> Turning off a compartment with classic RxODE EVID</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="events.html"><a href="events.html#datasets-for-rxode2-nlmixr"><i class="fa fa-check"></i><b>7.8</b> Datasets for rxode2 &amp; nlmixr</a></li>
<li class="chapter" data-level="7.9" data-path="events.html"><a href="events.html#columns-described-by-type-of-use"><i class="fa fa-check"></i><b>7.9</b> Columns Described by Type of Use</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="events.html"><a href="events.html#subject-identification-columns"><i class="fa fa-check"></i><b>7.9.1</b> Subject Identification Columns</a></li>
<li class="chapter" data-level="7.9.2" data-path="events.html"><a href="events.html#observation-columns"><i class="fa fa-check"></i><b>7.9.2</b> Observation Columns</a></li>
<li class="chapter" data-level="7.9.3" data-path="events.html"><a href="events.html#dosing-columns"><i class="fa fa-check"></i><b>7.9.3</b> Dosing Columns</a></li>
<li class="chapter" data-level="7.9.4" data-path="events.html"><a href="events.html#covariate-columns"><i class="fa fa-check"></i><b>7.9.4</b> Covariate Columns</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="events.html"><a href="events.html#details-for-specific-dataset-columns"><i class="fa fa-check"></i><b>7.10</b> Details for Specific Dataset Columns</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="events.html"><a href="events.html#amt-column"><i class="fa fa-check"></i><b>7.10.1</b> <code>AMT</code> Column</a></li>
<li class="chapter" data-level="7.10.2" data-path="events.html"><a href="events.html#censlimit-columns"><i class="fa fa-check"></i><b>7.10.2</b> <code>CENS</code>/<code>LIMIT</code> Columns</a></li>
<li class="chapter" data-level="7.10.3" data-path="events.html"><a href="events.html#cmt-column"><i class="fa fa-check"></i><b>7.10.3</b> <code>CMT</code> Column</a></li>
<li class="chapter" data-level="7.10.4" data-path="events.html"><a href="events.html#dur-column"><i class="fa fa-check"></i><b>7.10.4</b> <code>DUR</code> Column</a></li>
<li class="chapter" data-level="7.10.5" data-path="events.html"><a href="events.html#dv-column"><i class="fa fa-check"></i><b>7.10.5</b> <code>DV</code> Column</a></li>
<li class="chapter" data-level="7.10.6" data-path="events.html"><a href="events.html#dvid-column"><i class="fa fa-check"></i><b>7.10.6</b> <code>DVID</code> Column</a></li>
<li class="chapter" data-level="7.10.7" data-path="events.html"><a href="events.html#evid-column"><i class="fa fa-check"></i><b>7.10.7</b> <code>EVID</code> Column</a></li>
<li class="chapter" data-level="7.10.8" data-path="events.html"><a href="events.html#id-column"><i class="fa fa-check"></i><b>7.10.8</b> <code>ID</code> Column</a></li>
<li class="chapter" data-level="7.10.9" data-path="events.html"><a href="events.html#rate-column"><i class="fa fa-check"></i><b>7.10.9</b> <code>RATE</code> Column</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="et.html"><a href="et.html"><i class="fa fa-check"></i><b>8</b> Easily creating rxode2 events</a>
<ul>
<li class="chapter" data-level="8.1" data-path="et.html"><a href="et.html#adding-doses-to-the-event-table"><i class="fa fa-check"></i><b>8.1</b> Adding doses to the event table</a></li>
<li class="chapter" data-level="8.2" data-path="et.html"><a href="et.html#adding-sampling-to-an-event-table"><i class="fa fa-check"></i><b>8.2</b> Adding sampling to an event table</a></li>
<li class="chapter" data-level="8.3" data-path="et.html"><a href="et.html#expand-the-event-table-to-a-multi-subject-event-table."><i class="fa fa-check"></i><b>8.3</b> Expand the event table to a multi-subject event table.</a></li>
<li class="chapter" data-level="8.4" data-path="et.html"><a href="et.html#add-doses-and-samples-within-a-sampling-window"><i class="fa fa-check"></i><b>8.4</b> Add doses and samples within a sampling window</a></li>
<li class="chapter" data-level="8.5" data-path="et.html"><a href="et.html#combining-event-tables"><i class="fa fa-check"></i><b>8.5</b> Combining event tables</a></li>
<li class="chapter" data-level="8.6" data-path="et.html"><a href="et.html#sequencing-event-tables"><i class="fa fa-check"></i><b>8.6</b> Sequencing event tables</a></li>
<li class="chapter" data-level="8.7" data-path="et.html"><a href="et.html#repeating-event-tables"><i class="fa fa-check"></i><b>8.7</b> Repeating event tables</a></li>
<li class="chapter" data-level="8.8" data-path="et.html"><a href="et.html#combining-event-tables-with-rbind"><i class="fa fa-check"></i><b>8.8</b> Combining event tables with rbind</a></li>
<li class="chapter" data-level="8.9" data-path="et.html"><a href="et.html#event-tables-in-rstudio-notebooks"><i class="fa fa-check"></i><b>8.9</b> Event tables in Rstudio Notebooks</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="solve.html"><a href="solve.html"><i class="fa fa-check"></i><b>9</b> Solving and solving options</a>
<ul>
<li class="chapter" data-level="9.1" data-path="solve.html"><a href="solve.html#general-solving-options"><i class="fa fa-check"></i><b>9.1</b> General Solving Options</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="solve.html"><a href="solve.html#object"><i class="fa fa-check"></i><b>9.1.1</b> object</a></li>
<li class="chapter" data-level="9.1.2" data-path="solve.html"><a href="solve.html#params"><i class="fa fa-check"></i><b>9.1.2</b> params</a></li>
<li class="chapter" data-level="9.1.3" data-path="solve.html"><a href="solve.html#events-1"><i class="fa fa-check"></i><b>9.1.3</b> events</a></li>
<li class="chapter" data-level="9.1.4" data-path="solve.html"><a href="solve.html#inits"><i class="fa fa-check"></i><b>9.1.4</b> inits</a></li>
<li class="chapter" data-level="9.1.5" data-path="solve.html"><a href="solve.html#sigdig"><i class="fa fa-check"></i><b>9.1.5</b> sigdig</a></li>
<li class="chapter" data-level="9.1.6" data-path="solve.html"><a href="solve.html#atol"><i class="fa fa-check"></i><b>9.1.6</b> atol</a></li>
<li class="chapter" data-level="9.1.7" data-path="solve.html"><a href="solve.html#rtol"><i class="fa fa-check"></i><b>9.1.7</b> rtol</a></li>
<li class="chapter" data-level="9.1.8" data-path="solve.html"><a href="solve.html#atolsens"><i class="fa fa-check"></i><b>9.1.8</b> atolSens</a></li>
<li class="chapter" data-level="9.1.9" data-path="solve.html"><a href="solve.html#rtolsens"><i class="fa fa-check"></i><b>9.1.9</b> rtolSens</a></li>
<li class="chapter" data-level="9.1.10" data-path="solve.html"><a href="solve.html#maxsteps"><i class="fa fa-check"></i><b>9.1.10</b> maxsteps</a></li>
<li class="chapter" data-level="9.1.11" data-path="solve.html"><a href="solve.html#hmin"><i class="fa fa-check"></i><b>9.1.11</b> hmin</a></li>
<li class="chapter" data-level="9.1.12" data-path="solve.html"><a href="solve.html#hmax"><i class="fa fa-check"></i><b>9.1.12</b> hmax</a></li>
<li class="chapter" data-level="9.1.13" data-path="solve.html"><a href="solve.html#hmaxsd"><i class="fa fa-check"></i><b>9.1.13</b> hmaxSd</a></li>
<li class="chapter" data-level="9.1.14" data-path="solve.html"><a href="solve.html#hini"><i class="fa fa-check"></i><b>9.1.14</b> hini</a></li>
<li class="chapter" data-level="9.1.15" data-path="solve.html"><a href="solve.html#maxordn"><i class="fa fa-check"></i><b>9.1.15</b> maxordn</a></li>
<li class="chapter" data-level="9.1.16" data-path="solve.html"><a href="solve.html#maxords"><i class="fa fa-check"></i><b>9.1.16</b> maxords</a></li>
<li class="chapter" data-level="9.1.17" data-path="solve.html"><a href="solve.html#mxhnil"><i class="fa fa-check"></i><b>9.1.17</b> mxhnil</a></li>
<li class="chapter" data-level="9.1.18" data-path="solve.html"><a href="solve.html#hmxi"><i class="fa fa-check"></i><b>9.1.18</b> hmxi</a></li>
<li class="chapter" data-level="9.1.19" data-path="solve.html"><a href="solve.html#istatereset"><i class="fa fa-check"></i><b>9.1.19</b> istateReset</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="solve.html"><a href="solve.html#inductive-linerization-options"><i class="fa fa-check"></i><b>9.2</b> Inductive Linerization Options</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="solve.html"><a href="solve.html#indlinmatexptype"><i class="fa fa-check"></i><b>9.2.1</b> indLinMatExpType</a></li>
<li class="chapter" data-level="9.2.2" data-path="solve.html"><a href="solve.html#indlinmatexporder"><i class="fa fa-check"></i><b>9.2.2</b> indLinMatExpOrder</a></li>
<li class="chapter" data-level="9.2.3" data-path="solve.html"><a href="solve.html#indlinphitol"><i class="fa fa-check"></i><b>9.2.3</b> indLinPhiTol</a></li>
<li class="chapter" data-level="9.2.4" data-path="solve.html"><a href="solve.html#indlinphim"><i class="fa fa-check"></i><b>9.2.4</b> indLinPhiM</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="solve.html"><a href="solve.html#steady-state-solving-options"><i class="fa fa-check"></i><b>9.3</b> Steady State Solving Options</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="solve.html"><a href="solve.html#minss"><i class="fa fa-check"></i><b>9.3.1</b> minSS</a></li>
<li class="chapter" data-level="9.3.2" data-path="solve.html"><a href="solve.html#maxss"><i class="fa fa-check"></i><b>9.3.2</b> maxSS</a></li>
<li class="chapter" data-level="9.3.3" data-path="solve.html"><a href="solve.html#strictss"><i class="fa fa-check"></i><b>9.3.3</b> strictSS</a></li>
<li class="chapter" data-level="9.3.4" data-path="solve.html"><a href="solve.html#infssstep"><i class="fa fa-check"></i><b>9.3.4</b> infSSstep</a></li>
<li class="chapter" data-level="9.3.5" data-path="solve.html"><a href="solve.html#ssatol"><i class="fa fa-check"></i><b>9.3.5</b> ssAtol</a></li>
<li class="chapter" data-level="9.3.6" data-path="solve.html"><a href="solve.html#ssrtol"><i class="fa fa-check"></i><b>9.3.6</b> ssRtol</a></li>
<li class="chapter" data-level="9.3.7" data-path="solve.html"><a href="solve.html#ssatolsens"><i class="fa fa-check"></i><b>9.3.7</b> ssAtolSens</a></li>
<li class="chapter" data-level="9.3.8" data-path="solve.html"><a href="solve.html#ssrtolsens"><i class="fa fa-check"></i><b>9.3.8</b> ssRtolSens</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="solve.html"><a href="solve.html#rxode2-numeric-stability-options"><i class="fa fa-check"></i><b>9.4</b> rxode2 numeric stability options</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="solve.html"><a href="solve.html#maxatolrtolfactor"><i class="fa fa-check"></i><b>9.4.1</b> maxAtolRtolFactor</a></li>
<li class="chapter" data-level="9.4.2" data-path="solve.html"><a href="solve.html#statetrim"><i class="fa fa-check"></i><b>9.4.2</b> stateTrim</a></li>
<li class="chapter" data-level="9.4.3" data-path="solve.html"><a href="solve.html#safezero"><i class="fa fa-check"></i><b>9.4.3</b> safeZero</a></li>
<li class="chapter" data-level="9.4.4" data-path="solve.html"><a href="solve.html#sumtype"><i class="fa fa-check"></i><b>9.4.4</b> sumType</a></li>
<li class="chapter" data-level="9.4.5" data-path="solve.html"><a href="solve.html#prodtype"><i class="fa fa-check"></i><b>9.4.5</b> prodType</a></li>
<li class="chapter" data-level="9.4.6" data-path="solve.html"><a href="solve.html#maxwhile"><i class="fa fa-check"></i><b>9.4.6</b> maxwhile</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="solve.html"><a href="solve.html#linear-compartment-model-sensitivity-options"><i class="fa fa-check"></i><b>9.5</b> Linear compartment model sensitivity options</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="solve.html"><a href="solve.html#senstype"><i class="fa fa-check"></i><b>9.5.1</b> sensType</a></li>
<li class="chapter" data-level="9.5.2" data-path="solve.html"><a href="solve.html#lindiff"><i class="fa fa-check"></i><b>9.5.2</b> linDiff</a></li>
<li class="chapter" data-level="9.5.3" data-path="solve.html"><a href="solve.html#lindiffcentral"><i class="fa fa-check"></i><b>9.5.3</b> linDiffCentral</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="solve.html"><a href="solve.html#covariate-solving-options"><i class="fa fa-check"></i><b>9.6</b> Covariate Solving Options</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="solve.html"><a href="solve.html#icov"><i class="fa fa-check"></i><b>9.6.1</b> iCov</a></li>
<li class="chapter" data-level="9.6.2" data-path="solve.html"><a href="solve.html#covsinterpolation"><i class="fa fa-check"></i><b>9.6.2</b> covsInterpolation</a></li>
<li class="chapter" data-level="9.6.3" data-path="solve.html"><a href="solve.html#addcov"><i class="fa fa-check"></i><b>9.6.3</b> addCov</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="solve.html"><a href="solve.html#simulation-options"><i class="fa fa-check"></i><b>9.7</b> Simulation options</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="solve.html"><a href="solve.html#seed"><i class="fa fa-check"></i><b>9.7.1</b> seed</a></li>
<li class="chapter" data-level="9.7.2" data-path="solve.html"><a href="solve.html#nsim"><i class="fa fa-check"></i><b>9.7.2</b> nsim</a></li>
<li class="chapter" data-level="9.7.3" data-path="solve.html"><a href="solve.html#thetamat"><i class="fa fa-check"></i><b>9.7.3</b> thetaMat</a></li>
<li class="chapter" data-level="9.7.4" data-path="solve.html"><a href="solve.html#thetalower"><i class="fa fa-check"></i><b>9.7.4</b> thetaLower</a></li>
<li class="chapter" data-level="9.7.5" data-path="solve.html"><a href="solve.html#thetaupper"><i class="fa fa-check"></i><b>9.7.5</b> thetaUpper</a></li>
<li class="chapter" data-level="9.7.6" data-path="solve.html"><a href="solve.html#thetadf"><i class="fa fa-check"></i><b>9.7.6</b> thetaDf</a></li>
<li class="chapter" data-level="9.7.7" data-path="solve.html"><a href="solve.html#thetaischol"><i class="fa fa-check"></i><b>9.7.7</b> thetaIsChol</a></li>
<li class="chapter" data-level="9.7.8" data-path="solve.html"><a href="solve.html#nstud"><i class="fa fa-check"></i><b>9.7.8</b> nStud</a></li>
<li class="chapter" data-level="9.7.9" data-path="solve.html"><a href="solve.html#omega"><i class="fa fa-check"></i><b>9.7.9</b> omega</a></li>
<li class="chapter" data-level="9.7.10" data-path="solve.html"><a href="solve.html#omegaischol"><i class="fa fa-check"></i><b>9.7.10</b> omegaIsChol</a></li>
<li class="chapter" data-level="9.7.11" data-path="solve.html"><a href="solve.html#omegaseparation"><i class="fa fa-check"></i><b>9.7.11</b> omegaSeparation</a></li>
<li class="chapter" data-level="9.7.12" data-path="solve.html"><a href="solve.html#omegaxform"><i class="fa fa-check"></i><b>9.7.12</b> omegaXform</a></li>
<li class="chapter" data-level="9.7.13" data-path="solve.html"><a href="solve.html#omegalower"><i class="fa fa-check"></i><b>9.7.13</b> omegaLower</a></li>
<li class="chapter" data-level="9.7.14" data-path="solve.html"><a href="solve.html#omegaupper"><i class="fa fa-check"></i><b>9.7.14</b> omegaUpper</a></li>
<li class="chapter" data-level="9.7.15" data-path="solve.html"><a href="solve.html#omegadf"><i class="fa fa-check"></i><b>9.7.15</b> omegaDf</a></li>
<li class="chapter" data-level="9.7.16" data-path="solve.html"><a href="solve.html#nsub"><i class="fa fa-check"></i><b>9.7.16</b> nSub</a></li>
<li class="chapter" data-level="9.7.17" data-path="solve.html"><a href="solve.html#dfsub"><i class="fa fa-check"></i><b>9.7.17</b> dfSub</a></li>
<li class="chapter" data-level="9.7.18" data-path="solve.html"><a href="solve.html#sigma"><i class="fa fa-check"></i><b>9.7.18</b> sigma</a></li>
<li class="chapter" data-level="9.7.19" data-path="solve.html"><a href="solve.html#sigmalower"><i class="fa fa-check"></i><b>9.7.19</b> sigmaLower</a></li>
<li class="chapter" data-level="9.7.20" data-path="solve.html"><a href="solve.html#sigmaupper"><i class="fa fa-check"></i><b>9.7.20</b> sigmaUpper</a></li>
<li class="chapter" data-level="9.7.21" data-path="solve.html"><a href="solve.html#sigmaxform"><i class="fa fa-check"></i><b>9.7.21</b> sigmaXform</a></li>
<li class="chapter" data-level="9.7.22" data-path="solve.html"><a href="solve.html#sigmadf"><i class="fa fa-check"></i><b>9.7.22</b> sigmaDf</a></li>
<li class="chapter" data-level="9.7.23" data-path="solve.html"><a href="solve.html#sigmaischol"><i class="fa fa-check"></i><b>9.7.23</b> sigmaIsChol</a></li>
<li class="chapter" data-level="9.7.24" data-path="solve.html"><a href="solve.html#sigmaseparation"><i class="fa fa-check"></i><b>9.7.24</b> sigmaSeparation</a></li>
<li class="chapter" data-level="9.7.25" data-path="solve.html"><a href="solve.html#dfobs"><i class="fa fa-check"></i><b>9.7.25</b> dfObs</a></li>
<li class="chapter" data-level="9.7.26" data-path="solve.html"><a href="solve.html#resample"><i class="fa fa-check"></i><b>9.7.26</b> resample</a></li>
<li class="chapter" data-level="9.7.27" data-path="solve.html"><a href="solve.html#resampleid"><i class="fa fa-check"></i><b>9.7.27</b> resampleID</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="solve.html"><a href="solve.html#rxode2-output-options"><i class="fa fa-check"></i><b>9.8</b> rxode2 output options</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="solve.html"><a href="solve.html#returntype"><i class="fa fa-check"></i><b>9.8.1</b> returnType</a></li>
<li class="chapter" data-level="9.8.2" data-path="solve.html"><a href="solve.html#adddosing"><i class="fa fa-check"></i><b>9.8.2</b> addDosing</a></li>
<li class="chapter" data-level="9.8.3" data-path="solve.html"><a href="solve.html#keep"><i class="fa fa-check"></i><b>9.8.3</b> keep</a></li>
<li class="chapter" data-level="9.8.4" data-path="solve.html"><a href="solve.html#drop"><i class="fa fa-check"></i><b>9.8.4</b> drop</a></li>
<li class="chapter" data-level="9.8.5" data-path="solve.html"><a href="solve.html#idfactor"><i class="fa fa-check"></i><b>9.8.5</b> idFactor</a></li>
<li class="chapter" data-level="9.8.6" data-path="solve.html"><a href="solve.html#subsetnonmem"><i class="fa fa-check"></i><b>9.8.6</b> subsetNonmem</a></li>
<li class="chapter" data-level="9.8.7" data-path="solve.html"><a href="solve.html#scale"><i class="fa fa-check"></i><b>9.8.7</b> scale</a></li>
<li class="chapter" data-level="9.8.8" data-path="solve.html"><a href="solve.html#amountunits"><i class="fa fa-check"></i><b>9.8.8</b> amountUnits</a></li>
<li class="chapter" data-level="9.8.9" data-path="solve.html"><a href="solve.html#timeunits"><i class="fa fa-check"></i><b>9.8.9</b> timeUnits</a></li>
<li class="chapter" data-level="9.8.10" data-path="solve.html"><a href="solve.html#theta"><i class="fa fa-check"></i><b>9.8.10</b> theta</a></li>
<li class="chapter" data-level="9.8.11" data-path="solve.html"><a href="solve.html#eta"><i class="fa fa-check"></i><b>9.8.11</b> eta</a></li>
<li class="chapter" data-level="9.8.12" data-path="solve.html"><a href="solve.html#from"><i class="fa fa-check"></i><b>9.8.12</b> from</a></li>
<li class="chapter" data-level="9.8.13" data-path="solve.html"><a href="solve.html#to"><i class="fa fa-check"></i><b>9.8.13</b> to</a></li>
<li class="chapter" data-level="9.8.14" data-path="solve.html"><a href="solve.html#length.out"><i class="fa fa-check"></i><b>9.8.14</b> length.out</a></li>
<li class="chapter" data-level="9.8.15" data-path="solve.html"><a href="solve.html#by"><i class="fa fa-check"></i><b>9.8.15</b> by</a></li>
<li class="chapter" data-level="9.8.16" data-path="solve.html"><a href="solve.html#warnidsort"><i class="fa fa-check"></i><b>9.8.16</b> warnIdSort</a></li>
<li class="chapter" data-level="9.8.17" data-path="solve.html"><a href="solve.html#warndrop"><i class="fa fa-check"></i><b>9.8.17</b> warnDrop</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="solve.html"><a href="solve.html#internal-rxode2-options"><i class="fa fa-check"></i><b>9.9</b> Internal rxode2 options</a>
<ul>
<li class="chapter" data-level="9.9.1" data-path="solve.html"><a href="solve.html#ndisplayprogress"><i class="fa fa-check"></i><b>9.9.1</b> nDisplayProgress</a></li>
<li class="chapter" data-level="9.9.2" data-path="solve.html"><a href="solve.html#simvariability"><i class="fa fa-check"></i><b>9.9.2</b> simVariability</a></li>
<li class="chapter" data-level="9.9.3" data-path="solve.html"><a href="solve.html#section"><i class="fa fa-check"></i><b>9.9.3</b> …</a></li>
<li class="chapter" data-level="9.9.4" data-path="solve.html"><a href="solve.html#a"><i class="fa fa-check"></i><b>9.9.4</b> a</a></li>
<li class="chapter" data-level="9.9.5" data-path="solve.html"><a href="solve.html#b"><i class="fa fa-check"></i><b>9.9.5</b> b</a></li>
<li class="chapter" data-level="9.9.6" data-path="solve.html"><a href="solve.html#updateobject"><i class="fa fa-check"></i><b>9.9.6</b> updateObject</a></li>
</ul></li>
<li class="chapter" data-level="9.10" data-path="solve.html"><a href="solve.html#parallelthreaded-solve"><i class="fa fa-check"></i><b>9.10</b> Parallel/Threaded Solve</a>
<ul>
<li class="chapter" data-level="9.10.1" data-path="solve.html"><a href="solve.html#cores"><i class="fa fa-check"></i><b>9.10.1</b> cores</a></li>
<li class="chapter" data-level="9.10.2" data-path="solve.html"><a href="solve.html#ncoresrv"><i class="fa fa-check"></i><b>9.10.2</b> nCoresRV</a></li>
<li class="chapter" data-level="9.10.3" data-path="solve.html"><a href="solve.html#nllikalloc"><i class="fa fa-check"></i><b>9.10.3</b> nLlikAlloc</a></li>
<li class="chapter" data-level="9.10.4" data-path="solve.html"><a href="solve.html#usestdpow"><i class="fa fa-check"></i><b>9.10.4</b> useStdPow</a></li>
<li class="chapter" data-level="9.10.5" data-path="solve.html"><a href="solve.html#ss2cancelallpending"><i class="fa fa-check"></i><b>9.10.5</b> ss2cancelAllPending</a></li>
<li class="chapter" data-level="9.10.6" data-path="solve.html"><a href="solve.html#addlkeepscov"><i class="fa fa-check"></i><b>9.10.6</b> addlKeepsCov</a></li>
<li class="chapter" data-level="9.10.7" data-path="solve.html"><a href="solve.html#addldropss"><i class="fa fa-check"></i><b>9.10.7</b> addlDropSs</a></li>
<li class="chapter" data-level="9.10.8" data-path="solve.html"><a href="solve.html#ssatdosetime"><i class="fa fa-check"></i><b>9.10.8</b> ssAtDoseTime</a></li>
<li class="chapter" data-level="9.10.9" data-path="solve.html"><a href="solve.html#natimehandle"><i class="fa fa-check"></i><b>9.10.9</b> naTimeHandle</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="output.html"><a href="output.html"><i class="fa fa-check"></i><b>10</b> rxode2 output</a>
<ul>
<li class="chapter" data-level="10.1" data-path="output.html"><a href="output.html#using-rxode2-data-frames"><i class="fa fa-check"></i><b>10.1</b> Using rxode2 data frames</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="output.html"><a href="output.html#creating-an-interactive-data-frame"><i class="fa fa-check"></i><b>10.1.1</b> Creating an interactive data frame</a></li>
<li class="chapter" data-level="10.1.2" data-path="output.html"><a href="output.html#rxode2-solved-object-properties"><i class="fa fa-check"></i><b>10.1.2</b> rxode2 solved object properties</a></li>
<li class="chapter" data-level="10.1.3" data-path="output.html"><a href="output.html#using-the-solved-object-as-a-simple-data-frame"><i class="fa fa-check"></i><b>10.1.3</b> Using the solved object as a simple data frame</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="output.html"><a href="output.html#updating-the-data-set-interactively"><i class="fa fa-check"></i><b>10.2</b> Updating the data-set interactively</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="output.html"><a href="output.html#modifying-observation-times-for-rxode2"><i class="fa fa-check"></i><b>10.2.1</b> Modifying observation times for rxode2</a></li>
<li class="chapter" data-level="10.2.2" data-path="output.html"><a href="output.html#modifying-simulation-parameters"><i class="fa fa-check"></i><b>10.2.2</b> Modifying simulation parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>11</b> Simulation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="simulation.html"><a href="simulation.html#single-subject-solving"><i class="fa fa-check"></i><b>11.1</b> Single Subject solving</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="simulation.html"><a href="simulation.html#summary-of-single-solve-vs-multiple-subject-solving"><i class="fa fa-check"></i><b>11.1.1</b> Summary of Single solve vs Multiple subject solving</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="simulation.html"><a href="simulation.html#population-simulations-with-rxode2"><i class="fa fa-check"></i><b>11.2</b> Population Simulations with rxode2</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="simulation.html"><a href="simulation.html#simulation-of-variability-with-rxode2"><i class="fa fa-check"></i><b>11.2.1</b> Simulation of Variability with rxode2</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="simulation.html"><a href="simulation.html#simulation-of-clinical-trials"><i class="fa fa-check"></i><b>11.3</b> Simulation of Clinical Trials</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="simulation.html"><a href="simulation.html#simulation-from-inverse-wishart-correlations"><i class="fa fa-check"></i><b>11.3.1</b> Simulation from inverse Wishart correlations</a></li>
<li class="chapter" data-level="11.3.2" data-path="simulation.html"><a href="simulation.html#simulate-using-variancestandard-deviation-standard-errors"><i class="fa fa-check"></i><b>11.3.2</b> Simulate using variance/standard deviation standard errors</a></li>
<li class="chapter" data-level="11.3.3" data-path="simulation.html"><a href="simulation.html#simulate-without-uncertainty-in-omega-or-sigma-parameters"><i class="fa fa-check"></i><b>11.3.3</b> Simulate without uncertainty in <code>omega</code> or <code>sigma</code> parameters</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="simulation.html"><a href="simulation.html#using-prior-data-for-solving"><i class="fa fa-check"></i><b>11.4</b> Using prior data for solving</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>12</b> Examples</a>
<ul>
<li class="chapter" data-level="12.1" data-path="examples.html"><a href="examples.html#prediction-only-models"><i class="fa fa-check"></i><b>12.1</b> Prediction only models</a></li>
<li class="chapter" data-level="12.2" data-path="examples.html"><a href="examples.html#solved-compartment-models"><i class="fa fa-check"></i><b>12.2</b> Solved compartment models</a></li>
<li class="chapter" data-level="12.3" data-path="examples.html"><a href="examples.html#mixing-solved-systems-and-odes"><i class="fa fa-check"></i><b>12.3</b> Mixing Solved Systems and ODEs</a></li>
<li class="chapter" data-level="12.4" data-path="examples.html"><a href="examples.html#weight-based-dosing"><i class="fa fa-check"></i><b>12.4</b> Weight based dosing</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="examples.html"><a href="examples.html#creating-a-2-compartment-model-in-rxode2"><i class="fa fa-check"></i><b>12.4.1</b> Creating a 2-compartment model in rxode2</a></li>
<li class="chapter" data-level="12.4.2" data-path="examples.html"><a href="examples.html#simulating-covariates"><i class="fa fa-check"></i><b>12.4.2</b> Simulating Covariates</a></li>
<li class="chapter" data-level="12.4.3" data-path="examples.html"><a href="examples.html#creating-weight-based-event-table"><i class="fa fa-check"></i><b>12.4.3</b> Creating weight based event table</a></li>
<li class="chapter" data-level="12.4.4" data-path="examples.html"><a href="examples.html#solving-daptomycin-simulation"><i class="fa fa-check"></i><b>12.4.4</b> Solving Daptomycin simulation</a></li>
<li class="chapter" data-level="12.4.5" data-path="examples.html"><a href="examples.html#daptomycin-reference"><i class="fa fa-check"></i><b>12.4.5</b> Daptomycin Reference</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="examples.html"><a href="examples.html#inter-occasion-and-other-nesting-examples"><i class="fa fa-check"></i><b>12.5</b> Inter-occasion and other nesting examples</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="examples.html"><a href="examples.html#event-table"><i class="fa fa-check"></i><b>12.5.1</b> Event table</a></li>
<li class="chapter" data-level="12.5.2" data-path="examples.html"><a href="examples.html#rxode2-model"><i class="fa fa-check"></i><b>12.5.2</b> rxode2 model</a></li>
<li class="chapter" data-level="12.5.3" data-path="examples.html"><a href="examples.html#uncertainty-in-model-parameters"><i class="fa fa-check"></i><b>12.5.3</b> Uncertainty in Model parameters</a></li>
<li class="chapter" data-level="12.5.4" data-path="examples.html"><a href="examples.html#nesting-variability"><i class="fa fa-check"></i><b>12.5.4</b> Nesting Variability</a></li>
<li class="chapter" data-level="12.5.5" data-path="examples.html"><a href="examples.html#unexplained-variability"><i class="fa fa-check"></i><b>12.5.5</b> Unexplained variability</a></li>
<li class="chapter" data-level="12.5.6" data-path="examples.html"><a href="examples.html#solving-the-problem"><i class="fa fa-check"></i><b>12.5.6</b> Solving the problem</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="examples.html"><a href="examples.html#transit-compartment-models"><i class="fa fa-check"></i><b>12.6</b> Transit compartment models</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html"><i class="fa fa-check"></i><b>13</b> Advanced &amp; Miscellaneous Topics</a>
<ul>
<li class="chapter" data-level="13.1" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#covariates-in-rxode2"><i class="fa fa-check"></i><b>13.1</b> Covariates in rxode2</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#individual-covariates"><i class="fa fa-check"></i><b>13.1.1</b> Individual Covariates</a></li>
<li class="chapter" data-level="13.1.2" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#time-varying-covariates"><i class="fa fa-check"></i><b>13.1.2</b> Time Varying Covariates</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#shiny-and-rxode2"><i class="fa fa-check"></i><b>13.2</b> Shiny and rxode2</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#facilities-for-generating-r-shiny-applications"><i class="fa fa-check"></i><b>13.2.1</b> Facilities for generating R shiny applications</a></li>
<li class="chapter" data-level="13.2.2" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#exploring-parameter-fits-graphically-using-shiny"><i class="fa fa-check"></i><b>13.2.2</b> Exploring parameter fits graphically using shiny</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#using-rxode2-with-a-pipeline"><i class="fa fa-check"></i><b>13.3</b> Using rxode2 with a pipeline</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#setting-up-the-rxode2-model-for-the-pipeline"><i class="fa fa-check"></i><b>13.3.1</b> Setting up the rxode2 model for the pipeline</a></li>
<li class="chapter" data-level="13.3.2" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#simulating-one-event-table"><i class="fa fa-check"></i><b>13.3.2</b> Simulating one event table</a></li>
<li class="chapter" data-level="13.3.3" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#simulating-multiple-subjects-from-a-single-event-table"><i class="fa fa-check"></i><b>13.3.3</b> Simulating multiple subjects from a single event table</a></li>
<li class="chapter" data-level="13.3.4" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#summarizing-the-simulation-output"><i class="fa fa-check"></i><b>13.3.4</b> Summarizing the simulation output</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#speeding-up-rxode2"><i class="fa fa-check"></i><b>13.4</b> Speeding up rxode2</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#a-note-about-the-speed-of-the-functional-form-for-rxode2"><i class="fa fa-check"></i><b>13.4.1</b> A note about the speed of the functional form for rxode2</a></li>
<li class="chapter" data-level="13.4.2" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#increasing-rxode2-speed-by-multi-subject-parallel-solving"><i class="fa fa-check"></i><b>13.4.2</b> Increasing rxode2 speed by multi-subject parallel solving</a></li>
<li class="chapter" data-level="13.4.3" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#a-real-life-example"><i class="fa fa-check"></i><b>13.4.3</b> A real life example</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#integrating-rxode2-models-in-your-package"><i class="fa fa-check"></i><b>13.5</b> Integrating rxode2 models in your package</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#using-pre-compiled-models-in-your-packages"><i class="fa fa-check"></i><b>13.5.1</b> Using Pre-compiled models in your packages</a></li>
<li class="chapter" data-level="13.5.2" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#using-models-in-a-already-present-package"><i class="fa fa-check"></i><b>13.5.2</b> Using Models in a already present package</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="advanced-miscellaneous-topics.html"><a href="advanced-miscellaneous-topics.html#stiff-odes-with-jacobian-specification"><i class="fa fa-check"></i><b>13.6</b> Stiff ODEs with Jacobian Specification</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">rxode2 user manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-miscellaneous-topics" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">Chapter 13</span> Advanced &amp; Miscellaneous Topics<a href="advanced-miscellaneous-topics.html#advanced-miscellaneous-topics" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This covers advanced or miscellaneous topics in <code>rxode2</code></p>
<div id="covariates-in-rxode2" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Covariates in rxode2<a href="advanced-miscellaneous-topics.html#covariates-in-rxode2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="individual-covariates" class="section level3 hasAnchor" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Individual Covariates<a href="advanced-miscellaneous-topics.html#individual-covariates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If there is an individual covariate you wish to solve for you may specify it by the <code>iCov</code> dataset:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="advanced-miscellaneous-topics.html#cb289-1" aria-hidden="true"></a><span class="kw">library</span>(rxode2)</span>
<span id="cb289-2"><a href="advanced-miscellaneous-topics.html#cb289-2" aria-hidden="true"></a></span>
<span id="cb289-3"><a href="advanced-miscellaneous-topics.html#cb289-3" aria-hidden="true"></a><span class="kw">library</span>(units)</span>
<span id="cb289-4"><a href="advanced-miscellaneous-topics.html#cb289-4" aria-hidden="true"></a><span class="kw">library</span>(xgxr)</span>
<span id="cb289-5"><a href="advanced-miscellaneous-topics.html#cb289-5" aria-hidden="true"></a></span>
<span id="cb289-6"><a href="advanced-miscellaneous-topics.html#cb289-6" aria-hidden="true"></a>mod3 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb289-7"><a href="advanced-miscellaneous-topics.html#cb289-7" aria-hidden="true"></a>  <span class="kw">ini</span>({</span>
<span id="cb289-8"><a href="advanced-miscellaneous-topics.html#cb289-8" aria-hidden="true"></a>    TKA   &lt;-<span class="st"> </span><span class="fl">2.94E-01</span></span>
<span id="cb289-9"><a href="advanced-miscellaneous-topics.html#cb289-9" aria-hidden="true"></a><span class="co">#### Clearance with individuals</span></span>
<span id="cb289-10"><a href="advanced-miscellaneous-topics.html#cb289-10" aria-hidden="true"></a>    TCL   &lt;-<span class="st"> </span><span class="fl">1.86E+01</span> </span>
<span id="cb289-11"><a href="advanced-miscellaneous-topics.html#cb289-11" aria-hidden="true"></a>    TV2   &lt;-<span class="fl">4.02E+01</span></span>
<span id="cb289-12"><a href="advanced-miscellaneous-topics.html#cb289-12" aria-hidden="true"></a>    TQ    &lt;-<span class="fl">1.05E+01</span></span>
<span id="cb289-13"><a href="advanced-miscellaneous-topics.html#cb289-13" aria-hidden="true"></a>    TV3   &lt;-<span class="fl">2.97E+02</span></span>
<span id="cb289-14"><a href="advanced-miscellaneous-topics.html#cb289-14" aria-hidden="true"></a>    TKin  &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb289-15"><a href="advanced-miscellaneous-topics.html#cb289-15" aria-hidden="true"></a>    TKout &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb289-16"><a href="advanced-miscellaneous-topics.html#cb289-16" aria-hidden="true"></a>    TEC50 &lt;-<span class="dv">200</span></span>
<span id="cb289-17"><a href="advanced-miscellaneous-topics.html#cb289-17" aria-hidden="true"></a>  })</span>
<span id="cb289-18"><a href="advanced-miscellaneous-topics.html#cb289-18" aria-hidden="true"></a>  <span class="kw">model</span>({</span>
<span id="cb289-19"><a href="advanced-miscellaneous-topics.html#cb289-19" aria-hidden="true"></a>    KA            &lt;-<span class="st"> </span>TKA</span>
<span id="cb289-20"><a href="advanced-miscellaneous-topics.html#cb289-20" aria-hidden="true"></a>    CL            &lt;-<span class="st"> </span>TCL <span class="op">*</span><span class="st"> </span>(WT <span class="op">/</span><span class="st"> </span><span class="dv">70</span>) <span class="op">^</span><span class="st"> </span><span class="fl">0.75</span></span>
<span id="cb289-21"><a href="advanced-miscellaneous-topics.html#cb289-21" aria-hidden="true"></a>    V2            &lt;-<span class="st"> </span>TV2</span>
<span id="cb289-22"><a href="advanced-miscellaneous-topics.html#cb289-22" aria-hidden="true"></a>    Q             &lt;-<span class="st"> </span>TQ</span>
<span id="cb289-23"><a href="advanced-miscellaneous-topics.html#cb289-23" aria-hidden="true"></a>    V3            &lt;-<span class="st"> </span>TV3</span>
<span id="cb289-24"><a href="advanced-miscellaneous-topics.html#cb289-24" aria-hidden="true"></a>    Kin           &lt;-<span class="st"> </span>TKin</span>
<span id="cb289-25"><a href="advanced-miscellaneous-topics.html#cb289-25" aria-hidden="true"></a>    Kout          &lt;-<span class="st"> </span>TKout</span>
<span id="cb289-26"><a href="advanced-miscellaneous-topics.html#cb289-26" aria-hidden="true"></a>    EC50          &lt;-<span class="st"> </span>TEC50</span>
<span id="cb289-27"><a href="advanced-miscellaneous-topics.html#cb289-27" aria-hidden="true"></a>    Tz            &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb289-28"><a href="advanced-miscellaneous-topics.html#cb289-28" aria-hidden="true"></a>    amp           &lt;-<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb289-29"><a href="advanced-miscellaneous-topics.html#cb289-29" aria-hidden="true"></a>    C2            &lt;-<span class="st"> </span>central<span class="op">/</span>V2</span>
<span id="cb289-30"><a href="advanced-miscellaneous-topics.html#cb289-30" aria-hidden="true"></a>    C3            &lt;-<span class="st"> </span>peri<span class="op">/</span>V3</span>
<span id="cb289-31"><a href="advanced-miscellaneous-topics.html#cb289-31" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(depot)   &lt;-<span class="st"> </span><span class="op">-</span>KA<span class="op">*</span>depot</span>
<span id="cb289-32"><a href="advanced-miscellaneous-topics.html#cb289-32" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(central) &lt;-<span class="st"> </span>KA<span class="op">*</span>depot <span class="op">-</span><span class="st"> </span>CL<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">+</span><span class="st"> </span>Q<span class="op">*</span>C3</span>
<span id="cb289-33"><a href="advanced-miscellaneous-topics.html#cb289-33" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(peri)    &lt;-<span class="st">                    </span>Q<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C3</span>
<span id="cb289-34"><a href="advanced-miscellaneous-topics.html#cb289-34" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(eff)     &lt;-<span class="st">  </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff</span>
<span id="cb289-35"><a href="advanced-miscellaneous-topics.html#cb289-35" aria-hidden="true"></a>    <span class="kw">eff</span>(<span class="dv">0</span>)        &lt;-<span class="st"> </span><span class="dv">1</span>  <span class="co">## This specifies that the effect compartment starts at 1.</span></span>
<span id="cb289-36"><a href="advanced-miscellaneous-topics.html#cb289-36" aria-hidden="true"></a>  })</span>
<span id="cb289-37"><a href="advanced-miscellaneous-topics.html#cb289-37" aria-hidden="true"></a>}</span>
<span id="cb289-38"><a href="advanced-miscellaneous-topics.html#cb289-38" aria-hidden="true"></a></span>
<span id="cb289-39"><a href="advanced-miscellaneous-topics.html#cb289-39" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">amount.units=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">time.units=</span><span class="st">&quot;hours&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb289-40"><a href="advanced-miscellaneous-topics.html#cb289-40" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">cmt=</span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb289-41"><a href="advanced-miscellaneous-topics.html#cb289-41" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb289-42"><a href="advanced-miscellaneous-topics.html#cb289-42" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb289-43"><a href="advanced-miscellaneous-topics.html#cb289-43" aria-hidden="true"></a></span>
<span id="cb289-44"><a href="advanced-miscellaneous-topics.html#cb289-44" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb289-45"><a href="advanced-miscellaneous-topics.html#cb289-45" aria-hidden="true"></a><span class="kw">rxSetSeed</span>(<span class="dv">10</span>)</span>
<span id="cb289-46"><a href="advanced-miscellaneous-topics.html#cb289-46" aria-hidden="true"></a><span class="co">#### Now use iCov to simulate a 4-id sample</span></span>
<span id="cb289-47"><a href="advanced-miscellaneous-topics.html#cb289-47" aria-hidden="true"></a>r1 &lt;-<span class="st"> </span><span class="kw">solve</span>(mod3, ev,</span>
<span id="cb289-48"><a href="advanced-miscellaneous-topics.html#cb289-48" aria-hidden="true"></a><span class="co">### Create individual covariate data-frame</span></span>
<span id="cb289-49"><a href="advanced-miscellaneous-topics.html#cb289-49" aria-hidden="true"></a>            <span class="dt">iCov=</span><span class="kw">data.frame</span>(<span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">WT=</span><span class="kw">rnorm</span>(<span class="dv">4</span>, <span class="dv">70</span>, <span class="dv">10</span>)))</span></code></pre></div>
<pre><code>#&gt; using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="advanced-miscellaneous-topics.html#cb291-1" aria-hidden="true"></a><span class="kw">print</span>(r1)</span></code></pre></div>
<pre><code>#&gt; -- Solved rxode2 object --
#&gt; -- Parameters ($params): --
#&gt;     TKA     TCL     TV2      TQ     TV3    TKin   TKout   TEC50      Tz     amp 
#&gt;   0.294  18.600  40.200  10.500 297.000   1.000   1.000 200.000   8.000   0.100 
#&gt; -- Initial Conditions ($inits): --
#&gt;   depot central    peri     eff 
#&gt;       0       0       0       1 
#&gt; -- First part of data (object): --
#&gt; # A tibble: 400 x 17
#&gt;      id  time    KA    CL    V2     Q    V3   Kin  Kout  EC50    C2    C3  depot
#&gt;   &lt;int&gt;   [h] &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1     1 0     0.294  18.6  40.2  10.5   297     1     1   200   0   0     10000 
#&gt; 2     1 0.485 0.294  18.6  40.2  10.5   297     1     1   200  27.8 0.257  8671.
#&gt; 3     1 0.970 0.294  18.6  40.2  10.5   297     1     1   200  43.7 0.873  7519.
#&gt; 4     1 1.45  0.294  18.6  40.2  10.5   297     1     1   200  51.7 1.68   6520.
#&gt; 5     1 1.94  0.294  18.6  40.2  10.5   297     1     1   200  54.7 2.56   5654.
#&gt; 6     1 2.42  0.294  18.6  40.2  10.5   297     1     1   200  54.5 3.45   4903.
#&gt; # i 394 more rows
#&gt; # i 4 more variables: central &lt;dbl&gt;, peri &lt;dbl&gt;, eff &lt;dbl&gt;, WT &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="advanced-miscellaneous-topics.html#cb293-1" aria-hidden="true"></a><span class="kw">plot</span>(r1, C2, <span class="dt">log=</span><span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<pre><code>#&gt; Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<p><img src="rxode2-manual_files/figure-html/individual-covariates-1.png" width="672" /></p>
</div>
<div id="time-varying-covariates" class="section level3 hasAnchor" number="13.1.2">
<h3><span class="header-section-number">13.1.2</span> Time Varying Covariates<a href="advanced-miscellaneous-topics.html#time-varying-covariates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Covariates are easy to specify in rxode2, you can specify them as a
variable. Time-varying covariates, like clock time in a circadian
rhythm model, can also be used. Extending the indirect response model
already discussed, we have:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="advanced-miscellaneous-topics.html#cb295-1" aria-hidden="true"></a><span class="kw">library</span>(rxode2)</span>
<span id="cb295-2"><a href="advanced-miscellaneous-topics.html#cb295-2" aria-hidden="true"></a><span class="kw">library</span>(units)</span>
<span id="cb295-3"><a href="advanced-miscellaneous-topics.html#cb295-3" aria-hidden="true"></a></span>
<span id="cb295-4"><a href="advanced-miscellaneous-topics.html#cb295-4" aria-hidden="true"></a>mod4 &lt;-<span class="st"> </span>mod3 <span class="op">%&gt;%</span></span>
<span id="cb295-5"><a href="advanced-miscellaneous-topics.html#cb295-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">model</span>(d<span class="op">/</span><span class="kw">dt</span>(eff) &lt;-<span class="st">  </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff) <span class="op">%&gt;%</span></span>
<span id="cb295-6"><a href="advanced-miscellaneous-topics.html#cb295-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">model</span>(<span class="op">-</span>Kin) <span class="op">%&gt;%</span></span>
<span id="cb295-7"><a href="advanced-miscellaneous-topics.html#cb295-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">model</span>(Kin &lt;-<span class="st"> </span>TKin <span class="op">+</span><span class="st"> </span>amp <span class="op">*</span><span class="kw">cos</span>(<span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>(ctime<span class="op">-</span>Tz)<span class="op">/</span><span class="dv">24</span>), <span class="dt">append=</span>C2, <span class="dt">cov=</span><span class="st">&quot;ctime&quot;</span>)</span>
<span id="cb295-8"><a href="advanced-miscellaneous-topics.html#cb295-8" aria-hidden="true"></a> </span>
<span id="cb295-9"><a href="advanced-miscellaneous-topics.html#cb295-9" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">amountUnits=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">timeUnits=</span><span class="st">&quot;hours&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb295-10"><a href="advanced-miscellaneous-topics.html#cb295-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">cmt=</span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb295-11"><a href="advanced-miscellaneous-topics.html#cb295-11" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">100</span>)</span>
<span id="cb295-12"><a href="advanced-miscellaneous-topics.html#cb295-12" aria-hidden="true"></a></span>
<span id="cb295-13"><a href="advanced-miscellaneous-topics.html#cb295-13" aria-hidden="true"></a></span>
<span id="cb295-14"><a href="advanced-miscellaneous-topics.html#cb295-14" aria-hidden="true"></a><span class="co">#### Create data frame of 8 am dosing for the first dose This is done</span></span>
<span id="cb295-15"><a href="advanced-miscellaneous-topics.html#cb295-15" aria-hidden="true"></a><span class="co">#### with base R but it can be done with dplyr or data.table</span></span>
<span id="cb295-16"><a href="advanced-miscellaneous-topics.html#cb295-16" aria-hidden="true"></a>ev<span class="op">$</span>ctime &lt;-<span class="st"> </span>(ev<span class="op">$</span>time<span class="op">+</span><span class="kw">set_units</span>(<span class="dv">8</span>,hr)) <span class="op">%%</span><span class="st"> </span><span class="dv">24</span></span>
<span id="cb295-17"><a href="advanced-miscellaneous-topics.html#cb295-17" aria-hidden="true"></a>ev<span class="op">$</span>WT &lt;-<span class="st"> </span><span class="dv">70</span></span></code></pre></div>
<p>Now there is a covariate present in the event dataset, the system can
be solved by combining the dataset and the model:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="advanced-miscellaneous-topics.html#cb296-1" aria-hidden="true"></a>r1 &lt;-<span class="st"> </span><span class="kw">solve</span>(mod4, ev, <span class="dt">covsInterpolation=</span><span class="st">&quot;linear&quot;</span>)</span>
<span id="cb296-2"><a href="advanced-miscellaneous-topics.html#cb296-2" aria-hidden="true"></a><span class="kw">print</span>(r1)</span>
<span id="cb296-3"><a href="advanced-miscellaneous-topics.html#cb296-3" aria-hidden="true"></a><span class="co">#&gt; -- Solved rxode2 object --</span></span>
<span id="cb296-4"><a href="advanced-miscellaneous-topics.html#cb296-4" aria-hidden="true"></a><span class="co">#&gt; -- Parameters ($params): --</span></span>
<span id="cb296-5"><a href="advanced-miscellaneous-topics.html#cb296-5" aria-hidden="true"></a><span class="co">#&gt;        TKA        TCL        TV2         TQ        TV3      TKout      TEC50 </span></span>
<span id="cb296-6"><a href="advanced-miscellaneous-topics.html#cb296-6" aria-hidden="true"></a><span class="co">#&gt;   0.294000  18.600000  40.200000  10.500000 297.000000   1.000000 200.000000 </span></span>
<span id="cb296-7"><a href="advanced-miscellaneous-topics.html#cb296-7" aria-hidden="true"></a><span class="co">#&gt;       TKin         Tz        amp         pi </span></span>
<span id="cb296-8"><a href="advanced-miscellaneous-topics.html#cb296-8" aria-hidden="true"></a><span class="co">#&gt;   1.000000   8.000000   0.100000   3.141593 </span></span>
<span id="cb296-9"><a href="advanced-miscellaneous-topics.html#cb296-9" aria-hidden="true"></a><span class="co">#&gt; -- Initial Conditions ($inits): --</span></span>
<span id="cb296-10"><a href="advanced-miscellaneous-topics.html#cb296-10" aria-hidden="true"></a><span class="co">#&gt;   depot central    peri     eff </span></span>
<span id="cb296-11"><a href="advanced-miscellaneous-topics.html#cb296-11" aria-hidden="true"></a><span class="co">#&gt;       0       0       0       1 </span></span>
<span id="cb296-12"><a href="advanced-miscellaneous-topics.html#cb296-12" aria-hidden="true"></a><span class="co">#&gt; -- First part of data (object): --</span></span>
<span id="cb296-13"><a href="advanced-miscellaneous-topics.html#cb296-13" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 100 x 17</span></span>
<span id="cb296-14"><a href="advanced-miscellaneous-topics.html#cb296-14" aria-hidden="true"></a><span class="co">#&gt;    time    KA    CL    V2     Q    V3  Kout  EC50    C2   Kin    C3  depot</span></span>
<span id="cb296-15"><a href="advanced-miscellaneous-topics.html#cb296-15" aria-hidden="true"></a><span class="co">#&gt;     [h] &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb296-16"><a href="advanced-miscellaneous-topics.html#cb296-16" aria-hidden="true"></a><span class="co">#&gt; 1 0     0.294  18.6  40.2  10.5   297     1   200   0    1.1  0     10000 </span></span>
<span id="cb296-17"><a href="advanced-miscellaneous-topics.html#cb296-17" aria-hidden="true"></a><span class="co">#&gt; 2 0.485 0.294  18.6  40.2  10.5   297     1   200  27.8  1.10 0.257  8671.</span></span>
<span id="cb296-18"><a href="advanced-miscellaneous-topics.html#cb296-18" aria-hidden="true"></a><span class="co">#&gt; 3 0.970 0.294  18.6  40.2  10.5   297     1   200  43.7  1.10 0.874  7519.</span></span>
<span id="cb296-19"><a href="advanced-miscellaneous-topics.html#cb296-19" aria-hidden="true"></a><span class="co">#&gt; 4 1.45  0.294  18.6  40.2  10.5   297     1   200  51.8  1.09 1.68   6520.</span></span>
<span id="cb296-20"><a href="advanced-miscellaneous-topics.html#cb296-20" aria-hidden="true"></a><span class="co">#&gt; 5 1.94  0.294  18.6  40.2  10.5   297     1   200  54.8  1.09 2.56   5654.</span></span>
<span id="cb296-21"><a href="advanced-miscellaneous-topics.html#cb296-21" aria-hidden="true"></a><span class="co">#&gt; 6 2.42  0.294  18.6  40.2  10.5   297     1   200  54.6  1.08 3.45   4903.</span></span>
<span id="cb296-22"><a href="advanced-miscellaneous-topics.html#cb296-22" aria-hidden="true"></a><span class="co">#&gt; # i 94 more rows</span></span>
<span id="cb296-23"><a href="advanced-miscellaneous-topics.html#cb296-23" aria-hidden="true"></a><span class="co">#&gt; # i 5 more variables: central &lt;dbl&gt;, peri &lt;dbl&gt;, eff &lt;dbl&gt;, ctime [h], WT &lt;dbl&gt;</span></span></code></pre></div>
<p>When solving ODE equations, the solver may sample times outside of the
data. When this happens, this ODE solver can use linear interpolation
between the covariate values. It is equivalent to R’s <code>approxfun</code> with
<code>method="linear"</code>.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="advanced-miscellaneous-topics.html#cb297-1" aria-hidden="true"></a><span class="kw">plot</span>(r1,C2, <span class="dt">ylab=</span><span class="st">&quot;Central Concentration&quot;</span>)</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/time-varying-linear-central-1.png" width="100%" /></p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="advanced-miscellaneous-topics.html#cb298-1" aria-hidden="true"></a><span class="kw">plot</span>(r1,eff) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Effect&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Time&quot;</span>)</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/time-varying-linear-effect-1.png" width="100%" /></p>
<p>Note that the linear approximation in this case leads to some kinks in
the solved system at 24-hours where the covariate has a linear
interpolation between near 24 and near 0. While linear seems
reasonable, cases like clock time make other interpolation methods
more attractive.</p>
<p>In rxode2 the default covariate interpolation is be the last
observation carried forward (<code>locf</code>), or constant approximation. This is
equivalent to R’s <code>approxfun</code> with <code>method="constant"</code>.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="advanced-miscellaneous-topics.html#cb299-1" aria-hidden="true"></a>r1 &lt;-<span class="st"> </span><span class="kw">solve</span>(mod4, ev,<span class="dt">covsInterpolation=</span><span class="st">&quot;locf&quot;</span>)</span>
<span id="cb299-2"><a href="advanced-miscellaneous-topics.html#cb299-2" aria-hidden="true"></a><span class="kw">print</span>(r1)</span>
<span id="cb299-3"><a href="advanced-miscellaneous-topics.html#cb299-3" aria-hidden="true"></a><span class="co">#&gt; -- Solved rxode2 object --</span></span>
<span id="cb299-4"><a href="advanced-miscellaneous-topics.html#cb299-4" aria-hidden="true"></a><span class="co">#&gt; -- Parameters ($params): --</span></span>
<span id="cb299-5"><a href="advanced-miscellaneous-topics.html#cb299-5" aria-hidden="true"></a><span class="co">#&gt;        TKA        TCL        TV2         TQ        TV3      TKout      TEC50 </span></span>
<span id="cb299-6"><a href="advanced-miscellaneous-topics.html#cb299-6" aria-hidden="true"></a><span class="co">#&gt;   0.294000  18.600000  40.200000  10.500000 297.000000   1.000000 200.000000 </span></span>
<span id="cb299-7"><a href="advanced-miscellaneous-topics.html#cb299-7" aria-hidden="true"></a><span class="co">#&gt;       TKin         Tz        amp         pi </span></span>
<span id="cb299-8"><a href="advanced-miscellaneous-topics.html#cb299-8" aria-hidden="true"></a><span class="co">#&gt;   1.000000   8.000000   0.100000   3.141593 </span></span>
<span id="cb299-9"><a href="advanced-miscellaneous-topics.html#cb299-9" aria-hidden="true"></a><span class="co">#&gt; -- Initial Conditions ($inits): --</span></span>
<span id="cb299-10"><a href="advanced-miscellaneous-topics.html#cb299-10" aria-hidden="true"></a><span class="co">#&gt;   depot central    peri     eff </span></span>
<span id="cb299-11"><a href="advanced-miscellaneous-topics.html#cb299-11" aria-hidden="true"></a><span class="co">#&gt;       0       0       0       1 </span></span>
<span id="cb299-12"><a href="advanced-miscellaneous-topics.html#cb299-12" aria-hidden="true"></a><span class="co">#&gt; -- First part of data (object): --</span></span>
<span id="cb299-13"><a href="advanced-miscellaneous-topics.html#cb299-13" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 100 x 17</span></span>
<span id="cb299-14"><a href="advanced-miscellaneous-topics.html#cb299-14" aria-hidden="true"></a><span class="co">#&gt;    time    KA    CL    V2     Q    V3  Kout  EC50    C2   Kin    C3  depot</span></span>
<span id="cb299-15"><a href="advanced-miscellaneous-topics.html#cb299-15" aria-hidden="true"></a><span class="co">#&gt;     [h] &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb299-16"><a href="advanced-miscellaneous-topics.html#cb299-16" aria-hidden="true"></a><span class="co">#&gt; 1 0     0.294  18.6  40.2  10.5   297     1   200   0    1.1  0     10000 </span></span>
<span id="cb299-17"><a href="advanced-miscellaneous-topics.html#cb299-17" aria-hidden="true"></a><span class="co">#&gt; 2 0.485 0.294  18.6  40.2  10.5   297     1   200  27.8  1.10 0.257  8671.</span></span>
<span id="cb299-18"><a href="advanced-miscellaneous-topics.html#cb299-18" aria-hidden="true"></a><span class="co">#&gt; 3 0.970 0.294  18.6  40.2  10.5   297     1   200  43.7  1.10 0.874  7519.</span></span>
<span id="cb299-19"><a href="advanced-miscellaneous-topics.html#cb299-19" aria-hidden="true"></a><span class="co">#&gt; 4 1.45  0.294  18.6  40.2  10.5   297     1   200  51.8  1.09 1.68   6520.</span></span>
<span id="cb299-20"><a href="advanced-miscellaneous-topics.html#cb299-20" aria-hidden="true"></a><span class="co">#&gt; 5 1.94  0.294  18.6  40.2  10.5   297     1   200  54.8  1.09 2.56   5654.</span></span>
<span id="cb299-21"><a href="advanced-miscellaneous-topics.html#cb299-21" aria-hidden="true"></a><span class="co">#&gt; 6 2.42  0.294  18.6  40.2  10.5   297     1   200  54.6  1.08 3.45   4903.</span></span>
<span id="cb299-22"><a href="advanced-miscellaneous-topics.html#cb299-22" aria-hidden="true"></a><span class="co">#&gt; # i 94 more rows</span></span>
<span id="cb299-23"><a href="advanced-miscellaneous-topics.html#cb299-23" aria-hidden="true"></a><span class="co">#&gt; # i 5 more variables: central &lt;dbl&gt;, peri &lt;dbl&gt;, eff &lt;dbl&gt;, ctime [h], WT &lt;dbl&gt;</span></span></code></pre></div>
<p>which gives the following plots:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="advanced-miscellaneous-topics.html#cb300-1" aria-hidden="true"></a><span class="kw">plot</span>(r1,C2, <span class="dt">ylab=</span><span class="st">&quot;Central Concentration&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>)</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/time-varying-constant-central-1.png" width="100%" /></p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="advanced-miscellaneous-topics.html#cb301-1" aria-hidden="true"></a><span class="kw">plot</span>(r1,eff, <span class="dt">ylab=</span><span class="st">&quot;Effect&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>)</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/time-varying-constant-effect-1.png" width="100%" /></p>
<p>In this case, the plots seem to be smoother.</p>
<p>You can also use NONMEM’s preferred interpolation style of next
observation carried backward (NOCB):</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="advanced-miscellaneous-topics.html#cb302-1" aria-hidden="true"></a>r1 &lt;-<span class="st"> </span><span class="kw">solve</span>(mod4, ev,<span class="dt">covsInterpolation=</span><span class="st">&quot;nocb&quot;</span>)</span>
<span id="cb302-2"><a href="advanced-miscellaneous-topics.html#cb302-2" aria-hidden="true"></a><span class="kw">print</span>(r1)</span>
<span id="cb302-3"><a href="advanced-miscellaneous-topics.html#cb302-3" aria-hidden="true"></a><span class="co">#&gt; -- Solved rxode2 object --</span></span>
<span id="cb302-4"><a href="advanced-miscellaneous-topics.html#cb302-4" aria-hidden="true"></a><span class="co">#&gt; -- Parameters ($params): --</span></span>
<span id="cb302-5"><a href="advanced-miscellaneous-topics.html#cb302-5" aria-hidden="true"></a><span class="co">#&gt;        TKA        TCL        TV2         TQ        TV3      TKout      TEC50 </span></span>
<span id="cb302-6"><a href="advanced-miscellaneous-topics.html#cb302-6" aria-hidden="true"></a><span class="co">#&gt;   0.294000  18.600000  40.200000  10.500000 297.000000   1.000000 200.000000 </span></span>
<span id="cb302-7"><a href="advanced-miscellaneous-topics.html#cb302-7" aria-hidden="true"></a><span class="co">#&gt;       TKin         Tz        amp         pi </span></span>
<span id="cb302-8"><a href="advanced-miscellaneous-topics.html#cb302-8" aria-hidden="true"></a><span class="co">#&gt;   1.000000   8.000000   0.100000   3.141593 </span></span>
<span id="cb302-9"><a href="advanced-miscellaneous-topics.html#cb302-9" aria-hidden="true"></a><span class="co">#&gt; -- Initial Conditions ($inits): --</span></span>
<span id="cb302-10"><a href="advanced-miscellaneous-topics.html#cb302-10" aria-hidden="true"></a><span class="co">#&gt;   depot central    peri     eff </span></span>
<span id="cb302-11"><a href="advanced-miscellaneous-topics.html#cb302-11" aria-hidden="true"></a><span class="co">#&gt;       0       0       0       1 </span></span>
<span id="cb302-12"><a href="advanced-miscellaneous-topics.html#cb302-12" aria-hidden="true"></a><span class="co">#&gt; -- First part of data (object): --</span></span>
<span id="cb302-13"><a href="advanced-miscellaneous-topics.html#cb302-13" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 100 x 17</span></span>
<span id="cb302-14"><a href="advanced-miscellaneous-topics.html#cb302-14" aria-hidden="true"></a><span class="co">#&gt;    time    KA    CL    V2     Q    V3  Kout  EC50    C2   Kin    C3  depot</span></span>
<span id="cb302-15"><a href="advanced-miscellaneous-topics.html#cb302-15" aria-hidden="true"></a><span class="co">#&gt;     [h] &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb302-16"><a href="advanced-miscellaneous-topics.html#cb302-16" aria-hidden="true"></a><span class="co">#&gt; 1 0     0.294  18.6  40.2  10.5   297     1   200   0    1.1  0     10000 </span></span>
<span id="cb302-17"><a href="advanced-miscellaneous-topics.html#cb302-17" aria-hidden="true"></a><span class="co">#&gt; 2 0.485 0.294  18.6  40.2  10.5   297     1   200  27.8  1.10 0.257  8671.</span></span>
<span id="cb302-18"><a href="advanced-miscellaneous-topics.html#cb302-18" aria-hidden="true"></a><span class="co">#&gt; 3 0.970 0.294  18.6  40.2  10.5   297     1   200  43.7  1.10 0.874  7519.</span></span>
<span id="cb302-19"><a href="advanced-miscellaneous-topics.html#cb302-19" aria-hidden="true"></a><span class="co">#&gt; 4 1.45  0.294  18.6  40.2  10.5   297     1   200  51.8  1.09 1.68   6520.</span></span>
<span id="cb302-20"><a href="advanced-miscellaneous-topics.html#cb302-20" aria-hidden="true"></a><span class="co">#&gt; 5 1.94  0.294  18.6  40.2  10.5   297     1   200  54.8  1.09 2.56   5654.</span></span>
<span id="cb302-21"><a href="advanced-miscellaneous-topics.html#cb302-21" aria-hidden="true"></a><span class="co">#&gt; 6 2.42  0.294  18.6  40.2  10.5   297     1   200  54.6  1.08 3.45   4903.</span></span>
<span id="cb302-22"><a href="advanced-miscellaneous-topics.html#cb302-22" aria-hidden="true"></a><span class="co">#&gt; # i 94 more rows</span></span>
<span id="cb302-23"><a href="advanced-miscellaneous-topics.html#cb302-23" aria-hidden="true"></a><span class="co">#&gt; # i 5 more variables: central &lt;dbl&gt;, peri &lt;dbl&gt;, eff &lt;dbl&gt;, ctime [h], WT &lt;dbl&gt;</span></span></code></pre></div>
<p>which gives the following plots:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="advanced-miscellaneous-topics.html#cb303-1" aria-hidden="true"></a><span class="kw">plot</span>(r1,C2, <span class="dt">ylab=</span><span class="st">&quot;Central Concentration&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>)</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/time-varying-nocb-central-1.png" width="100%" /></p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="advanced-miscellaneous-topics.html#cb304-1" aria-hidden="true"></a><span class="kw">plot</span>(r1,eff, <span class="dt">ylab=</span><span class="st">&quot;Effect&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>)</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/time-varying-nocb-effect-1.png" width="100%" /></p>
</div>
</div>
<div id="shiny-and-rxode2" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Shiny and rxode2<a href="advanced-miscellaneous-topics.html#shiny-and-rxode2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="facilities-for-generating-r-shiny-applications" class="section level3 hasAnchor" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Facilities for generating R shiny applications<a href="advanced-miscellaneous-topics.html#facilities-for-generating-r-shiny-applications" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An example of creating an
R <a href="http://shiny.rstudio.com">shiny application</a> to interactively
explore responses of various complex dosing regimens is available at
<a href="http://qsp.engr.uga.edu:3838/rxode2/RegimenSimulator" class="uri">http://qsp.engr.uga.edu:3838/rxode2/RegimenSimulator</a>. Shiny
applications like this one may be programmatically created with the
experimental function <code>genShinyApp.template()</code>.</p>
<p>The above application includes widgets for varying the dose, dosing
regimen, dose cycle, and number of cycles.</p>
<pre><code>
genShinyApp.template(appDir = &quot;shinyExample&quot;, verbose=TRUE)

library(shiny)
runApp(&quot;shinyExample&quot;)
</code></pre>
<p><a href="http://qsp.engr.uga.edu:3838/rxode2/RegimenSimulator">Click here to go to the Shiny App</a></p>
</div>
<div id="exploring-parameter-fits-graphically-using-shiny" class="section level3 hasAnchor" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Exploring parameter fits graphically using shiny<a href="advanced-miscellaneous-topics.html#exploring-parameter-fits-graphically-using-shiny" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An rxode2 object can be explored with <code>rxShiny(obj)</code>. <code>rxShiny()</code> will also allow you to try
new models to see how they behave.</p>
</div>
</div>
<div id="using-rxode2-with-a-pipeline" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Using rxode2 with a pipeline<a href="advanced-miscellaneous-topics.html#using-rxode2-with-a-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="setting-up-the-rxode2-model-for-the-pipeline" class="section level3 hasAnchor" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Setting up the rxode2 model for the pipeline<a href="advanced-miscellaneous-topics.html#setting-up-the-rxode2-model-for-the-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this example we will show how to use rxode2 in a simple pipeline.</p>
<p>We can start with a model that can be used for the different
simulation workflows that rxode2 can handle:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="advanced-miscellaneous-topics.html#cb306-1" aria-hidden="true"></a><span class="kw">library</span>(rxode2)</span>
<span id="cb306-2"><a href="advanced-miscellaneous-topics.html#cb306-2" aria-hidden="true"></a></span>
<span id="cb306-3"><a href="advanced-miscellaneous-topics.html#cb306-3" aria-hidden="true"></a>Ribba2012 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb306-4"><a href="advanced-miscellaneous-topics.html#cb306-4" aria-hidden="true"></a>  <span class="kw">ini</span>({</span>
<span id="cb306-5"><a href="advanced-miscellaneous-topics.html#cb306-5" aria-hidden="true"></a>    k =<span class="st"> </span><span class="dv">100</span></span>
<span id="cb306-6"><a href="advanced-miscellaneous-topics.html#cb306-6" aria-hidden="true"></a>    tkde =<span class="st"> </span><span class="fl">0.24</span></span>
<span id="cb306-7"><a href="advanced-miscellaneous-topics.html#cb306-7" aria-hidden="true"></a>    eta.tkde =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-8"><a href="advanced-miscellaneous-topics.html#cb306-8" aria-hidden="true"></a>    tkpq =<span class="st"> </span><span class="fl">0.0295</span></span>
<span id="cb306-9"><a href="advanced-miscellaneous-topics.html#cb306-9" aria-hidden="true"></a>    eta.kpq =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-10"><a href="advanced-miscellaneous-topics.html#cb306-10" aria-hidden="true"></a>    tkqpp =<span class="st"> </span><span class="fl">0.0031</span></span>
<span id="cb306-11"><a href="advanced-miscellaneous-topics.html#cb306-11" aria-hidden="true"></a>    eta.kqpp =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-12"><a href="advanced-miscellaneous-topics.html#cb306-12" aria-hidden="true"></a>    tlambdap =<span class="st"> </span><span class="fl">0.121</span></span>
<span id="cb306-13"><a href="advanced-miscellaneous-topics.html#cb306-13" aria-hidden="true"></a>    eta.lambdap =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-14"><a href="advanced-miscellaneous-topics.html#cb306-14" aria-hidden="true"></a>    tgamma =<span class="st"> </span><span class="fl">0.729</span></span>
<span id="cb306-15"><a href="advanced-miscellaneous-topics.html#cb306-15" aria-hidden="true"></a>    eta.gamma =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-16"><a href="advanced-miscellaneous-topics.html#cb306-16" aria-hidden="true"></a>    tdeltaqp =<span class="st"> </span><span class="fl">0.00867</span></span>
<span id="cb306-17"><a href="advanced-miscellaneous-topics.html#cb306-17" aria-hidden="true"></a>    eta.deltaqp =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-18"><a href="advanced-miscellaneous-topics.html#cb306-18" aria-hidden="true"></a>    prop.sd &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-19"><a href="advanced-miscellaneous-topics.html#cb306-19" aria-hidden="true"></a>    tpt0 =<span class="st"> </span><span class="fl">7.13</span></span>
<span id="cb306-20"><a href="advanced-miscellaneous-topics.html#cb306-20" aria-hidden="true"></a>    eta.pt0 =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-21"><a href="advanced-miscellaneous-topics.html#cb306-21" aria-hidden="true"></a>    tq0 =<span class="st"> </span><span class="fl">41.2</span></span>
<span id="cb306-22"><a href="advanced-miscellaneous-topics.html#cb306-22" aria-hidden="true"></a>    eta.q0 =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb306-23"><a href="advanced-miscellaneous-topics.html#cb306-23" aria-hidden="true"></a>  })</span>
<span id="cb306-24"><a href="advanced-miscellaneous-topics.html#cb306-24" aria-hidden="true"></a>  <span class="kw">model</span>({</span>
<span id="cb306-25"><a href="advanced-miscellaneous-topics.html#cb306-25" aria-hidden="true"></a>    kde <span class="op">~</span><span class="st"> </span>tkde<span class="op">*</span><span class="kw">exp</span>(eta.tkde)</span>
<span id="cb306-26"><a href="advanced-miscellaneous-topics.html#cb306-26" aria-hidden="true"></a>    kpq <span class="op">~</span><span class="st"> </span>tkpq <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(eta.kpq)</span>
<span id="cb306-27"><a href="advanced-miscellaneous-topics.html#cb306-27" aria-hidden="true"></a>    kqpp <span class="op">~</span><span class="st"> </span>tkqpp <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(eta.kqpp)</span>
<span id="cb306-28"><a href="advanced-miscellaneous-topics.html#cb306-28" aria-hidden="true"></a>    lambdap <span class="op">~</span><span class="st"> </span>tlambdap<span class="op">*</span><span class="kw">exp</span>(eta.lambdap)</span>
<span id="cb306-29"><a href="advanced-miscellaneous-topics.html#cb306-29" aria-hidden="true"></a>    gamma <span class="op">~</span><span class="st"> </span>tgamma<span class="op">*</span><span class="kw">exp</span>(eta.gamma)</span>
<span id="cb306-30"><a href="advanced-miscellaneous-topics.html#cb306-30" aria-hidden="true"></a>    deltaqp <span class="op">~</span><span class="st"> </span>tdeltaqp<span class="op">*</span><span class="kw">exp</span>(eta.deltaqp)</span>
<span id="cb306-31"><a href="advanced-miscellaneous-topics.html#cb306-31" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(c) =<span class="st"> </span><span class="op">-</span>kde <span class="op">*</span><span class="st"> </span>c</span>
<span id="cb306-32"><a href="advanced-miscellaneous-topics.html#cb306-32" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(pt) =<span class="st"> </span>lambdap <span class="op">*</span><span class="st"> </span>pt <span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>pstar<span class="op">/</span>k) <span class="op">+</span><span class="st"> </span>kqpp<span class="op">*</span>qp <span class="op">-</span></span>
<span id="cb306-33"><a href="advanced-miscellaneous-topics.html#cb306-33" aria-hidden="true"></a><span class="st">      </span>kpq<span class="op">*</span>pt <span class="op">-</span><span class="st"> </span>gamma<span class="op">*</span>c<span class="op">*</span>kde<span class="op">*</span>pt</span>
<span id="cb306-34"><a href="advanced-miscellaneous-topics.html#cb306-34" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(q) =<span class="st"> </span>kpq<span class="op">*</span>pt <span class="op">-</span>gamma<span class="op">*</span>c<span class="op">*</span>kde<span class="op">*</span>q</span>
<span id="cb306-35"><a href="advanced-miscellaneous-topics.html#cb306-35" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(qp) =<span class="st"> </span>gamma<span class="op">*</span>c<span class="op">*</span>kde<span class="op">*</span>q <span class="op">-</span><span class="st"> </span>kqpp<span class="op">*</span>qp <span class="op">-</span><span class="st"> </span>deltaqp<span class="op">*</span>qp</span>
<span id="cb306-36"><a href="advanced-miscellaneous-topics.html#cb306-36" aria-hidden="true"></a><span class="co">#### initial conditions</span></span>
<span id="cb306-37"><a href="advanced-miscellaneous-topics.html#cb306-37" aria-hidden="true"></a>    pt0 <span class="op">~</span><span class="st"> </span>tpt0<span class="op">*</span><span class="kw">exp</span>(eta.pt0)</span>
<span id="cb306-38"><a href="advanced-miscellaneous-topics.html#cb306-38" aria-hidden="true"></a>    q0 <span class="op">~</span><span class="st"> </span>tq0<span class="op">*</span><span class="kw">exp</span>(eta.q0)</span>
<span id="cb306-39"><a href="advanced-miscellaneous-topics.html#cb306-39" aria-hidden="true"></a>    <span class="kw">pt</span>(<span class="dv">0</span>) =<span class="st"> </span>pt0</span>
<span id="cb306-40"><a href="advanced-miscellaneous-topics.html#cb306-40" aria-hidden="true"></a>    <span class="kw">q</span>(<span class="dv">0</span>) =<span class="st"> </span>q0</span>
<span id="cb306-41"><a href="advanced-miscellaneous-topics.html#cb306-41" aria-hidden="true"></a>    pstar &lt;-<span class="st"> </span>(pt<span class="op">+</span>q<span class="op">+</span>qp)</span>
<span id="cb306-42"><a href="advanced-miscellaneous-topics.html#cb306-42" aria-hidden="true"></a>    pstar <span class="op">~</span><span class="st">  </span><span class="kw">prop</span>(prop.sd)</span>
<span id="cb306-43"><a href="advanced-miscellaneous-topics.html#cb306-43" aria-hidden="true"></a>  })</span>
<span id="cb306-44"><a href="advanced-miscellaneous-topics.html#cb306-44" aria-hidden="true"></a>}</span></code></pre></div>
<p>This is a tumor growth model described in Ribba 2012. In this case, we
compiled the model into an R object <code>Ribba2012</code>, though in an rxode2
simulation pipeline, you do not <em>have</em> to assign the compiled model to
any object, though I think it makes sense.</p>
</div>
<div id="simulating-one-event-table" class="section level3 hasAnchor" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> Simulating one event table<a href="advanced-miscellaneous-topics.html#simulating-one-event-table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Simulating a single event table is quite simple:</p>
<ul>
<li>You pipe the rxode2 simulation object into an event table object by <code>et()</code>.<br />
</li>
<li>When the events are completely specified, you simply solve the ODE system with
<code>rxSolve()</code>.</li>
<li>In this case you can pipe the output to <code>plot()</code> to conveniently view the results.</li>
<li>Note for the plot we are only selecting the selecting following:
<ul>
<li><code>pt</code> (Proliferative Tissue),</li>
<li><code>q</code> (quiescent tissue)</li>
<li><code>qp</code> (DNA-Damaged quiescent tissue) and</li>
<li><code>pstar</code> (total tumor tissue)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="advanced-miscellaneous-topics.html#cb307-1" aria-hidden="true"></a>Ribba2012 <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Use rxode2</span></span>
<span id="cb307-2"><a href="advanced-miscellaneous-topics.html#cb307-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">time.units=</span><span class="st">&quot;months&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Pipe to a new event table</span></span>
<span id="cb307-3"><a href="advanced-miscellaneous-topics.html#cb307-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">1</span>, <span class="dt">time=</span><span class="dv">50</span>, <span class="dt">until=</span><span class="dv">58</span>, <span class="dt">ii=</span><span class="fl">1.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add dosing every 1.5 months</span></span>
<span id="cb307-4"><a href="advanced-miscellaneous-topics.html#cb307-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dt">by=</span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add some sampling times (not required)</span></span>
<span id="cb307-5"><a href="advanced-miscellaneous-topics.html#cb307-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">rxSolve</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Solve the simulation</span></span>
<span id="cb307-6"><a href="advanced-miscellaneous-topics.html#cb307-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">plot</span>(pt, q, qp, pstar) <span class="co"># Plot it, plotting the variables of interest</span></span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-126-1.png" width="100%" /></p>
</div>
<div id="simulating-multiple-subjects-from-a-single-event-table" class="section level3 hasAnchor" number="13.3.3">
<h3><span class="header-section-number">13.3.3</span> Simulating multiple subjects from a single event table<a href="advanced-miscellaneous-topics.html#simulating-multiple-subjects-from-a-single-event-table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="simulating-with-between-subject-variability" class="section level4 hasAnchor" number="13.3.3.1">
<h4><span class="header-section-number">13.3.3.1</span> Simulating with between subject variability<a href="advanced-miscellaneous-topics.html#simulating-with-between-subject-variability" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The next sort of simulation that may be useful is simulating multiple
patients with the same treatments. In this case, we will use the
<code>omega</code> matrix specified by the paper:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="advanced-miscellaneous-topics.html#cb308-1" aria-hidden="true"></a><span class="co">#### Add CVs from paper for individual simulation</span></span>
<span id="cb308-2"><a href="advanced-miscellaneous-topics.html#cb308-2" aria-hidden="true"></a><span class="co">#### Uses exact formula:</span></span>
<span id="cb308-3"><a href="advanced-miscellaneous-topics.html#cb308-3" aria-hidden="true"></a></span>
<span id="cb308-4"><a href="advanced-miscellaneous-topics.html#cb308-4" aria-hidden="true"></a>lognCv =<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">log</span>((x<span class="op">/</span><span class="dv">100</span>)<span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span>)}</span>
<span id="cb308-5"><a href="advanced-miscellaneous-topics.html#cb308-5" aria-hidden="true"></a></span>
<span id="cb308-6"><a href="advanced-miscellaneous-topics.html#cb308-6" aria-hidden="true"></a><span class="kw">library</span>(lotri)</span>
<span id="cb308-7"><a href="advanced-miscellaneous-topics.html#cb308-7" aria-hidden="true"></a><span class="co">#### Now create omega matrix</span></span>
<span id="cb308-8"><a href="advanced-miscellaneous-topics.html#cb308-8" aria-hidden="true"></a><span class="co">#### I&#39;m using lotri to quickly specify names/diagonals</span></span>
<span id="cb308-9"><a href="advanced-miscellaneous-topics.html#cb308-9" aria-hidden="true"></a>omega &lt;-<span class="st"> </span><span class="kw">lotri</span>(eta.pt0 <span class="op">~</span><span class="st"> </span><span class="kw">lognCv</span>(<span class="dv">94</span>),</span>
<span id="cb308-10"><a href="advanced-miscellaneous-topics.html#cb308-10" aria-hidden="true"></a>               eta.q0 <span class="op">~</span><span class="st"> </span><span class="kw">lognCv</span>(<span class="dv">54</span>),</span>
<span id="cb308-11"><a href="advanced-miscellaneous-topics.html#cb308-11" aria-hidden="true"></a>               eta.lambdap <span class="op">~</span><span class="st"> </span><span class="kw">lognCv</span>(<span class="dv">72</span>),</span>
<span id="cb308-12"><a href="advanced-miscellaneous-topics.html#cb308-12" aria-hidden="true"></a>               eta.kqp <span class="op">~</span><span class="st"> </span><span class="kw">lognCv</span>(<span class="dv">76</span>),</span>
<span id="cb308-13"><a href="advanced-miscellaneous-topics.html#cb308-13" aria-hidden="true"></a>               eta.kqpp <span class="op">~</span><span class="st"> </span><span class="kw">lognCv</span>(<span class="dv">97</span>),</span>
<span id="cb308-14"><a href="advanced-miscellaneous-topics.html#cb308-14" aria-hidden="true"></a>               eta.deltaqp <span class="op">~</span><span class="st"> </span><span class="kw">lognCv</span>(<span class="dv">115</span>),</span>
<span id="cb308-15"><a href="advanced-miscellaneous-topics.html#cb308-15" aria-hidden="true"></a>               eta.tkde <span class="op">~</span><span class="st"> </span><span class="kw">lognCv</span>(<span class="dv">70</span>))</span>
<span id="cb308-16"><a href="advanced-miscellaneous-topics.html#cb308-16" aria-hidden="true"></a></span>
<span id="cb308-17"><a href="advanced-miscellaneous-topics.html#cb308-17" aria-hidden="true"></a>omega</span>
<span id="cb308-18"><a href="advanced-miscellaneous-topics.html#cb308-18" aria-hidden="true"></a><span class="co">#&gt;               eta.pt0    eta.q0 eta.lambdap   eta.kqp  eta.kqpp eta.deltaqp</span></span>
<span id="cb308-19"><a href="advanced-miscellaneous-topics.html#cb308-19" aria-hidden="true"></a><span class="co">#&gt; eta.pt0     0.6331848 0.0000000   0.0000000 0.0000000 0.0000000   0.0000000</span></span>
<span id="cb308-20"><a href="advanced-miscellaneous-topics.html#cb308-20" aria-hidden="true"></a><span class="co">#&gt; eta.q0      0.0000000 0.2558818   0.0000000 0.0000000 0.0000000   0.0000000</span></span>
<span id="cb308-21"><a href="advanced-miscellaneous-topics.html#cb308-21" aria-hidden="true"></a><span class="co">#&gt; eta.lambdap 0.0000000 0.0000000   0.4176571 0.0000000 0.0000000   0.0000000</span></span>
<span id="cb308-22"><a href="advanced-miscellaneous-topics.html#cb308-22" aria-hidden="true"></a><span class="co">#&gt; eta.kqp     0.0000000 0.0000000   0.0000000 0.4559047 0.0000000   0.0000000</span></span>
<span id="cb308-23"><a href="advanced-miscellaneous-topics.html#cb308-23" aria-hidden="true"></a><span class="co">#&gt; eta.kqpp    0.0000000 0.0000000   0.0000000 0.0000000 0.6631518   0.0000000</span></span>
<span id="cb308-24"><a href="advanced-miscellaneous-topics.html#cb308-24" aria-hidden="true"></a><span class="co">#&gt; eta.deltaqp 0.0000000 0.0000000   0.0000000 0.0000000 0.0000000   0.8426442</span></span>
<span id="cb308-25"><a href="advanced-miscellaneous-topics.html#cb308-25" aria-hidden="true"></a><span class="co">#&gt; eta.tkde    0.0000000 0.0000000   0.0000000 0.0000000 0.0000000   0.0000000</span></span>
<span id="cb308-26"><a href="advanced-miscellaneous-topics.html#cb308-26" aria-hidden="true"></a><span class="co">#&gt;              eta.tkde</span></span>
<span id="cb308-27"><a href="advanced-miscellaneous-topics.html#cb308-27" aria-hidden="true"></a><span class="co">#&gt; eta.pt0     0.0000000</span></span>
<span id="cb308-28"><a href="advanced-miscellaneous-topics.html#cb308-28" aria-hidden="true"></a><span class="co">#&gt; eta.q0      0.0000000</span></span>
<span id="cb308-29"><a href="advanced-miscellaneous-topics.html#cb308-29" aria-hidden="true"></a><span class="co">#&gt; eta.lambdap 0.0000000</span></span>
<span id="cb308-30"><a href="advanced-miscellaneous-topics.html#cb308-30" aria-hidden="true"></a><span class="co">#&gt; eta.kqp     0.0000000</span></span>
<span id="cb308-31"><a href="advanced-miscellaneous-topics.html#cb308-31" aria-hidden="true"></a><span class="co">#&gt; eta.kqpp    0.0000000</span></span>
<span id="cb308-32"><a href="advanced-miscellaneous-topics.html#cb308-32" aria-hidden="true"></a><span class="co">#&gt; eta.deltaqp 0.0000000</span></span>
<span id="cb308-33"><a href="advanced-miscellaneous-topics.html#cb308-33" aria-hidden="true"></a><span class="co">#&gt; eta.tkde    0.3987761</span></span></code></pre></div>
<p>With this information, it is easy to simulate 3 subjects from the
model-based parameters:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="advanced-miscellaneous-topics.html#cb309-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1089</span>)</span>
<span id="cb309-2"><a href="advanced-miscellaneous-topics.html#cb309-2" aria-hidden="true"></a><span class="kw">rxSetSeed</span>(<span class="dv">1089</span>)</span>
<span id="cb309-3"><a href="advanced-miscellaneous-topics.html#cb309-3" aria-hidden="true"></a>Ribba2012 <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Use rxode2</span></span>
<span id="cb309-4"><a href="advanced-miscellaneous-topics.html#cb309-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">time.units=</span><span class="st">&quot;months&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Pipe to a new event table</span></span>
<span id="cb309-5"><a href="advanced-miscellaneous-topics.html#cb309-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">1</span>, <span class="dt">time=</span><span class="dv">50</span>, <span class="dt">until=</span><span class="dv">58</span>, <span class="dt">ii=</span><span class="fl">1.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add dosing every 1.5 months</span></span>
<span id="cb309-6"><a href="advanced-miscellaneous-topics.html#cb309-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dt">by=</span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add some sampling times (not required)</span></span>
<span id="cb309-7"><a href="advanced-miscellaneous-topics.html#cb309-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">rxSolve</span>(<span class="dt">nSub=</span><span class="dv">3</span>, <span class="dt">omega=</span>omega) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Solve the simulation</span></span>
<span id="cb309-8"><a href="advanced-miscellaneous-topics.html#cb309-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">plot</span>(pt, q, qp, pstar) <span class="co"># Plot it, plotting the variables of interest</span></span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-128-1.png" width="100%" /></p>
<p>Note there are two different things that were added to this simulation:
- <code>nSub</code> to specify how many subjects are in the model
- <code>omega</code> to specify the between subject variability.</p>
</div>
<div id="simulation-with-unexplained-variability" class="section level4 hasAnchor" number="13.3.3.2">
<h4><span class="header-section-number">13.3.3.2</span> Simulation with unexplained variability<a href="advanced-miscellaneous-topics.html#simulation-with-unexplained-variability" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You can even add unexplained variability quite easily:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="advanced-miscellaneous-topics.html#cb310-1" aria-hidden="true"></a>Ribba2012 <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Use rxode2</span></span>
<span id="cb310-2"><a href="advanced-miscellaneous-topics.html#cb310-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ini</span>(<span class="dt">prop.sd=</span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># change variability</span></span>
<span id="cb310-3"><a href="advanced-miscellaneous-topics.html#cb310-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">time.units=</span><span class="st">&quot;months&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Pipe to a new event table</span></span>
<span id="cb310-4"><a href="advanced-miscellaneous-topics.html#cb310-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">1</span>, <span class="dt">time=</span><span class="dv">50</span>, <span class="dt">until=</span><span class="dv">58</span>, <span class="dt">ii=</span><span class="fl">1.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add dosing every 1.5 months</span></span>
<span id="cb310-5"><a href="advanced-miscellaneous-topics.html#cb310-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dt">by=</span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add some sampling times (not required)</span></span>
<span id="cb310-6"><a href="advanced-miscellaneous-topics.html#cb310-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">rxSolve</span>(<span class="dt">nSub=</span><span class="dv">3</span>, <span class="dt">omega=</span>omega) <span class="op">%&gt;%</span></span>
<span id="cb310-7"><a href="advanced-miscellaneous-topics.html#cb310-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">plot</span>(pt, q, qp, sim) <span class="co"># Plot it, plotting the variables of interest</span></span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-129-1.png" width="100%" /></p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="advanced-miscellaneous-topics.html#cb311-1" aria-hidden="true"></a></span>
<span id="cb311-2"><a href="advanced-miscellaneous-topics.html#cb311-2" aria-hidden="true"></a><span class="co">### note that sim is the simulated pstar since this is simulated from the</span></span>
<span id="cb311-3"><a href="advanced-miscellaneous-topics.html#cb311-3" aria-hidden="true"></a><span class="co">### model with a nlmixr2 endpoint</span></span></code></pre></div>
<p>In this case we only added the <code>sigma</code> matrix to have unexplained
variability on the <code>pstar</code> or total tumor tissue.</p>
<p>You can even simulate with uncertainty in the <code>theta</code> <code>omega</code> and <code>sigma</code> values if you wish.</p>
</div>
<div id="simulation-with-uncertainty-in-all-the-parameters-by-matrices" class="section level4 hasAnchor" number="13.3.3.3">
<h4><span class="header-section-number">13.3.3.3</span> Simulation with uncertainty in all the parameters (by matrices)<a href="advanced-miscellaneous-topics.html#simulation-with-uncertainty-in-all-the-parameters-by-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If we assume these parameters came from <code>95</code> subjects with <code>8</code>
observations apiece, the degrees of freedom for the omega matrix would
be <code>95</code>, and the degrees of freedom of the <code>sigma</code> matrix would be
<code>95*8=760</code> because <code>95</code> items informed the <code>omega</code> matrix, and <code>760</code>
items informed the <code>sigma</code> matrix.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="advanced-miscellaneous-topics.html#cb312-1" aria-hidden="true"></a>Ribba2012 <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Use rxode2</span></span>
<span id="cb312-2"><a href="advanced-miscellaneous-topics.html#cb312-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ini</span>(<span class="dt">prop.sd =</span> <span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb312-3"><a href="advanced-miscellaneous-topics.html#cb312-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">time.units=</span><span class="st">&quot;months&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Pipe to a new event table</span></span>
<span id="cb312-4"><a href="advanced-miscellaneous-topics.html#cb312-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">1</span>, <span class="dt">time=</span><span class="dv">50</span>, <span class="dt">until=</span><span class="dv">58</span>, <span class="dt">ii=</span><span class="fl">1.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add dosing every 1.5 months</span></span>
<span id="cb312-5"><a href="advanced-miscellaneous-topics.html#cb312-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dt">by=</span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add some sampling times (not required)</span></span>
<span id="cb312-6"><a href="advanced-miscellaneous-topics.html#cb312-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">rxSolve</span>(<span class="dt">nSub=</span><span class="dv">3</span>, <span class="dt">nStud=</span><span class="dv">3</span>, <span class="dt">omega=</span>omega,</span>
<span id="cb312-7"><a href="advanced-miscellaneous-topics.html#cb312-7" aria-hidden="true"></a>          <span class="dt">dfSub=</span><span class="dv">760</span>, <span class="dt">dfObs=</span><span class="dv">95</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Solve the simulation</span></span>
<span id="cb312-8"><a href="advanced-miscellaneous-topics.html#cb312-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">plot</span>(pt, q, qp, sim) <span class="co"># Plot it, plotting the variables of interest</span></span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-130-1.png" width="100%" /></p>
<p>Often in simulations we have a full covariance matrix for the fixed
effect parameters. In this case, we do not have the matrix, but it
could be specified by <code>thetaMat</code>.</p>
<p>While we do not have a full covariance matrix, we can have information
about the diagonal elements of the covariance matrix from the model
paper. These can be converted as follows:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="advanced-miscellaneous-topics.html#cb313-1" aria-hidden="true"></a>rseVar &lt;-<span class="st"> </span><span class="cf">function</span>(est, rse){</span>
<span id="cb313-2"><a href="advanced-miscellaneous-topics.html#cb313-2" aria-hidden="true"></a>  <span class="kw">return</span>(est<span class="op">*</span>rse<span class="op">/</span><span class="dv">100</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb313-3"><a href="advanced-miscellaneous-topics.html#cb313-3" aria-hidden="true"></a>}</span>
<span id="cb313-4"><a href="advanced-miscellaneous-topics.html#cb313-4" aria-hidden="true"></a></span>
<span id="cb313-5"><a href="advanced-miscellaneous-topics.html#cb313-5" aria-hidden="true"></a>thetaMat &lt;-<span class="st"> </span><span class="kw">lotri</span>(tpt0 <span class="op">~</span><span class="st"> </span><span class="kw">rseVar</span>(<span class="fl">7.13</span>,<span class="dv">25</span>),</span>
<span id="cb313-6"><a href="advanced-miscellaneous-topics.html#cb313-6" aria-hidden="true"></a>                  tq0 <span class="op">~</span><span class="st"> </span><span class="kw">rseVar</span>(<span class="fl">41.2</span>,<span class="dv">7</span>),</span>
<span id="cb313-7"><a href="advanced-miscellaneous-topics.html#cb313-7" aria-hidden="true"></a>                  tlambdap <span class="op">~</span><span class="st"> </span><span class="kw">rseVar</span>(<span class="fl">0.121</span>, <span class="dv">16</span>),</span>
<span id="cb313-8"><a href="advanced-miscellaneous-topics.html#cb313-8" aria-hidden="true"></a>                  tkqpp <span class="op">~</span><span class="st"> </span><span class="kw">rseVar</span>(<span class="fl">0.0031</span>, <span class="dv">35</span>),</span>
<span id="cb313-9"><a href="advanced-miscellaneous-topics.html#cb313-9" aria-hidden="true"></a>                  tdeltaqp <span class="op">~</span><span class="st"> </span><span class="kw">rseVar</span>(<span class="fl">0.00867</span>, <span class="dv">21</span>),</span>
<span id="cb313-10"><a href="advanced-miscellaneous-topics.html#cb313-10" aria-hidden="true"></a>                  tgamma <span class="op">~</span><span class="st"> </span><span class="kw">rseVar</span>(<span class="fl">0.729</span>, <span class="dv">37</span>),</span>
<span id="cb313-11"><a href="advanced-miscellaneous-topics.html#cb313-11" aria-hidden="true"></a>                  tkde <span class="op">~</span><span class="st"> </span><span class="kw">rseVar</span>(<span class="fl">0.24</span>, <span class="dv">33</span>)</span>
<span id="cb313-12"><a href="advanced-miscellaneous-topics.html#cb313-12" aria-hidden="true"></a>                  )</span>
<span id="cb313-13"><a href="advanced-miscellaneous-topics.html#cb313-13" aria-hidden="true"></a></span>
<span id="cb313-14"><a href="advanced-miscellaneous-topics.html#cb313-14" aria-hidden="true"></a>thetaMat</span>
<span id="cb313-15"><a href="advanced-miscellaneous-topics.html#cb313-15" aria-hidden="true"></a><span class="co">#&gt;            tpt0   tq0 tlambdap    tkqpp  tdeltaqp  tgamma   tkde</span></span>
<span id="cb313-16"><a href="advanced-miscellaneous-topics.html#cb313-16" aria-hidden="true"></a><span class="co">#&gt; tpt0     1.7825 0.000  0.00000 0.000000 0.0000000 0.00000 0.0000</span></span>
<span id="cb313-17"><a href="advanced-miscellaneous-topics.html#cb313-17" aria-hidden="true"></a><span class="co">#&gt; tq0      0.0000 2.884  0.00000 0.000000 0.0000000 0.00000 0.0000</span></span>
<span id="cb313-18"><a href="advanced-miscellaneous-topics.html#cb313-18" aria-hidden="true"></a><span class="co">#&gt; tlambdap 0.0000 0.000  0.01936 0.000000 0.0000000 0.00000 0.0000</span></span>
<span id="cb313-19"><a href="advanced-miscellaneous-topics.html#cb313-19" aria-hidden="true"></a><span class="co">#&gt; tkqpp    0.0000 0.000  0.00000 0.001085 0.0000000 0.00000 0.0000</span></span>
<span id="cb313-20"><a href="advanced-miscellaneous-topics.html#cb313-20" aria-hidden="true"></a><span class="co">#&gt; tdeltaqp 0.0000 0.000  0.00000 0.000000 0.0018207 0.00000 0.0000</span></span>
<span id="cb313-21"><a href="advanced-miscellaneous-topics.html#cb313-21" aria-hidden="true"></a><span class="co">#&gt; tgamma   0.0000 0.000  0.00000 0.000000 0.0000000 0.26973 0.0000</span></span>
<span id="cb313-22"><a href="advanced-miscellaneous-topics.html#cb313-22" aria-hidden="true"></a><span class="co">#&gt; tkde     0.0000 0.000  0.00000 0.000000 0.0000000 0.00000 0.0792</span></span></code></pre></div>
<p>Now we have a <code>thetaMat</code> to represent the uncertainty in the <code>theta</code>
matrix, as well as the other pieces in the simulation. Typically you
can put this information into your simulation with the <code>thetaMat</code>
matrix.</p>
<p>With such large variability in <code>theta</code> it is easy to sample a negative
rate constant, which does not make sense. For example:</p>
<pre><code>Ribba2012 %&gt;% # Use rxode2
ini(prop.sd = 0.05) %&gt;%
et(time.units=&quot;months&quot;) %&gt;% # Pipe to a new event table
et(amt=1, time=50, until=58, ii=1.5) %&gt;% # Add dosing every 1.5 months
et(0, 250, by=0.5) %&gt;% # Add some sampling times (not required)
rxSolve(nSub=2, nStud=2, omega=omega,
thetaMat=thetaMat,
dfSub=760, dfObs=95) %&gt;% # Solve the simulation
plot(pt, q, qp, pstar) # Plot it, plotting the variables of interest

#&gt; ℹ change initial estimate of `prop.sd` to `0.05`
#&gt; unhandled error message: EE:[lsoda] 70000 steps taken before reaching tout
#&gt; @(lsoda.c:750
#&gt; Warning message:
#&gt; In rxSolve_(object, .ctl, .nms, .xtra, params, events, inits, setupOnly = .setupOnly) :
#&gt;  Some ID(s) could not solve the ODEs correctly; These values are replaced with NA.</code></pre>
<p>To correct these problems you simply need to use a truncated
multivariate normal and specify the reasonable ranges for the
parameters. For <code>theta</code> this is specified by <code>thetaLower</code> and
<code>thetaUpper</code>. Similar parameters are there for the other matrices:
<code>omegaLower</code>, <code>omegaUpper</code>, <code>sigmaLower</code> and <code>sigmaUpper</code>. These may
be named vectors, one numeric value, or a numeric vector matching the
number of parameters specified in the <code>thetaMat</code> matrix.</p>
<p>In this case the simulation simply has to be modified to have
<code>thetaLower=0</code> to make sure all rates are positive:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="advanced-miscellaneous-topics.html#cb315-1" aria-hidden="true"></a>Ribba2012 <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Use rxode2</span></span>
<span id="cb315-2"><a href="advanced-miscellaneous-topics.html#cb315-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ini</span>(<span class="dt">prop.sd =</span> <span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb315-3"><a href="advanced-miscellaneous-topics.html#cb315-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">time.units=</span><span class="st">&quot;months&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Pipe to a new event table</span></span>
<span id="cb315-4"><a href="advanced-miscellaneous-topics.html#cb315-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">1</span>, <span class="dt">time=</span><span class="dv">50</span>, <span class="dt">until=</span><span class="dv">58</span>, <span class="dt">ii=</span><span class="fl">1.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add dosing every 1.5 months</span></span>
<span id="cb315-5"><a href="advanced-miscellaneous-topics.html#cb315-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dt">by=</span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add some sampling times (not required)</span></span>
<span id="cb315-6"><a href="advanced-miscellaneous-topics.html#cb315-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">rxSolve</span>(<span class="dt">nSub=</span><span class="dv">2</span>, <span class="dt">nStud=</span><span class="dv">2</span>, <span class="dt">omega=</span>omega,</span>
<span id="cb315-7"><a href="advanced-miscellaneous-topics.html#cb315-7" aria-hidden="true"></a>          <span class="dt">thetaMat=</span>thetaMat,</span>
<span id="cb315-8"><a href="advanced-miscellaneous-topics.html#cb315-8" aria-hidden="true"></a>          <span class="dt">thetaLower=</span><span class="dv">0</span>, <span class="co"># Make sure the rates are reasonable</span></span>
<span id="cb315-9"><a href="advanced-miscellaneous-topics.html#cb315-9" aria-hidden="true"></a>          <span class="dt">dfSub=</span><span class="dv">760</span>, <span class="dt">dfObs=</span><span class="dv">95</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Solve the simulation</span></span>
<span id="cb315-10"><a href="advanced-miscellaneous-topics.html#cb315-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">plot</span>(pt, q, qp, sim) <span class="co"># Plot it, plotting the variables of interest</span></span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-132-1.png" width="100%" /></p>
</div>
</div>
<div id="summarizing-the-simulation-output" class="section level3 hasAnchor" number="13.3.4">
<h3><span class="header-section-number">13.3.4</span> Summarizing the simulation output<a href="advanced-miscellaneous-topics.html#summarizing-the-simulation-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While it is easy to use <code>dplyr</code> and <code>data.table</code> to perform your own
summary of simulations, <code>rxode2</code> also provides this ability by the
<code>confint</code> function.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="advanced-miscellaneous-topics.html#cb316-1" aria-hidden="true"></a><span class="co">#### This takes a little more time; Most of the time is the summary</span></span>
<span id="cb316-2"><a href="advanced-miscellaneous-topics.html#cb316-2" aria-hidden="true"></a><span class="co">#### time.</span></span>
<span id="cb316-3"><a href="advanced-miscellaneous-topics.html#cb316-3" aria-hidden="true"></a></span>
<span id="cb316-4"><a href="advanced-miscellaneous-topics.html#cb316-4" aria-hidden="true"></a>sim0 &lt;-<span class="st"> </span>Ribba2012 <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Use rxode2</span></span>
<span id="cb316-5"><a href="advanced-miscellaneous-topics.html#cb316-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">ini</span>(<span class="dt">prop.sd=</span><span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb316-6"><a href="advanced-miscellaneous-topics.html#cb316-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">time.units=</span><span class="st">&quot;months&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Pipe to a new event table</span></span>
<span id="cb316-7"><a href="advanced-miscellaneous-topics.html#cb316-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">1</span>, <span class="dt">time=</span><span class="dv">50</span>, <span class="dt">until=</span><span class="dv">58</span>, <span class="dt">ii=</span><span class="fl">1.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add dosing every 1.5 months</span></span>
<span id="cb316-8"><a href="advanced-miscellaneous-topics.html#cb316-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dt">by=</span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add some sampling times (not required)</span></span>
<span id="cb316-9"><a href="advanced-miscellaneous-topics.html#cb316-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">rxSolve</span>(<span class="dt">nSub=</span><span class="dv">10</span>, <span class="dt">nStud=</span><span class="dv">10</span>, <span class="dt">omega=</span>omega,</span>
<span id="cb316-10"><a href="advanced-miscellaneous-topics.html#cb316-10" aria-hidden="true"></a>          <span class="dt">thetaMat=</span>thetaMat,</span>
<span id="cb316-11"><a href="advanced-miscellaneous-topics.html#cb316-11" aria-hidden="true"></a>          <span class="dt">thetaLower=</span><span class="dv">0</span>, <span class="co"># Make sure the rates are reasonable</span></span>
<span id="cb316-12"><a href="advanced-miscellaneous-topics.html#cb316-12" aria-hidden="true"></a>          <span class="dt">dfSub=</span><span class="dv">760</span>, <span class="dt">dfObs=</span><span class="dv">95</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Solve the simulation</span></span>
<span id="cb316-13"><a href="advanced-miscellaneous-topics.html#cb316-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">confint</span>(<span class="kw">c</span>(<span class="st">&quot;pt&quot;</span>,<span class="st">&quot;q&quot;</span>,<span class="st">&quot;qp&quot;</span>,<span class="st">&quot;sim&quot;</span>),<span class="dt">level=</span><span class="fl">0.90</span>); <span class="co"># Create Simulation intervals</span></span>
<span id="cb316-14"><a href="advanced-miscellaneous-topics.html#cb316-14" aria-hidden="true"></a></span>
<span id="cb316-15"><a href="advanced-miscellaneous-topics.html#cb316-15" aria-hidden="true"></a>sim0 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>() <span class="co"># Plot the simulation intervals</span></span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-133-1.png" width="100%" /></p>
<div id="simulating-from-a-data-frame-of-parameters" class="section level4 hasAnchor" number="13.3.4.1">
<h4><span class="header-section-number">13.3.4.1</span> Simulating from a data-frame of parameters<a href="advanced-miscellaneous-topics.html#simulating-from-a-data-frame-of-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>While the simulation from matrices can be very useful and a fast way
to simulate information, sometimes you may want to simulate more
complex scenarios. For instance, there may be some reason to believe
that <code>tkde</code> needs to be above <code>tlambdap</code>, therefore these need to be
simulated more carefully. You can generate the data frame in whatever
way you want. The internal method of simulating the new parameters is
exported too.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="advanced-miscellaneous-topics.html#cb317-1" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb317-2"><a href="advanced-miscellaneous-topics.html#cb317-2" aria-hidden="true"></a></span>
<span id="cb317-3"><a href="advanced-miscellaneous-topics.html#cb317-3" aria-hidden="true"></a>Ribba2012 &lt;-<span class="st"> </span><span class="kw">Ribba2012</span>()</span>
<span id="cb317-4"><a href="advanced-miscellaneous-topics.html#cb317-4" aria-hidden="true"></a><span class="co">### Convert to classic rxode2 model with ini attached</span></span>
<span id="cb317-5"><a href="advanced-miscellaneous-topics.html#cb317-5" aria-hidden="true"></a></span>
<span id="cb317-6"><a href="advanced-miscellaneous-topics.html#cb317-6" aria-hidden="true"></a>r &lt;-<span class="st"> </span>Ribba2012<span class="op">$</span>simulationIniModel</span>
<span id="cb317-7"><a href="advanced-miscellaneous-topics.html#cb317-7" aria-hidden="true"></a></span>
<span id="cb317-8"><a href="advanced-miscellaneous-topics.html#cb317-8" aria-hidden="true"></a>pars &lt;-<span class="st"> </span><span class="kw">rxInits</span>(r)</span>
<span id="cb317-9"><a href="advanced-miscellaneous-topics.html#cb317-9" aria-hidden="true"></a>pars &lt;-<span class="st"> </span>pars[<span class="kw">regexpr</span>(<span class="st">&quot;(prop|eta)&quot;</span>,<span class="kw">names</span>(pars)) <span class="op">==</span><span class="st"> </span><span class="dv">-1</span>]</span>
<span id="cb317-10"><a href="advanced-miscellaneous-topics.html#cb317-10" aria-hidden="true"></a><span class="kw">print</span>(pars)</span>
<span id="cb317-11"><a href="advanced-miscellaneous-topics.html#cb317-11" aria-hidden="true"></a><span class="co">#&gt;           k        tkde        tkpq       tkqpp    tlambdap      tgamma </span></span>
<span id="cb317-12"><a href="advanced-miscellaneous-topics.html#cb317-12" aria-hidden="true"></a><span class="co">#&gt;    1.00e+02    2.40e-01    2.95e-02    3.10e-03    1.21e-01    7.29e-01 </span></span>
<span id="cb317-13"><a href="advanced-miscellaneous-topics.html#cb317-13" aria-hidden="true"></a><span class="co">#&gt;    tdeltaqp        tpt0         tq0 rxerr.pstar </span></span>
<span id="cb317-14"><a href="advanced-miscellaneous-topics.html#cb317-14" aria-hidden="true"></a><span class="co">#&gt;    8.67e-03    7.13e+00    4.12e+01    1.00e+00</span></span>
<span id="cb317-15"><a href="advanced-miscellaneous-topics.html#cb317-15" aria-hidden="true"></a><span class="co">#### This is the exported method for simulation of Theta/Omega internally in rxode2</span></span>
<span id="cb317-16"><a href="advanced-miscellaneous-topics.html#cb317-16" aria-hidden="true"></a>df &lt;-<span class="st"> </span><span class="kw">rxSimThetaOmega</span>(<span class="dt">params=</span>pars, <span class="dt">omega=</span>omega,<span class="dt">dfSub=</span><span class="dv">760</span>,</span>
<span id="cb317-17"><a href="advanced-miscellaneous-topics.html#cb317-17" aria-hidden="true"></a>                      <span class="dt">thetaMat=</span>thetaMat, <span class="dt">thetaLower=</span><span class="dv">0</span>, <span class="dt">nSub=</span><span class="dv">60</span>,<span class="dt">nStud=</span><span class="dv">60</span>) <span class="op">%&gt;%</span></span>
<span id="cb317-18"><a href="advanced-miscellaneous-topics.html#cb317-18" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(tkde <span class="op">&gt;</span><span class="st"> </span>tlambdap) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span>
<span id="cb317-19"><a href="advanced-miscellaneous-topics.html#cb317-19" aria-hidden="true"></a><span class="co">#### You could also simulate more and bind them together to a data frame.</span></span>
<span id="cb317-20"><a href="advanced-miscellaneous-topics.html#cb317-20" aria-hidden="true"></a><span class="kw">print</span>(df)</span>
<span id="cb317-21"><a href="advanced-miscellaneous-topics.html#cb317-21" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 2,280 x 17</span></span>
<span id="cb317-22"><a href="advanced-miscellaneous-topics.html#cb317-22" aria-hidden="true"></a><span class="co">#&gt;        k  tkde   tkpq tkqpp tlambdap tgamma tdeltaqp  tpt0   tq0 rxerr.pstar</span></span>
<span id="cb317-23"><a href="advanced-miscellaneous-topics.html#cb317-23" aria-hidden="true"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb317-24"><a href="advanced-miscellaneous-topics.html#cb317-24" aria-hidden="true"></a><span class="co">#&gt;  1   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-25"><a href="advanced-miscellaneous-topics.html#cb317-25" aria-hidden="true"></a><span class="co">#&gt;  2   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-26"><a href="advanced-miscellaneous-topics.html#cb317-26" aria-hidden="true"></a><span class="co">#&gt;  3   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-27"><a href="advanced-miscellaneous-topics.html#cb317-27" aria-hidden="true"></a><span class="co">#&gt;  4   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-28"><a href="advanced-miscellaneous-topics.html#cb317-28" aria-hidden="true"></a><span class="co">#&gt;  5   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-29"><a href="advanced-miscellaneous-topics.html#cb317-29" aria-hidden="true"></a><span class="co">#&gt;  6   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-30"><a href="advanced-miscellaneous-topics.html#cb317-30" aria-hidden="true"></a><span class="co">#&gt;  7   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-31"><a href="advanced-miscellaneous-topics.html#cb317-31" aria-hidden="true"></a><span class="co">#&gt;  8   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-32"><a href="advanced-miscellaneous-topics.html#cb317-32" aria-hidden="true"></a><span class="co">#&gt;  9   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-33"><a href="advanced-miscellaneous-topics.html#cb317-33" aria-hidden="true"></a><span class="co">#&gt; 10   100  2.98 0.0295  1.09     1.83   1.19     1.61  7.40  41.8           1</span></span>
<span id="cb317-34"><a href="advanced-miscellaneous-topics.html#cb317-34" aria-hidden="true"></a><span class="co">#&gt; # i 2,270 more rows</span></span>
<span id="cb317-35"><a href="advanced-miscellaneous-topics.html#cb317-35" aria-hidden="true"></a><span class="co">#&gt; # i 7 more variables: eta.pt0 &lt;dbl&gt;, eta.q0 &lt;dbl&gt;, eta.lambdap &lt;dbl&gt;,</span></span>
<span id="cb317-36"><a href="advanced-miscellaneous-topics.html#cb317-36" aria-hidden="true"></a><span class="co">#&gt; #   eta.kqp &lt;dbl&gt;, eta.kqpp &lt;dbl&gt;, eta.deltaqp &lt;dbl&gt;, eta.tkde &lt;dbl&gt;</span></span>
<span id="cb317-37"><a href="advanced-miscellaneous-topics.html#cb317-37" aria-hidden="true"></a><span class="co">#### Quick check to make sure that all the parameters are OK.</span></span>
<span id="cb317-38"><a href="advanced-miscellaneous-topics.html#cb317-38" aria-hidden="true"></a><span class="kw">all</span>(df<span class="op">$</span>tkde<span class="op">&gt;</span>df<span class="op">$</span>tlambdap)</span>
<span id="cb317-39"><a href="advanced-miscellaneous-topics.html#cb317-39" aria-hidden="true"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb317-40"><a href="advanced-miscellaneous-topics.html#cb317-40" aria-hidden="true"></a>sim1 &lt;-<span class="st"> </span>r <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Use rxode2</span></span>
<span id="cb317-41"><a href="advanced-miscellaneous-topics.html#cb317-41" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">time.units=</span><span class="st">&quot;months&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Pipe to a new event table</span></span>
<span id="cb317-42"><a href="advanced-miscellaneous-topics.html#cb317-42" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">1</span>, <span class="dt">time=</span><span class="dv">50</span>, <span class="dt">until=</span><span class="dv">58</span>, <span class="dt">ii=</span><span class="fl">1.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add dosing every 1.5 months</span></span>
<span id="cb317-43"><a href="advanced-miscellaneous-topics.html#cb317-43" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dt">by=</span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add some sampling times (not required)</span></span>
<span id="cb317-44"><a href="advanced-miscellaneous-topics.html#cb317-44" aria-hidden="true"></a><span class="st">    </span><span class="kw">rxSolve</span>(df)</span>
<span id="cb317-45"><a href="advanced-miscellaneous-topics.html#cb317-45" aria-hidden="true"></a><span class="co">#### Note this information looses information about which ID is in a</span></span>
<span id="cb317-46"><a href="advanced-miscellaneous-topics.html#cb317-46" aria-hidden="true"></a><span class="co">#### &quot;study&quot;, so it summarizes the confidence intervals by dividing the</span></span>
<span id="cb317-47"><a href="advanced-miscellaneous-topics.html#cb317-47" aria-hidden="true"></a><span class="co">#### subjects into sqrt(#subjects) subjects and then summarizes the</span></span>
<span id="cb317-48"><a href="advanced-miscellaneous-topics.html#cb317-48" aria-hidden="true"></a><span class="co">#### confidence intervals</span></span>
<span id="cb317-49"><a href="advanced-miscellaneous-topics.html#cb317-49" aria-hidden="true"></a>sim2 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">confint</span>(<span class="kw">c</span>(<span class="st">&quot;pt&quot;</span>,<span class="st">&quot;q&quot;</span>,<span class="st">&quot;qp&quot;</span>,<span class="st">&quot;sim&quot;</span>),<span class="dt">level=</span><span class="fl">0.90</span>); <span class="co"># Create Simulation intervals</span></span>
<span id="cb317-50"><a href="advanced-miscellaneous-topics.html#cb317-50" aria-hidden="true"></a><span class="kw">save</span>(sim2, <span class="dt">file =</span> <span class="kw">file.path</span>(<span class="kw">system.file</span>(<span class="dt">package =</span> <span class="st">&quot;rxode2&quot;</span>), <span class="st">&quot;pipeline-sim2.rds&quot;</span>), <span class="dt">version =</span> <span class="dv">2</span>)</span>
<span id="cb317-51"><a href="advanced-miscellaneous-topics.html#cb317-51" aria-hidden="true"></a>sim2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>()</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-134-1.png" width="100%" /></p>
</div>
</div>
</div>
<div id="speeding-up-rxode2" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Speeding up rxode2<a href="advanced-miscellaneous-topics.html#speeding-up-rxode2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="a-note-about-the-speed-of-the-functional-form-for-rxode2" class="section level3 hasAnchor" number="13.4.1">
<h3><span class="header-section-number">13.4.1</span> A note about the speed of the functional form for rxode2<a href="advanced-miscellaneous-topics.html#a-note-about-the-speed-of-the-functional-form-for-rxode2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The functional form has the benefit that it is what is supported by
nlmixr2 and therefore there is only one interface between solving and
estimating, and it takes some computation time to get to the
underlying “classic” simulation code.</p>
<p>These models are in the form of:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="advanced-miscellaneous-topics.html#cb318-1" aria-hidden="true"></a><span class="kw">library</span>(rxode2)</span>
<span id="cb318-2"><a href="advanced-miscellaneous-topics.html#cb318-2" aria-hidden="true"></a></span>
<span id="cb318-3"><a href="advanced-miscellaneous-topics.html#cb318-3" aria-hidden="true"></a>mod1 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb318-4"><a href="advanced-miscellaneous-topics.html#cb318-4" aria-hidden="true"></a>  <span class="kw">ini</span>({</span>
<span id="cb318-5"><a href="advanced-miscellaneous-topics.html#cb318-5" aria-hidden="true"></a>    KA   &lt;-<span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb318-6"><a href="advanced-miscellaneous-topics.html#cb318-6" aria-hidden="true"></a>    CL   &lt;-<span class="st"> </span><span class="dv">7</span></span>
<span id="cb318-7"><a href="advanced-miscellaneous-topics.html#cb318-7" aria-hidden="true"></a>    V2   &lt;-<span class="st"> </span><span class="dv">40</span></span>
<span id="cb318-8"><a href="advanced-miscellaneous-topics.html#cb318-8" aria-hidden="true"></a>    Q    &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb318-9"><a href="advanced-miscellaneous-topics.html#cb318-9" aria-hidden="true"></a>    V3   &lt;-<span class="st"> </span><span class="dv">300</span></span>
<span id="cb318-10"><a href="advanced-miscellaneous-topics.html#cb318-10" aria-hidden="true"></a>    Kin  &lt;-<span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb318-11"><a href="advanced-miscellaneous-topics.html#cb318-11" aria-hidden="true"></a>    Kout &lt;-<span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb318-12"><a href="advanced-miscellaneous-topics.html#cb318-12" aria-hidden="true"></a>    EC50 &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb318-13"><a href="advanced-miscellaneous-topics.html#cb318-13" aria-hidden="true"></a>  })</span>
<span id="cb318-14"><a href="advanced-miscellaneous-topics.html#cb318-14" aria-hidden="true"></a>  <span class="kw">model</span>({</span>
<span id="cb318-15"><a href="advanced-miscellaneous-topics.html#cb318-15" aria-hidden="true"></a>    C2 =<span class="st"> </span>centr<span class="op">/</span>V2</span>
<span id="cb318-16"><a href="advanced-miscellaneous-topics.html#cb318-16" aria-hidden="true"></a>    C3 =<span class="st"> </span>peri<span class="op">/</span>V3</span>
<span id="cb318-17"><a href="advanced-miscellaneous-topics.html#cb318-17" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(depot) =<span class="st"> </span><span class="op">-</span>KA<span class="op">*</span>depot</span>
<span id="cb318-18"><a href="advanced-miscellaneous-topics.html#cb318-18" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(centr) =<span class="st"> </span>KA<span class="op">*</span>depot <span class="op">-</span><span class="st"> </span>CL<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">+</span><span class="st"> </span>Q<span class="op">*</span>C3</span>
<span id="cb318-19"><a href="advanced-miscellaneous-topics.html#cb318-19" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(peri) =<span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C3</span>
<span id="cb318-20"><a href="advanced-miscellaneous-topics.html#cb318-20" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(eff) =<span class="st"> </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff</span>
<span id="cb318-21"><a href="advanced-miscellaneous-topics.html#cb318-21" aria-hidden="true"></a>    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb318-22"><a href="advanced-miscellaneous-topics.html#cb318-22" aria-hidden="true"></a>  }) </span>
<span id="cb318-23"><a href="advanced-miscellaneous-topics.html#cb318-23" aria-hidden="true"></a>}</span></code></pre></div>
<p>Or you can also specify the end-points for simulation/estimation just
like <code>nlmixr2</code>:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="advanced-miscellaneous-topics.html#cb319-1" aria-hidden="true"></a>mod2 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb319-2"><a href="advanced-miscellaneous-topics.html#cb319-2" aria-hidden="true"></a>  <span class="kw">ini</span>({</span>
<span id="cb319-3"><a href="advanced-miscellaneous-topics.html#cb319-3" aria-hidden="true"></a>    TKA   &lt;-<span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb319-4"><a href="advanced-miscellaneous-topics.html#cb319-4" aria-hidden="true"></a>    TCL   &lt;-<span class="st"> </span><span class="dv">7</span></span>
<span id="cb319-5"><a href="advanced-miscellaneous-topics.html#cb319-5" aria-hidden="true"></a>    TV2   &lt;-<span class="st"> </span><span class="dv">40</span></span>
<span id="cb319-6"><a href="advanced-miscellaneous-topics.html#cb319-6" aria-hidden="true"></a>    TQ    &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb319-7"><a href="advanced-miscellaneous-topics.html#cb319-7" aria-hidden="true"></a>    TV3   &lt;-<span class="st"> </span><span class="dv">300</span></span>
<span id="cb319-8"><a href="advanced-miscellaneous-topics.html#cb319-8" aria-hidden="true"></a>    TKin  &lt;-<span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb319-9"><a href="advanced-miscellaneous-topics.html#cb319-9" aria-hidden="true"></a>    TKout &lt;-<span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb319-10"><a href="advanced-miscellaneous-topics.html#cb319-10" aria-hidden="true"></a>    TEC50 &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb319-11"><a href="advanced-miscellaneous-topics.html#cb319-11" aria-hidden="true"></a>    eta.cl <span class="op">+</span><span class="st"> </span>eta.v <span class="op">~</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">0.09</span>,</span>
<span id="cb319-12"><a href="advanced-miscellaneous-topics.html#cb319-12" aria-hidden="true"></a>                       <span class="fl">0.08</span>, <span class="fl">0.25</span>)</span>
<span id="cb319-13"><a href="advanced-miscellaneous-topics.html#cb319-13" aria-hidden="true"></a>    c2.prop.sd &lt;-<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb319-14"><a href="advanced-miscellaneous-topics.html#cb319-14" aria-hidden="true"></a>    eff.add.sd &lt;-<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb319-15"><a href="advanced-miscellaneous-topics.html#cb319-15" aria-hidden="true"></a>  })</span>
<span id="cb319-16"><a href="advanced-miscellaneous-topics.html#cb319-16" aria-hidden="true"></a>  <span class="kw">model</span>({</span>
<span id="cb319-17"><a href="advanced-miscellaneous-topics.html#cb319-17" aria-hidden="true"></a>    KA &lt;-<span class="st"> </span>TKA   </span>
<span id="cb319-18"><a href="advanced-miscellaneous-topics.html#cb319-18" aria-hidden="true"></a>    CL &lt;-<span class="st"> </span>TCL<span class="op">*</span><span class="kw">exp</span>(eta.cl)</span>
<span id="cb319-19"><a href="advanced-miscellaneous-topics.html#cb319-19" aria-hidden="true"></a>    V2  &lt;-<span class="st"> </span>TV2<span class="op">*</span><span class="kw">exp</span>(eta.v)</span>
<span id="cb319-20"><a href="advanced-miscellaneous-topics.html#cb319-20" aria-hidden="true"></a>    Q   &lt;-<span class="st"> </span>TQ</span>
<span id="cb319-21"><a href="advanced-miscellaneous-topics.html#cb319-21" aria-hidden="true"></a>    V3  &lt;-<span class="st"> </span>TV3</span>
<span id="cb319-22"><a href="advanced-miscellaneous-topics.html#cb319-22" aria-hidden="true"></a>    Kin  &lt;-<span class="st"> </span>TKin</span>
<span id="cb319-23"><a href="advanced-miscellaneous-topics.html#cb319-23" aria-hidden="true"></a>    Kout &lt;-<span class="st"> </span>TKout</span>
<span id="cb319-24"><a href="advanced-miscellaneous-topics.html#cb319-24" aria-hidden="true"></a>    EC50 &lt;-<span class="st"> </span>TEC50</span>
<span id="cb319-25"><a href="advanced-miscellaneous-topics.html#cb319-25" aria-hidden="true"></a>    C2 =<span class="st"> </span>centr<span class="op">/</span>V2</span>
<span id="cb319-26"><a href="advanced-miscellaneous-topics.html#cb319-26" aria-hidden="true"></a>    C3 =<span class="st"> </span>peri<span class="op">/</span>V3</span>
<span id="cb319-27"><a href="advanced-miscellaneous-topics.html#cb319-27" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(depot) =<span class="st"> </span><span class="op">-</span>KA<span class="op">*</span>depot</span>
<span id="cb319-28"><a href="advanced-miscellaneous-topics.html#cb319-28" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(centr) =<span class="st"> </span>KA<span class="op">*</span>depot <span class="op">-</span><span class="st"> </span>CL<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">+</span><span class="st"> </span>Q<span class="op">*</span>C3</span>
<span id="cb319-29"><a href="advanced-miscellaneous-topics.html#cb319-29" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(peri) =<span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C3</span>
<span id="cb319-30"><a href="advanced-miscellaneous-topics.html#cb319-30" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(eff) =<span class="st"> </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff</span>
<span id="cb319-31"><a href="advanced-miscellaneous-topics.html#cb319-31" aria-hidden="true"></a>    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb319-32"><a href="advanced-miscellaneous-topics.html#cb319-32" aria-hidden="true"></a>    C2 <span class="op">~</span><span class="st"> </span><span class="kw">prop</span>(c2.prop.sd)</span>
<span id="cb319-33"><a href="advanced-miscellaneous-topics.html#cb319-33" aria-hidden="true"></a>    eff <span class="op">~</span><span class="st"> </span><span class="kw">add</span>(eff.add.sd)</span>
<span id="cb319-34"><a href="advanced-miscellaneous-topics.html#cb319-34" aria-hidden="true"></a>  }) </span>
<span id="cb319-35"><a href="advanced-miscellaneous-topics.html#cb319-35" aria-hidden="true"></a>}</span></code></pre></div>
<p>For every solve, there is a compile (or a cached compile) of the
underlying model. If you wish to speed this process up you can use
the two underlying <code>rxode2</code> classic models. This takes two steps:</p>
<ul>
<li><p>Parsing/evaluating the model</p></li>
<li><p>Creating the simulation model</p></li>
</ul>
<p>The first step can be done by <code>rxode2(mod1)</code> or <code>mod1()</code> (or for the second model too).</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="advanced-miscellaneous-topics.html#cb320-1" aria-hidden="true"></a>mod1 &lt;-<span class="st"> </span><span class="kw">mod1</span>()</span>
<span id="cb320-2"><a href="advanced-miscellaneous-topics.html#cb320-2" aria-hidden="true"></a>mod2 &lt;-<span class="st"> </span><span class="kw">rxode2</span>(mod2)</span></code></pre></div>
<p>The second step is to create the underlying “classic” <code>rxode2</code> model,
which can be done with two different methods:<code>$simulationModel</code> and
<code>$simulationIniModel</code>. The <code>$simulationModel</code> will provide the
simulation code without the initial conditions pre-pended, the
<code>$simulationIniModel</code> will pre-pend the values. When the endpoints
are specified, the simulation code for each endpoint is also output.
You can see the differences below:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="advanced-miscellaneous-topics.html#cb321-1" aria-hidden="true"></a><span class="kw">summary</span>(mod1<span class="op">$</span>simulationModel)</span>
<span id="cb321-2"><a href="advanced-miscellaneous-topics.html#cb321-2" aria-hidden="true"></a><span class="co">#&gt; rxode2 2.0.13.9000 model named rx_a494135736b19051a1ab9bccf8fb694c model (ready). </span></span>
<span id="cb321-3"><a href="advanced-miscellaneous-topics.html#cb321-3" aria-hidden="true"></a><span class="co">#&gt; DLL: /tmp/RtmpbXPxP7/rxode2/rx_a494135736b19051a1ab9bccf8fb694c__.rxd/rx_a494135736b19051a1ab9bccf8fb694c_.so</span></span>
<span id="cb321-4"><a href="advanced-miscellaneous-topics.html#cb321-4" aria-hidden="true"></a><span class="co">#&gt; NULL</span></span>
<span id="cb321-5"><a href="advanced-miscellaneous-topics.html#cb321-5" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb321-6"><a href="advanced-miscellaneous-topics.html#cb321-6" aria-hidden="true"></a><span class="co">#&gt; Calculated Variables:</span></span>
<span id="cb321-7"><a href="advanced-miscellaneous-topics.html#cb321-7" aria-hidden="true"></a><span class="co">#&gt; [1] &quot;C2&quot; &quot;C3&quot;</span></span>
<span id="cb321-8"><a href="advanced-miscellaneous-topics.html#cb321-8" aria-hidden="true"></a><span class="co">#&gt; -- rxode2 Model Syntax --</span></span>
<span id="cb321-9"><a href="advanced-miscellaneous-topics.html#cb321-9" aria-hidden="true"></a><span class="co">#&gt; rxode2({</span></span>
<span id="cb321-10"><a href="advanced-miscellaneous-topics.html#cb321-10" aria-hidden="true"></a><span class="co">#&gt;     param(KA, CL, V2, Q, V3, Kin, Kout, EC50)</span></span>
<span id="cb321-11"><a href="advanced-miscellaneous-topics.html#cb321-11" aria-hidden="true"></a><span class="co">#&gt;     C2 = centr/V2</span></span>
<span id="cb321-12"><a href="advanced-miscellaneous-topics.html#cb321-12" aria-hidden="true"></a><span class="co">#&gt;     C3 = peri/V3</span></span>
<span id="cb321-13"><a href="advanced-miscellaneous-topics.html#cb321-13" aria-hidden="true"></a><span class="co">#&gt;     d/dt(depot) = -KA * depot</span></span>
<span id="cb321-14"><a href="advanced-miscellaneous-topics.html#cb321-14" aria-hidden="true"></a><span class="co">#&gt;     d/dt(centr) = KA * depot - CL * C2 - Q * C2 + Q * C3</span></span>
<span id="cb321-15"><a href="advanced-miscellaneous-topics.html#cb321-15" aria-hidden="true"></a><span class="co">#&gt;     d/dt(peri) = Q * C2 - Q * C3</span></span>
<span id="cb321-16"><a href="advanced-miscellaneous-topics.html#cb321-16" aria-hidden="true"></a><span class="co">#&gt;     d/dt(eff) = Kin - Kout * (1 - C2/(EC50 + C2)) * eff</span></span>
<span id="cb321-17"><a href="advanced-miscellaneous-topics.html#cb321-17" aria-hidden="true"></a><span class="co">#&gt;     eff(0) = 1</span></span>
<span id="cb321-18"><a href="advanced-miscellaneous-topics.html#cb321-18" aria-hidden="true"></a><span class="co">#&gt; })</span></span>
<span id="cb321-19"><a href="advanced-miscellaneous-topics.html#cb321-19" aria-hidden="true"></a><span class="kw">summary</span>(mod1<span class="op">$</span>simulationIniModel)</span>
<span id="cb321-20"><a href="advanced-miscellaneous-topics.html#cb321-20" aria-hidden="true"></a><span class="co">#&gt; rxode2 2.0.13.9000 model named rx_e8a4518d378b3595346005616a2c2d3f model (ready). </span></span>
<span id="cb321-21"><a href="advanced-miscellaneous-topics.html#cb321-21" aria-hidden="true"></a><span class="co">#&gt; DLL: /tmp/RtmpbXPxP7/rxode2/rx_e8a4518d378b3595346005616a2c2d3f__.rxd/rx_e8a4518d378b3595346005616a2c2d3f_.so</span></span>
<span id="cb321-22"><a href="advanced-miscellaneous-topics.html#cb321-22" aria-hidden="true"></a><span class="co">#&gt; NULL</span></span>
<span id="cb321-23"><a href="advanced-miscellaneous-topics.html#cb321-23" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb321-24"><a href="advanced-miscellaneous-topics.html#cb321-24" aria-hidden="true"></a><span class="co">#&gt; Calculated Variables:</span></span>
<span id="cb321-25"><a href="advanced-miscellaneous-topics.html#cb321-25" aria-hidden="true"></a><span class="co">#&gt; [1] &quot;C2&quot; &quot;C3&quot;</span></span>
<span id="cb321-26"><a href="advanced-miscellaneous-topics.html#cb321-26" aria-hidden="true"></a><span class="co">#&gt; -- rxode2 Model Syntax --</span></span>
<span id="cb321-27"><a href="advanced-miscellaneous-topics.html#cb321-27" aria-hidden="true"></a><span class="co">#&gt; rxode2({</span></span>
<span id="cb321-28"><a href="advanced-miscellaneous-topics.html#cb321-28" aria-hidden="true"></a><span class="co">#&gt;     param(KA, CL, V2, Q, V3, Kin, Kout, EC50)</span></span>
<span id="cb321-29"><a href="advanced-miscellaneous-topics.html#cb321-29" aria-hidden="true"></a><span class="co">#&gt;     KA = 0.3</span></span>
<span id="cb321-30"><a href="advanced-miscellaneous-topics.html#cb321-30" aria-hidden="true"></a><span class="co">#&gt;     CL = 7</span></span>
<span id="cb321-31"><a href="advanced-miscellaneous-topics.html#cb321-31" aria-hidden="true"></a><span class="co">#&gt;     V2 = 40</span></span>
<span id="cb321-32"><a href="advanced-miscellaneous-topics.html#cb321-32" aria-hidden="true"></a><span class="co">#&gt;     Q = 10</span></span>
<span id="cb321-33"><a href="advanced-miscellaneous-topics.html#cb321-33" aria-hidden="true"></a><span class="co">#&gt;     V3 = 300</span></span>
<span id="cb321-34"><a href="advanced-miscellaneous-topics.html#cb321-34" aria-hidden="true"></a><span class="co">#&gt;     Kin = 0.2</span></span>
<span id="cb321-35"><a href="advanced-miscellaneous-topics.html#cb321-35" aria-hidden="true"></a><span class="co">#&gt;     Kout = 0.2</span></span>
<span id="cb321-36"><a href="advanced-miscellaneous-topics.html#cb321-36" aria-hidden="true"></a><span class="co">#&gt;     EC50 = 8</span></span>
<span id="cb321-37"><a href="advanced-miscellaneous-topics.html#cb321-37" aria-hidden="true"></a><span class="co">#&gt;     C2 = centr/V2</span></span>
<span id="cb321-38"><a href="advanced-miscellaneous-topics.html#cb321-38" aria-hidden="true"></a><span class="co">#&gt;     C3 = peri/V3</span></span>
<span id="cb321-39"><a href="advanced-miscellaneous-topics.html#cb321-39" aria-hidden="true"></a><span class="co">#&gt;     d/dt(depot) = -KA * depot</span></span>
<span id="cb321-40"><a href="advanced-miscellaneous-topics.html#cb321-40" aria-hidden="true"></a><span class="co">#&gt;     d/dt(centr) = KA * depot - CL * C2 - Q * C2 + Q * C3</span></span>
<span id="cb321-41"><a href="advanced-miscellaneous-topics.html#cb321-41" aria-hidden="true"></a><span class="co">#&gt;     d/dt(peri) = Q * C2 - Q * C3</span></span>
<span id="cb321-42"><a href="advanced-miscellaneous-topics.html#cb321-42" aria-hidden="true"></a><span class="co">#&gt;     d/dt(eff) = Kin - Kout * (1 - C2/(EC50 + C2)) * eff</span></span>
<span id="cb321-43"><a href="advanced-miscellaneous-topics.html#cb321-43" aria-hidden="true"></a><span class="co">#&gt;     eff(0) = 1</span></span>
<span id="cb321-44"><a href="advanced-miscellaneous-topics.html#cb321-44" aria-hidden="true"></a><span class="co">#&gt; })</span></span>
<span id="cb321-45"><a href="advanced-miscellaneous-topics.html#cb321-45" aria-hidden="true"></a><span class="kw">summary</span>(mod2<span class="op">$</span>simulationModel)</span>
<span id="cb321-46"><a href="advanced-miscellaneous-topics.html#cb321-46" aria-hidden="true"></a><span class="co">#&gt; rxode2 2.0.13.9000 model named rx_8c827ffb58fffede046fd8aa03787f1f model (ready). </span></span>
<span id="cb321-47"><a href="advanced-miscellaneous-topics.html#cb321-47" aria-hidden="true"></a><span class="co">#&gt; DLL: /tmp/RtmpbXPxP7/rxode2/rx_8c827ffb58fffede046fd8aa03787f1f__.rxd/rx_8c827ffb58fffede046fd8aa03787f1f_.so</span></span>
<span id="cb321-48"><a href="advanced-miscellaneous-topics.html#cb321-48" aria-hidden="true"></a><span class="co">#&gt; NULL</span></span>
<span id="cb321-49"><a href="advanced-miscellaneous-topics.html#cb321-49" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb321-50"><a href="advanced-miscellaneous-topics.html#cb321-50" aria-hidden="true"></a><span class="co">#&gt; Calculated Variables:</span></span>
<span id="cb321-51"><a href="advanced-miscellaneous-topics.html#cb321-51" aria-hidden="true"></a><span class="co">#&gt;  [1] &quot;KA&quot;       &quot;CL&quot;       &quot;V2&quot;       &quot;Q&quot;        &quot;V3&quot;       &quot;Kin&quot;     </span></span>
<span id="cb321-52"><a href="advanced-miscellaneous-topics.html#cb321-52" aria-hidden="true"></a><span class="co">#&gt;  [7] &quot;Kout&quot;     &quot;EC50&quot;     &quot;C2&quot;       &quot;C3&quot;       &quot;ipredSim&quot; &quot;sim&quot;     </span></span>
<span id="cb321-53"><a href="advanced-miscellaneous-topics.html#cb321-53" aria-hidden="true"></a><span class="co">#&gt; -- rxode2 Model Syntax --</span></span>
<span id="cb321-54"><a href="advanced-miscellaneous-topics.html#cb321-54" aria-hidden="true"></a><span class="co">#&gt; rxode2({</span></span>
<span id="cb321-55"><a href="advanced-miscellaneous-topics.html#cb321-55" aria-hidden="true"></a><span class="co">#&gt;     param(TKA, TCL, TV2, TQ, TV3, TKin, TKout, TEC50, c2.prop.sd, </span></span>
<span id="cb321-56"><a href="advanced-miscellaneous-topics.html#cb321-56" aria-hidden="true"></a><span class="co">#&gt;         eff.add.sd, eta.cl, eta.v)</span></span>
<span id="cb321-57"><a href="advanced-miscellaneous-topics.html#cb321-57" aria-hidden="true"></a><span class="co">#&gt;     KA = TKA</span></span>
<span id="cb321-58"><a href="advanced-miscellaneous-topics.html#cb321-58" aria-hidden="true"></a><span class="co">#&gt;     CL = TCL * exp(eta.cl)</span></span>
<span id="cb321-59"><a href="advanced-miscellaneous-topics.html#cb321-59" aria-hidden="true"></a><span class="co">#&gt;     V2 = TV2 * exp(eta.v)</span></span>
<span id="cb321-60"><a href="advanced-miscellaneous-topics.html#cb321-60" aria-hidden="true"></a><span class="co">#&gt;     Q = TQ</span></span>
<span id="cb321-61"><a href="advanced-miscellaneous-topics.html#cb321-61" aria-hidden="true"></a><span class="co">#&gt;     V3 = TV3</span></span>
<span id="cb321-62"><a href="advanced-miscellaneous-topics.html#cb321-62" aria-hidden="true"></a><span class="co">#&gt;     Kin = TKin</span></span>
<span id="cb321-63"><a href="advanced-miscellaneous-topics.html#cb321-63" aria-hidden="true"></a><span class="co">#&gt;     Kout = TKout</span></span>
<span id="cb321-64"><a href="advanced-miscellaneous-topics.html#cb321-64" aria-hidden="true"></a><span class="co">#&gt;     EC50 = TEC50</span></span>
<span id="cb321-65"><a href="advanced-miscellaneous-topics.html#cb321-65" aria-hidden="true"></a><span class="co">#&gt;     C2 = centr/V2</span></span>
<span id="cb321-66"><a href="advanced-miscellaneous-topics.html#cb321-66" aria-hidden="true"></a><span class="co">#&gt;     C3 = peri/V3</span></span>
<span id="cb321-67"><a href="advanced-miscellaneous-topics.html#cb321-67" aria-hidden="true"></a><span class="co">#&gt;     d/dt(depot) = -KA * depot</span></span>
<span id="cb321-68"><a href="advanced-miscellaneous-topics.html#cb321-68" aria-hidden="true"></a><span class="co">#&gt;     d/dt(centr) = KA * depot - CL * C2 - Q * C2 + Q * C3</span></span>
<span id="cb321-69"><a href="advanced-miscellaneous-topics.html#cb321-69" aria-hidden="true"></a><span class="co">#&gt;     d/dt(peri) = Q * C2 - Q * C3</span></span>
<span id="cb321-70"><a href="advanced-miscellaneous-topics.html#cb321-70" aria-hidden="true"></a><span class="co">#&gt;     d/dt(eff) = Kin - Kout * (1 - C2/(EC50 + C2)) * eff</span></span>
<span id="cb321-71"><a href="advanced-miscellaneous-topics.html#cb321-71" aria-hidden="true"></a><span class="co">#&gt;     eff(0) = 1</span></span>
<span id="cb321-72"><a href="advanced-miscellaneous-topics.html#cb321-72" aria-hidden="true"></a><span class="co">#&gt;     if (CMT == 5) {</span></span>
<span id="cb321-73"><a href="advanced-miscellaneous-topics.html#cb321-73" aria-hidden="true"></a><span class="co">#&gt;         rx_yj_ ~ 2</span></span>
<span id="cb321-74"><a href="advanced-miscellaneous-topics.html#cb321-74" aria-hidden="true"></a><span class="co">#&gt;         rx_lambda_ ~ 1</span></span>
<span id="cb321-75"><a href="advanced-miscellaneous-topics.html#cb321-75" aria-hidden="true"></a><span class="co">#&gt;         rx_low_ ~ 0</span></span>
<span id="cb321-76"><a href="advanced-miscellaneous-topics.html#cb321-76" aria-hidden="true"></a><span class="co">#&gt;         rx_hi_ ~ 1</span></span>
<span id="cb321-77"><a href="advanced-miscellaneous-topics.html#cb321-77" aria-hidden="true"></a><span class="co">#&gt;         rx_pred_f_ ~ C2</span></span>
<span id="cb321-78"><a href="advanced-miscellaneous-topics.html#cb321-78" aria-hidden="true"></a><span class="co">#&gt;         rx_pred_ ~ rx_pred_f_</span></span>
<span id="cb321-79"><a href="advanced-miscellaneous-topics.html#cb321-79" aria-hidden="true"></a><span class="co">#&gt;         rx_r_ ~ (rx_pred_f_ * c2.prop.sd)^2</span></span>
<span id="cb321-80"><a href="advanced-miscellaneous-topics.html#cb321-80" aria-hidden="true"></a><span class="co">#&gt;         ipredSim = rxTBSi(rx_pred_, rx_lambda_, rx_yj_, rx_low_, </span></span>
<span id="cb321-81"><a href="advanced-miscellaneous-topics.html#cb321-81" aria-hidden="true"></a><span class="co">#&gt;             rx_hi_)</span></span>
<span id="cb321-82"><a href="advanced-miscellaneous-topics.html#cb321-82" aria-hidden="true"></a><span class="co">#&gt;         sim = rxTBSi(rx_pred_ + sqrt(rx_r_) * rxerr.C2, rx_lambda_, </span></span>
<span id="cb321-83"><a href="advanced-miscellaneous-topics.html#cb321-83" aria-hidden="true"></a><span class="co">#&gt;             rx_yj_, rx_low_, rx_hi_)</span></span>
<span id="cb321-84"><a href="advanced-miscellaneous-topics.html#cb321-84" aria-hidden="true"></a><span class="co">#&gt;     }</span></span>
<span id="cb321-85"><a href="advanced-miscellaneous-topics.html#cb321-85" aria-hidden="true"></a><span class="co">#&gt;     if (CMT == 4) {</span></span>
<span id="cb321-86"><a href="advanced-miscellaneous-topics.html#cb321-86" aria-hidden="true"></a><span class="co">#&gt;         rx_yj_ ~ 2</span></span>
<span id="cb321-87"><a href="advanced-miscellaneous-topics.html#cb321-87" aria-hidden="true"></a><span class="co">#&gt;         rx_lambda_ ~ 1</span></span>
<span id="cb321-88"><a href="advanced-miscellaneous-topics.html#cb321-88" aria-hidden="true"></a><span class="co">#&gt;         rx_low_ ~ 0</span></span>
<span id="cb321-89"><a href="advanced-miscellaneous-topics.html#cb321-89" aria-hidden="true"></a><span class="co">#&gt;         rx_hi_ ~ 1</span></span>
<span id="cb321-90"><a href="advanced-miscellaneous-topics.html#cb321-90" aria-hidden="true"></a><span class="co">#&gt;         rx_pred_f_ ~ eff</span></span>
<span id="cb321-91"><a href="advanced-miscellaneous-topics.html#cb321-91" aria-hidden="true"></a><span class="co">#&gt;         rx_pred_ ~ rx_pred_f_</span></span>
<span id="cb321-92"><a href="advanced-miscellaneous-topics.html#cb321-92" aria-hidden="true"></a><span class="co">#&gt;         rx_r_ ~ (eff.add.sd)^2</span></span>
<span id="cb321-93"><a href="advanced-miscellaneous-topics.html#cb321-93" aria-hidden="true"></a><span class="co">#&gt;         ipredSim = rxTBSi(rx_pred_, rx_lambda_, rx_yj_, rx_low_, </span></span>
<span id="cb321-94"><a href="advanced-miscellaneous-topics.html#cb321-94" aria-hidden="true"></a><span class="co">#&gt;             rx_hi_)</span></span>
<span id="cb321-95"><a href="advanced-miscellaneous-topics.html#cb321-95" aria-hidden="true"></a><span class="co">#&gt;         sim = rxTBSi(rx_pred_ + sqrt(rx_r_) * rxerr.eff, rx_lambda_, </span></span>
<span id="cb321-96"><a href="advanced-miscellaneous-topics.html#cb321-96" aria-hidden="true"></a><span class="co">#&gt;             rx_yj_, rx_low_, rx_hi_)</span></span>
<span id="cb321-97"><a href="advanced-miscellaneous-topics.html#cb321-97" aria-hidden="true"></a><span class="co">#&gt;     }</span></span>
<span id="cb321-98"><a href="advanced-miscellaneous-topics.html#cb321-98" aria-hidden="true"></a><span class="co">#&gt;     cmt(C2)</span></span>
<span id="cb321-99"><a href="advanced-miscellaneous-topics.html#cb321-99" aria-hidden="true"></a><span class="co">#&gt;     dvid(5, 4)</span></span>
<span id="cb321-100"><a href="advanced-miscellaneous-topics.html#cb321-100" aria-hidden="true"></a><span class="co">#&gt; })</span></span>
<span id="cb321-101"><a href="advanced-miscellaneous-topics.html#cb321-101" aria-hidden="true"></a><span class="kw">summary</span>(mod2<span class="op">$</span>simulationIniModel)</span>
<span id="cb321-102"><a href="advanced-miscellaneous-topics.html#cb321-102" aria-hidden="true"></a><span class="co">#&gt; rxode2 2.0.13.9000 model named rx_b94547270f4dde0be08e575b3aa805d6 model (ready). </span></span>
<span id="cb321-103"><a href="advanced-miscellaneous-topics.html#cb321-103" aria-hidden="true"></a><span class="co">#&gt; DLL: /tmp/RtmpbXPxP7/rxode2/rx_b94547270f4dde0be08e575b3aa805d6__.rxd/rx_b94547270f4dde0be08e575b3aa805d6_.so</span></span>
<span id="cb321-104"><a href="advanced-miscellaneous-topics.html#cb321-104" aria-hidden="true"></a><span class="co">#&gt; NULL</span></span>
<span id="cb321-105"><a href="advanced-miscellaneous-topics.html#cb321-105" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb321-106"><a href="advanced-miscellaneous-topics.html#cb321-106" aria-hidden="true"></a><span class="co">#&gt; Calculated Variables:</span></span>
<span id="cb321-107"><a href="advanced-miscellaneous-topics.html#cb321-107" aria-hidden="true"></a><span class="co">#&gt;  [1] &quot;KA&quot;       &quot;CL&quot;       &quot;V2&quot;       &quot;Q&quot;        &quot;V3&quot;       &quot;Kin&quot;     </span></span>
<span id="cb321-108"><a href="advanced-miscellaneous-topics.html#cb321-108" aria-hidden="true"></a><span class="co">#&gt;  [7] &quot;Kout&quot;     &quot;EC50&quot;     &quot;C2&quot;       &quot;C3&quot;       &quot;ipredSim&quot; &quot;sim&quot;     </span></span>
<span id="cb321-109"><a href="advanced-miscellaneous-topics.html#cb321-109" aria-hidden="true"></a><span class="co">#&gt; -- rxode2 Model Syntax --</span></span>
<span id="cb321-110"><a href="advanced-miscellaneous-topics.html#cb321-110" aria-hidden="true"></a><span class="co">#&gt; rxode2({</span></span>
<span id="cb321-111"><a href="advanced-miscellaneous-topics.html#cb321-111" aria-hidden="true"></a><span class="co">#&gt;     param(TKA, TCL, TV2, TQ, TV3, TKin, TKout, TEC50, c2.prop.sd, </span></span>
<span id="cb321-112"><a href="advanced-miscellaneous-topics.html#cb321-112" aria-hidden="true"></a><span class="co">#&gt;         eff.add.sd, eta.cl, eta.v)</span></span>
<span id="cb321-113"><a href="advanced-miscellaneous-topics.html#cb321-113" aria-hidden="true"></a><span class="co">#&gt;     rxerr.C2 = 1</span></span>
<span id="cb321-114"><a href="advanced-miscellaneous-topics.html#cb321-114" aria-hidden="true"></a><span class="co">#&gt;     rxerr.eff = 1</span></span>
<span id="cb321-115"><a href="advanced-miscellaneous-topics.html#cb321-115" aria-hidden="true"></a><span class="co">#&gt;     TKA = 0.3</span></span>
<span id="cb321-116"><a href="advanced-miscellaneous-topics.html#cb321-116" aria-hidden="true"></a><span class="co">#&gt;     TCL = 7</span></span>
<span id="cb321-117"><a href="advanced-miscellaneous-topics.html#cb321-117" aria-hidden="true"></a><span class="co">#&gt;     TV2 = 40</span></span>
<span id="cb321-118"><a href="advanced-miscellaneous-topics.html#cb321-118" aria-hidden="true"></a><span class="co">#&gt;     TQ = 10</span></span>
<span id="cb321-119"><a href="advanced-miscellaneous-topics.html#cb321-119" aria-hidden="true"></a><span class="co">#&gt;     TV3 = 300</span></span>
<span id="cb321-120"><a href="advanced-miscellaneous-topics.html#cb321-120" aria-hidden="true"></a><span class="co">#&gt;     TKin = 0.2</span></span>
<span id="cb321-121"><a href="advanced-miscellaneous-topics.html#cb321-121" aria-hidden="true"></a><span class="co">#&gt;     TKout = 0.2</span></span>
<span id="cb321-122"><a href="advanced-miscellaneous-topics.html#cb321-122" aria-hidden="true"></a><span class="co">#&gt;     TEC50 = 8</span></span>
<span id="cb321-123"><a href="advanced-miscellaneous-topics.html#cb321-123" aria-hidden="true"></a><span class="co">#&gt;     c2.prop.sd = 0.1</span></span>
<span id="cb321-124"><a href="advanced-miscellaneous-topics.html#cb321-124" aria-hidden="true"></a><span class="co">#&gt;     eff.add.sd = 0.1</span></span>
<span id="cb321-125"><a href="advanced-miscellaneous-topics.html#cb321-125" aria-hidden="true"></a><span class="co">#&gt;     eta.cl = 0</span></span>
<span id="cb321-126"><a href="advanced-miscellaneous-topics.html#cb321-126" aria-hidden="true"></a><span class="co">#&gt;     eta.v = 0</span></span>
<span id="cb321-127"><a href="advanced-miscellaneous-topics.html#cb321-127" aria-hidden="true"></a><span class="co">#&gt;     KA = TKA</span></span>
<span id="cb321-128"><a href="advanced-miscellaneous-topics.html#cb321-128" aria-hidden="true"></a><span class="co">#&gt;     CL = TCL * exp(eta.cl)</span></span>
<span id="cb321-129"><a href="advanced-miscellaneous-topics.html#cb321-129" aria-hidden="true"></a><span class="co">#&gt;     V2 = TV2 * exp(eta.v)</span></span>
<span id="cb321-130"><a href="advanced-miscellaneous-topics.html#cb321-130" aria-hidden="true"></a><span class="co">#&gt;     Q = TQ</span></span>
<span id="cb321-131"><a href="advanced-miscellaneous-topics.html#cb321-131" aria-hidden="true"></a><span class="co">#&gt;     V3 = TV3</span></span>
<span id="cb321-132"><a href="advanced-miscellaneous-topics.html#cb321-132" aria-hidden="true"></a><span class="co">#&gt;     Kin = TKin</span></span>
<span id="cb321-133"><a href="advanced-miscellaneous-topics.html#cb321-133" aria-hidden="true"></a><span class="co">#&gt;     Kout = TKout</span></span>
<span id="cb321-134"><a href="advanced-miscellaneous-topics.html#cb321-134" aria-hidden="true"></a><span class="co">#&gt;     EC50 = TEC50</span></span>
<span id="cb321-135"><a href="advanced-miscellaneous-topics.html#cb321-135" aria-hidden="true"></a><span class="co">#&gt;     C2 = centr/V2</span></span>
<span id="cb321-136"><a href="advanced-miscellaneous-topics.html#cb321-136" aria-hidden="true"></a><span class="co">#&gt;     C3 = peri/V3</span></span>
<span id="cb321-137"><a href="advanced-miscellaneous-topics.html#cb321-137" aria-hidden="true"></a><span class="co">#&gt;     d/dt(depot) = -KA * depot</span></span>
<span id="cb321-138"><a href="advanced-miscellaneous-topics.html#cb321-138" aria-hidden="true"></a><span class="co">#&gt;     d/dt(centr) = KA * depot - CL * C2 - Q * C2 + Q * C3</span></span>
<span id="cb321-139"><a href="advanced-miscellaneous-topics.html#cb321-139" aria-hidden="true"></a><span class="co">#&gt;     d/dt(peri) = Q * C2 - Q * C3</span></span>
<span id="cb321-140"><a href="advanced-miscellaneous-topics.html#cb321-140" aria-hidden="true"></a><span class="co">#&gt;     d/dt(eff) = Kin - Kout * (1 - C2/(EC50 + C2)) * eff</span></span>
<span id="cb321-141"><a href="advanced-miscellaneous-topics.html#cb321-141" aria-hidden="true"></a><span class="co">#&gt;     eff(0) = 1</span></span>
<span id="cb321-142"><a href="advanced-miscellaneous-topics.html#cb321-142" aria-hidden="true"></a><span class="co">#&gt;     if (CMT == 5) {</span></span>
<span id="cb321-143"><a href="advanced-miscellaneous-topics.html#cb321-143" aria-hidden="true"></a><span class="co">#&gt;         rx_yj_ ~ 2</span></span>
<span id="cb321-144"><a href="advanced-miscellaneous-topics.html#cb321-144" aria-hidden="true"></a><span class="co">#&gt;         rx_lambda_ ~ 1</span></span>
<span id="cb321-145"><a href="advanced-miscellaneous-topics.html#cb321-145" aria-hidden="true"></a><span class="co">#&gt;         rx_low_ ~ 0</span></span>
<span id="cb321-146"><a href="advanced-miscellaneous-topics.html#cb321-146" aria-hidden="true"></a><span class="co">#&gt;         rx_hi_ ~ 1</span></span>
<span id="cb321-147"><a href="advanced-miscellaneous-topics.html#cb321-147" aria-hidden="true"></a><span class="co">#&gt;         rx_pred_f_ ~ C2</span></span>
<span id="cb321-148"><a href="advanced-miscellaneous-topics.html#cb321-148" aria-hidden="true"></a><span class="co">#&gt;         rx_pred_ ~ rx_pred_f_</span></span>
<span id="cb321-149"><a href="advanced-miscellaneous-topics.html#cb321-149" aria-hidden="true"></a><span class="co">#&gt;         rx_r_ ~ (rx_pred_f_ * c2.prop.sd)^2</span></span>
<span id="cb321-150"><a href="advanced-miscellaneous-topics.html#cb321-150" aria-hidden="true"></a><span class="co">#&gt;         ipredSim = rxTBSi(rx_pred_, rx_lambda_, rx_yj_, rx_low_, </span></span>
<span id="cb321-151"><a href="advanced-miscellaneous-topics.html#cb321-151" aria-hidden="true"></a><span class="co">#&gt;             rx_hi_)</span></span>
<span id="cb321-152"><a href="advanced-miscellaneous-topics.html#cb321-152" aria-hidden="true"></a><span class="co">#&gt;         sim = rxTBSi(rx_pred_ + sqrt(rx_r_) * rxerr.C2, rx_lambda_, </span></span>
<span id="cb321-153"><a href="advanced-miscellaneous-topics.html#cb321-153" aria-hidden="true"></a><span class="co">#&gt;             rx_yj_, rx_low_, rx_hi_)</span></span>
<span id="cb321-154"><a href="advanced-miscellaneous-topics.html#cb321-154" aria-hidden="true"></a><span class="co">#&gt;     }</span></span>
<span id="cb321-155"><a href="advanced-miscellaneous-topics.html#cb321-155" aria-hidden="true"></a><span class="co">#&gt;     if (CMT == 4) {</span></span>
<span id="cb321-156"><a href="advanced-miscellaneous-topics.html#cb321-156" aria-hidden="true"></a><span class="co">#&gt;         rx_yj_ ~ 2</span></span>
<span id="cb321-157"><a href="advanced-miscellaneous-topics.html#cb321-157" aria-hidden="true"></a><span class="co">#&gt;         rx_lambda_ ~ 1</span></span>
<span id="cb321-158"><a href="advanced-miscellaneous-topics.html#cb321-158" aria-hidden="true"></a><span class="co">#&gt;         rx_low_ ~ 0</span></span>
<span id="cb321-159"><a href="advanced-miscellaneous-topics.html#cb321-159" aria-hidden="true"></a><span class="co">#&gt;         rx_hi_ ~ 1</span></span>
<span id="cb321-160"><a href="advanced-miscellaneous-topics.html#cb321-160" aria-hidden="true"></a><span class="co">#&gt;         rx_pred_f_ ~ eff</span></span>
<span id="cb321-161"><a href="advanced-miscellaneous-topics.html#cb321-161" aria-hidden="true"></a><span class="co">#&gt;         rx_pred_ ~ rx_pred_f_</span></span>
<span id="cb321-162"><a href="advanced-miscellaneous-topics.html#cb321-162" aria-hidden="true"></a><span class="co">#&gt;         rx_r_ ~ (eff.add.sd)^2</span></span>
<span id="cb321-163"><a href="advanced-miscellaneous-topics.html#cb321-163" aria-hidden="true"></a><span class="co">#&gt;         ipredSim = rxTBSi(rx_pred_, rx_lambda_, rx_yj_, rx_low_, </span></span>
<span id="cb321-164"><a href="advanced-miscellaneous-topics.html#cb321-164" aria-hidden="true"></a><span class="co">#&gt;             rx_hi_)</span></span>
<span id="cb321-165"><a href="advanced-miscellaneous-topics.html#cb321-165" aria-hidden="true"></a><span class="co">#&gt;         sim = rxTBSi(rx_pred_ + sqrt(rx_r_) * rxerr.eff, rx_lambda_, </span></span>
<span id="cb321-166"><a href="advanced-miscellaneous-topics.html#cb321-166" aria-hidden="true"></a><span class="co">#&gt;             rx_yj_, rx_low_, rx_hi_)</span></span>
<span id="cb321-167"><a href="advanced-miscellaneous-topics.html#cb321-167" aria-hidden="true"></a><span class="co">#&gt;     }</span></span>
<span id="cb321-168"><a href="advanced-miscellaneous-topics.html#cb321-168" aria-hidden="true"></a><span class="co">#&gt;     cmt(C2)</span></span>
<span id="cb321-169"><a href="advanced-miscellaneous-topics.html#cb321-169" aria-hidden="true"></a><span class="co">#&gt;     dvid(5, 4)</span></span>
<span id="cb321-170"><a href="advanced-miscellaneous-topics.html#cb321-170" aria-hidden="true"></a><span class="co">#&gt; })</span></span></code></pre></div>
<p>If you wish to speed up multiple simualtions from the <code>rxode2</code>
functions, you need to pre-calculate care of the steps above:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="advanced-miscellaneous-topics.html#cb322-1" aria-hidden="true"></a>mod1 &lt;-<span class="st"> </span>mod1<span class="op">$</span>simulationModel</span>
<span id="cb322-2"><a href="advanced-miscellaneous-topics.html#cb322-2" aria-hidden="true"></a></span>
<span id="cb322-3"><a href="advanced-miscellaneous-topics.html#cb322-3" aria-hidden="true"></a>mod2 &lt;-<span class="st"> </span>mod2<span class="op">$</span>simulationModel</span></code></pre></div>
<p>These functions then can act like a normal ui model to be solved. You
can convert them back to a UI <code>as.rxUi()</code> or a function
<code>as.function()</code> as needed.</p>
<p>To increase speed for multiple simulations from the same model you
should use the lower level simulation model (ie <code>$simulationModel</code> or
<code>$simulationIniModel</code> depending on what you need)</p>
</div>
<div id="increasing-rxode2-speed-by-multi-subject-parallel-solving" class="section level3 hasAnchor" number="13.4.2">
<h3><span class="header-section-number">13.4.2</span> Increasing rxode2 speed by multi-subject parallel solving<a href="advanced-miscellaneous-topics.html#increasing-rxode2-speed-by-multi-subject-parallel-solving" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using the classic <code>rxode2</code> model specification (which we can convert
from a functional/ui model style) we will continue the discussion on
<code>rxode2</code> speed enhancements.</p>
<p><code>rxode2</code> originally developed as an ODE solver that allowed an ODE
solve for a single subject. This flexibility is still supported.</p>
<p>The original code from the <code>rxode2</code> tutorial is below:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="advanced-miscellaneous-topics.html#cb323-1" aria-hidden="true"></a><span class="kw">library</span>(rxode2)</span>
<span id="cb323-2"><a href="advanced-miscellaneous-topics.html#cb323-2" aria-hidden="true"></a></span>
<span id="cb323-3"><a href="advanced-miscellaneous-topics.html#cb323-3" aria-hidden="true"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb323-4"><a href="advanced-miscellaneous-topics.html#cb323-4" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb323-5"><a href="advanced-miscellaneous-topics.html#cb323-5" aria-hidden="true"></a></span>
<span id="cb323-6"><a href="advanced-miscellaneous-topics.html#cb323-6" aria-hidden="true"></a>mod1 &lt;-<span class="st"> </span><span class="kw">rxode2</span>({</span>
<span id="cb323-7"><a href="advanced-miscellaneous-topics.html#cb323-7" aria-hidden="true"></a>    C2 =<span class="st"> </span>centr<span class="op">/</span>V2</span>
<span id="cb323-8"><a href="advanced-miscellaneous-topics.html#cb323-8" aria-hidden="true"></a>    C3 =<span class="st"> </span>peri<span class="op">/</span>V3</span>
<span id="cb323-9"><a href="advanced-miscellaneous-topics.html#cb323-9" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(depot) =<span class="st"> </span><span class="op">-</span>KA<span class="op">*</span>depot</span>
<span id="cb323-10"><a href="advanced-miscellaneous-topics.html#cb323-10" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(centr) =<span class="st"> </span>KA<span class="op">*</span>depot <span class="op">-</span><span class="st"> </span>CL<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">+</span><span class="st"> </span>Q<span class="op">*</span>C3</span>
<span id="cb323-11"><a href="advanced-miscellaneous-topics.html#cb323-11" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(peri) =<span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C3</span>
<span id="cb323-12"><a href="advanced-miscellaneous-topics.html#cb323-12" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(eff) =<span class="st"> </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff</span>
<span id="cb323-13"><a href="advanced-miscellaneous-topics.html#cb323-13" aria-hidden="true"></a>    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb323-14"><a href="advanced-miscellaneous-topics.html#cb323-14" aria-hidden="true"></a>})</span>
<span id="cb323-15"><a href="advanced-miscellaneous-topics.html#cb323-15" aria-hidden="true"></a></span>
<span id="cb323-16"><a href="advanced-miscellaneous-topics.html#cb323-16" aria-hidden="true"></a><span class="co">#### Create an event table</span></span>
<span id="cb323-17"><a href="advanced-miscellaneous-topics.html#cb323-17" aria-hidden="true"></a></span>
<span id="cb323-18"><a href="advanced-miscellaneous-topics.html#cb323-18" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>() <span class="op">%&gt;%</span></span>
<span id="cb323-19"><a href="advanced-miscellaneous-topics.html#cb323-19" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">addl=</span><span class="dv">9</span>,<span class="dt">ii=</span><span class="dv">12</span>) <span class="op">%&gt;%</span></span>
<span id="cb323-20"><a href="advanced-miscellaneous-topics.html#cb323-20" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dt">time=</span><span class="dv">120</span>, <span class="dt">amt=</span><span class="dv">20000</span>, <span class="dt">addl=</span><span class="dv">4</span>, <span class="dt">ii=</span><span class="dv">24</span>) <span class="op">%&gt;%</span></span>
<span id="cb323-21"><a href="advanced-miscellaneous-topics.html#cb323-21" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">240</span>) <span class="co">## Add Sampling</span></span>
<span id="cb323-22"><a href="advanced-miscellaneous-topics.html#cb323-22" aria-hidden="true"></a></span>
<span id="cb323-23"><a href="advanced-miscellaneous-topics.html#cb323-23" aria-hidden="true"></a>nsub &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># 100 sub-problems</span></span>
<span id="cb323-24"><a href="advanced-miscellaneous-topics.html#cb323-24" aria-hidden="true"></a>sigma &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">0.09</span>,<span class="fl">0.08</span>,<span class="fl">0.08</span>,<span class="fl">0.25</span>),<span class="dv">2</span>,<span class="dv">2</span>) <span class="co"># IIV covariance matrix</span></span>
<span id="cb323-25"><a href="advanced-miscellaneous-topics.html#cb323-25" aria-hidden="true"></a>mv &lt;-<span class="st"> </span><span class="kw">rxRmvn</span>(<span class="dt">n=</span>nsub, <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">2</span>), sigma) <span class="co"># Sample from covariance matrix</span></span>
<span id="cb323-26"><a href="advanced-miscellaneous-topics.html#cb323-26" aria-hidden="true"></a>CL &lt;-<span class="st"> </span><span class="dv">7</span><span class="op">*</span><span class="kw">exp</span>(mv[,<span class="dv">1</span>])</span>
<span id="cb323-27"><a href="advanced-miscellaneous-topics.html#cb323-27" aria-hidden="true"></a>V2 &lt;-<span class="st"> </span><span class="dv">40</span><span class="op">*</span><span class="kw">exp</span>(mv[,<span class="dv">2</span>])</span>
<span id="cb323-28"><a href="advanced-miscellaneous-topics.html#cb323-28" aria-hidden="true"></a>params.all &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">KA=</span><span class="fl">0.3</span>, <span class="dt">CL=</span>CL, <span class="dt">V2=</span>V2, <span class="dt">Q=</span><span class="dv">10</span>, <span class="dt">V3=</span><span class="dv">300</span>,</span>
<span id="cb323-29"><a href="advanced-miscellaneous-topics.html#cb323-29" aria-hidden="true"></a>                    <span class="dt">Kin=</span><span class="fl">0.2</span>, <span class="dt">Kout=</span><span class="fl">0.2</span>, <span class="dt">EC50=</span><span class="dv">8</span>)</span></code></pre></div>
<div id="for-loop" class="section level4 hasAnchor" number="13.4.2.1">
<h4><span class="header-section-number">13.4.2.1</span> For Loop<a href="advanced-miscellaneous-topics.html#for-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The slowest way to code this is to use a <code>for</code> loop. In this example
we will enclose it in a function to compare timing.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="advanced-miscellaneous-topics.html#cb324-1" aria-hidden="true"></a>runFor &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb324-2"><a href="advanced-miscellaneous-topics.html#cb324-2" aria-hidden="true"></a>    res &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb324-3"><a href="advanced-miscellaneous-topics.html#cb324-3" aria-hidden="true"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nsub) {</span>
<span id="cb324-4"><a href="advanced-miscellaneous-topics.html#cb324-4" aria-hidden="true"></a>        params &lt;-<span class="st"> </span>params.all[i,]</span>
<span id="cb324-5"><a href="advanced-miscellaneous-topics.html#cb324-5" aria-hidden="true"></a>        x &lt;-<span class="st"> </span>mod1<span class="op">$</span><span class="kw">solve</span>(params, ev)</span>
<span id="cb324-6"><a href="advanced-miscellaneous-topics.html#cb324-6" aria-hidden="true"></a>        <span class="co">##Store results for effect compartment</span></span>
<span id="cb324-7"><a href="advanced-miscellaneous-topics.html#cb324-7" aria-hidden="true"></a>        res &lt;-<span class="st"> </span><span class="kw">cbind</span>(res, x[, <span class="st">&quot;eff&quot;</span>])</span>
<span id="cb324-8"><a href="advanced-miscellaneous-topics.html#cb324-8" aria-hidden="true"></a>    }</span>
<span id="cb324-9"><a href="advanced-miscellaneous-topics.html#cb324-9" aria-hidden="true"></a>    <span class="kw">return</span>(res)</span>
<span id="cb324-10"><a href="advanced-miscellaneous-topics.html#cb324-10" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div id="running-with-apply" class="section level4 hasAnchor" number="13.4.2.2">
<h4><span class="header-section-number">13.4.2.2</span> Running with apply<a href="advanced-miscellaneous-topics.html#running-with-apply" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In general for R, the <code>apply</code> types of functions perform better than a
<code>for</code> loop, so the tutorial also suggests this speed enhancement</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="advanced-miscellaneous-topics.html#cb325-1" aria-hidden="true"></a>runSapply &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb325-2"><a href="advanced-miscellaneous-topics.html#cb325-2" aria-hidden="true"></a>    res &lt;-<span class="st"> </span><span class="kw">apply</span>(params.all, <span class="dv">1</span>, <span class="cf">function</span>(theta)</span>
<span id="cb325-3"><a href="advanced-miscellaneous-topics.html#cb325-3" aria-hidden="true"></a>        mod1<span class="op">$</span><span class="kw">run</span>(theta, ev)[, <span class="st">&quot;eff&quot;</span>])</span>
<span id="cb325-4"><a href="advanced-miscellaneous-topics.html#cb325-4" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div id="run-using-a-single-threaded-solve" class="section level4 hasAnchor" number="13.4.2.3">
<h4><span class="header-section-number">13.4.2.3</span> Run using a single-threaded solve<a href="advanced-miscellaneous-topics.html#run-using-a-single-threaded-solve" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You can also have rxode2 solve all the subject simultaneously without
collecting the results in R, using a single threaded solve.</p>
<p>The data output is slightly different here, but still gives the same
information:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="advanced-miscellaneous-topics.html#cb326-1" aria-hidden="true"></a>runSingleThread &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb326-2"><a href="advanced-miscellaneous-topics.html#cb326-2" aria-hidden="true"></a>  <span class="kw">solve</span>(mod1, params.all, ev, <span class="dt">cores=</span><span class="dv">1</span>)[,<span class="kw">c</span>(<span class="st">&quot;sim.id&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;eff&quot;</span>)]</span>
<span id="cb326-3"><a href="advanced-miscellaneous-topics.html#cb326-3" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div id="run-a-2-threaded-solve" class="section level4 hasAnchor" number="13.4.2.4">
<h4><span class="header-section-number">13.4.2.4</span> Run a 2 threaded solve<a href="advanced-miscellaneous-topics.html#run-a-2-threaded-solve" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>rxode2 supports multi-threaded solves, so another option is to have <code>2</code>
threads (called <code>cores</code> in the solve options, you can see the options
in <code>rxControl()</code> or <code>rxSolve()</code>).</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="advanced-miscellaneous-topics.html#cb327-1" aria-hidden="true"></a>run2Thread &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb327-2"><a href="advanced-miscellaneous-topics.html#cb327-2" aria-hidden="true"></a>  <span class="kw">solve</span>(mod1, params.all, ev, <span class="dt">cores=</span><span class="dv">2</span>)[,<span class="kw">c</span>(<span class="st">&quot;sim.id&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;eff&quot;</span>)]</span>
<span id="cb327-3"><a href="advanced-miscellaneous-topics.html#cb327-3" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div id="compare-the-times-between-all-the-methods" class="section level4 hasAnchor" number="13.4.2.5">
<h4><span class="header-section-number">13.4.2.5</span> Compare the times between all the methods<a href="advanced-miscellaneous-topics.html#compare-the-times-between-all-the-methods" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now the moment of truth, the timings:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="advanced-miscellaneous-topics.html#cb328-1" aria-hidden="true"></a>bench &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw">runFor</span>(), <span class="kw">runSapply</span>(), <span class="kw">runSingleThread</span>(),<span class="kw">run2Thread</span>())</span>
<span id="cb328-2"><a href="advanced-miscellaneous-topics.html#cb328-2" aria-hidden="true"></a><span class="kw">print</span>(bench)</span>
<span id="cb328-3"><a href="advanced-miscellaneous-topics.html#cb328-3" aria-hidden="true"></a><span class="co">#&gt; Unit: milliseconds</span></span>
<span id="cb328-4"><a href="advanced-miscellaneous-topics.html#cb328-4" aria-hidden="true"></a><span class="co">#&gt;               expr       min        lq      mean    median        uq       max</span></span>
<span id="cb328-5"><a href="advanced-miscellaneous-topics.html#cb328-5" aria-hidden="true"></a><span class="co">#&gt;           runFor() 226.80259 231.46430 238.46184 234.91714 238.62226 503.03838</span></span>
<span id="cb328-6"><a href="advanced-miscellaneous-topics.html#cb328-6" aria-hidden="true"></a><span class="co">#&gt;        runSapply() 226.17992 231.61599 238.69159 234.84238 238.65584 517.06355</span></span>
<span id="cb328-7"><a href="advanced-miscellaneous-topics.html#cb328-7" aria-hidden="true"></a><span class="co">#&gt;  runSingleThread()  21.73833  22.69128  23.18974  23.32014  23.60377  30.82214</span></span>
<span id="cb328-8"><a href="advanced-miscellaneous-topics.html#cb328-8" aria-hidden="true"></a><span class="co">#&gt;       run2Thread()  12.69923  13.34349  13.84174  13.84864  14.01386  21.63286</span></span>
<span id="cb328-9"><a href="advanced-miscellaneous-topics.html#cb328-9" aria-hidden="true"></a><span class="co">#&gt;  neval</span></span>
<span id="cb328-10"><a href="advanced-miscellaneous-topics.html#cb328-10" aria-hidden="true"></a><span class="co">#&gt;    100</span></span>
<span id="cb328-11"><a href="advanced-miscellaneous-topics.html#cb328-11" aria-hidden="true"></a><span class="co">#&gt;    100</span></span>
<span id="cb328-12"><a href="advanced-miscellaneous-topics.html#cb328-12" aria-hidden="true"></a><span class="co">#&gt;    100</span></span>
<span id="cb328-13"><a href="advanced-miscellaneous-topics.html#cb328-13" aria-hidden="true"></a><span class="co">#&gt;    100</span></span>
<span id="cb328-14"><a href="advanced-miscellaneous-topics.html#cb328-14" aria-hidden="true"></a><span class="kw">autoplot</span>(bench)</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-140-1.png" width="100%" /></p>
<p>It is clear that the <strong>largest</strong> jump in performance when using the
<code>solve</code> method and providing <em>all</em> the parameters to rxode2 to solve
without looping over each subject with either a <code>for</code> or a <code>sapply</code>.
The number of cores/threads applied to the solve also plays a role in
the solving.</p>
<p>We can explore the number of threads further with the following code:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="advanced-miscellaneous-topics.html#cb329-1" aria-hidden="true"></a>runThread &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb329-2"><a href="advanced-miscellaneous-topics.html#cb329-2" aria-hidden="true"></a>    <span class="kw">solve</span>(mod1, params.all, ev, <span class="dt">cores=</span>n)[,<span class="kw">c</span>(<span class="st">&quot;sim.id&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;eff&quot;</span>)]</span>
<span id="cb329-3"><a href="advanced-miscellaneous-topics.html#cb329-3" aria-hidden="true"></a>}</span>
<span id="cb329-4"><a href="advanced-miscellaneous-topics.html#cb329-4" aria-hidden="true"></a></span>
<span id="cb329-5"><a href="advanced-miscellaneous-topics.html#cb329-5" aria-hidden="true"></a>bench &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&quot;microbenchmark(%s)&quot;</span>,</span>
<span id="cb329-6"><a href="advanced-miscellaneous-topics.html#cb329-6" aria-hidden="true"></a>                                     <span class="kw">paste</span>(<span class="kw">paste0</span>(<span class="st">&quot;runThread(&quot;</span>, <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">rxCores</span>()),<span class="st">&quot;)&quot;</span>),</span>
<span id="cb329-7"><a href="advanced-miscellaneous-topics.html#cb329-7" aria-hidden="true"></a>                                           <span class="dt">collapse=</span><span class="st">&quot;,&quot;</span>))))</span>
<span id="cb329-8"><a href="advanced-miscellaneous-topics.html#cb329-8" aria-hidden="true"></a><span class="kw">print</span>(bench)</span>
<span id="cb329-9"><a href="advanced-miscellaneous-topics.html#cb329-9" aria-hidden="true"></a><span class="co">#&gt; Unit: milliseconds</span></span>
<span id="cb329-10"><a href="advanced-miscellaneous-topics.html#cb329-10" aria-hidden="true"></a><span class="co">#&gt;           expr       min        lq     mean    median       uq      max neval</span></span>
<span id="cb329-11"><a href="advanced-miscellaneous-topics.html#cb329-11" aria-hidden="true"></a><span class="co">#&gt;   runThread(1) 21.156241 22.162005 28.92567 25.503911 32.63468 69.03869   100</span></span>
<span id="cb329-12"><a href="advanced-miscellaneous-topics.html#cb329-12" aria-hidden="true"></a><span class="co">#&gt;   runThread(2) 12.582237 13.471725 18.33534 15.168085 21.69747 37.58077   100</span></span>
<span id="cb329-13"><a href="advanced-miscellaneous-topics.html#cb329-13" aria-hidden="true"></a><span class="co">#&gt;   runThread(3)  9.738105 10.791214 15.40642 12.975344 17.76421 33.30203   100</span></span>
<span id="cb329-14"><a href="advanced-miscellaneous-topics.html#cb329-14" aria-hidden="true"></a><span class="co">#&gt;   runThread(4)  8.329495  9.196881 12.33852 10.966012 14.64972 27.79702   100</span></span>
<span id="cb329-15"><a href="advanced-miscellaneous-topics.html#cb329-15" aria-hidden="true"></a><span class="co">#&gt;   runThread(5)  7.434857  8.589648 12.36991 10.434525 14.53453 35.36355   100</span></span>
<span id="cb329-16"><a href="advanced-miscellaneous-topics.html#cb329-16" aria-hidden="true"></a><span class="co">#&gt;   runThread(6)  7.155785  7.900791 10.69021  8.976488 12.27102 31.42603   100</span></span>
<span id="cb329-17"><a href="advanced-miscellaneous-topics.html#cb329-17" aria-hidden="true"></a><span class="co">#&gt;   runThread(7)  6.893432  8.657700 14.01415 10.800231 18.38594 32.74863   100</span></span>
<span id="cb329-18"><a href="advanced-miscellaneous-topics.html#cb329-18" aria-hidden="true"></a><span class="co">#&gt;   runThread(8)  6.765653  8.333562 14.74611 11.299252 18.17180 34.42415   100</span></span>
<span id="cb329-19"><a href="advanced-miscellaneous-topics.html#cb329-19" aria-hidden="true"></a><span class="co">#&gt;   runThread(9)  8.286625 10.074962 18.22466 13.118453 22.58021 38.33926   100</span></span>
<span id="cb329-20"><a href="advanced-miscellaneous-topics.html#cb329-20" aria-hidden="true"></a><span class="co">#&gt;  runThread(10)  8.481860 10.582388 19.62018 14.270838 32.36746 38.22258   100</span></span>
<span id="cb329-21"><a href="advanced-miscellaneous-topics.html#cb329-21" aria-hidden="true"></a><span class="co">#&gt;  runThread(11)  8.155198  9.691569 17.18156 13.570675 21.14222 36.02348   100</span></span>
<span id="cb329-22"><a href="advanced-miscellaneous-topics.html#cb329-22" aria-hidden="true"></a><span class="co">#&gt;  runThread(12)  8.337740  9.921684 18.18838 13.135094 31.72638 46.74915   100</span></span>
<span id="cb329-23"><a href="advanced-miscellaneous-topics.html#cb329-23" aria-hidden="true"></a><span class="co">#&gt;  runThread(13)  7.974870  9.908901 18.31133 13.696796 28.37834 34.74034   100</span></span>
<span id="cb329-24"><a href="advanced-miscellaneous-topics.html#cb329-24" aria-hidden="true"></a><span class="co">#&gt;  runThread(14)  7.961936  9.586060 18.70272 12.792196 32.21532 39.28540   100</span></span>
<span id="cb329-25"><a href="advanced-miscellaneous-topics.html#cb329-25" aria-hidden="true"></a><span class="co">#&gt;  runThread(15)  7.636325  9.044776 16.15580 11.223229 19.90421 40.54116   100</span></span>
<span id="cb329-26"><a href="advanced-miscellaneous-topics.html#cb329-26" aria-hidden="true"></a><span class="co">#&gt;  runThread(16)  7.732445  9.995808 19.08606 18.113271 31.22584 36.88623   100</span></span>
<span id="cb329-27"><a href="advanced-miscellaneous-topics.html#cb329-27" aria-hidden="true"></a><span class="kw">autoplot</span>(bench)</span></code></pre></div>
<p><img src="rxode2-manual_files/figure-html/unnamed-chunk-142-1.png" width="100%" /></p>
<p>There can be a suite spot in speed vs number or cores. The system type
(mac, linux, windows and/or processor), complexity of the ODE solving
and the number of subjects may affect this arbitrary number of
threads. 4 threads is a good number to use without any prior knowledge
because most systems these days have at least 4 threads (or 2
processors with 4 threads).</p>
</div>
</div>
<div id="a-real-life-example" class="section level3 hasAnchor" number="13.4.3">
<h3><span class="header-section-number">13.4.3</span> A real life example<a href="advanced-miscellaneous-topics.html#a-real-life-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before some of the parallel solving was implemented, the fastest way
to run <code>rxode2</code> was with <code>lapply</code>. This is how Rik Schoemaker created
the data-set for <code>nlmixr</code> comparisons, but reduced to run faster
automatic building of the pkgdown website.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="advanced-miscellaneous-topics.html#cb330-1" aria-hidden="true"></a><span class="kw">library</span>(rxode2)</span>
<span id="cb330-2"><a href="advanced-miscellaneous-topics.html#cb330-2" aria-hidden="true"></a><span class="kw">library</span>(data.table)</span>
<span id="cb330-3"><a href="advanced-miscellaneous-topics.html#cb330-3" aria-hidden="true"></a><span class="co">#Define the rxode2 model</span></span>
<span id="cb330-4"><a href="advanced-miscellaneous-topics.html#cb330-4" aria-hidden="true"></a>  ode1 &lt;-<span class="st"> &quot;</span></span>
<span id="cb330-5"><a href="advanced-miscellaneous-topics.html#cb330-5" aria-hidden="true"></a><span class="st">  d/dt(abs)    = -KA*abs;</span></span>
<span id="cb330-6"><a href="advanced-miscellaneous-topics.html#cb330-6" aria-hidden="true"></a><span class="st">  d/dt(centr)  =  KA*abs-(CL/V)*centr;</span></span>
<span id="cb330-7"><a href="advanced-miscellaneous-topics.html#cb330-7" aria-hidden="true"></a><span class="st">  C2=centr/V;</span></span>
<span id="cb330-8"><a href="advanced-miscellaneous-topics.html#cb330-8" aria-hidden="true"></a><span class="st">  &quot;</span></span>
<span id="cb330-9"><a href="advanced-miscellaneous-topics.html#cb330-9" aria-hidden="true"></a>  </span>
<span id="cb330-10"><a href="advanced-miscellaneous-topics.html#cb330-10" aria-hidden="true"></a><span class="co">#Create the rxode2 simulation object</span></span>
<span id="cb330-11"><a href="advanced-miscellaneous-topics.html#cb330-11" aria-hidden="true"></a>mod1 &lt;-<span class="st"> </span><span class="kw">rxode2</span>(<span class="dt">model =</span> ode1)</span>
<span id="cb330-12"><a href="advanced-miscellaneous-topics.html#cb330-12" aria-hidden="true"></a></span>
<span id="cb330-13"><a href="advanced-miscellaneous-topics.html#cb330-13" aria-hidden="true"></a><span class="co">#Population parameter values on log-scale</span></span>
<span id="cb330-14"><a href="advanced-miscellaneous-topics.html#cb330-14" aria-hidden="true"></a>  paramsl &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">CL =</span> <span class="kw">log</span>(<span class="dv">4</span>),</span>
<span id="cb330-15"><a href="advanced-miscellaneous-topics.html#cb330-15" aria-hidden="true"></a>               <span class="dt">V =</span> <span class="kw">log</span>(<span class="dv">70</span>),</span>
<span id="cb330-16"><a href="advanced-miscellaneous-topics.html#cb330-16" aria-hidden="true"></a>               <span class="dt">KA =</span> <span class="kw">log</span>(<span class="dv">1</span>))</span>
<span id="cb330-17"><a href="advanced-miscellaneous-topics.html#cb330-17" aria-hidden="true"></a><span class="co">#make 10,000 subjects to sample from:</span></span>
<span id="cb330-18"><a href="advanced-miscellaneous-topics.html#cb330-18" aria-hidden="true"></a>  nsubg &lt;-<span class="st"> </span><span class="dv">300</span> <span class="co"># subjects per dose</span></span>
<span id="cb330-19"><a href="advanced-miscellaneous-topics.html#cb330-19" aria-hidden="true"></a>  doses &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">120</span>)</span>
<span id="cb330-20"><a href="advanced-miscellaneous-topics.html#cb330-20" aria-hidden="true"></a>  nsub &lt;-<span class="st"> </span>nsubg <span class="op">*</span><span class="st"> </span><span class="kw">length</span>(doses)</span>
<span id="cb330-21"><a href="advanced-miscellaneous-topics.html#cb330-21" aria-hidden="true"></a><span class="co">#IIV of 30% for each parameter</span></span>
<span id="cb330-22"><a href="advanced-miscellaneous-topics.html#cb330-22" aria-hidden="true"></a>  omega &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="kw">c</span>(<span class="fl">0.09</span>, <span class="fl">0.09</span>, <span class="fl">0.09</span>))<span class="co"># IIV covariance matrix</span></span>
<span id="cb330-23"><a href="advanced-miscellaneous-topics.html#cb330-23" aria-hidden="true"></a>  sigma &lt;-<span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb330-24"><a href="advanced-miscellaneous-topics.html#cb330-24" aria-hidden="true"></a><span class="co">#Sample from the multivariate normal</span></span>
<span id="cb330-25"><a href="advanced-miscellaneous-topics.html#cb330-25" aria-hidden="true"></a>  <span class="kw">set.seed</span>(<span class="dv">98176247</span>)</span>
<span id="cb330-26"><a href="advanced-miscellaneous-topics.html#cb330-26" aria-hidden="true"></a>  <span class="kw">rxSetSeed</span>(<span class="dv">98176247</span>)</span>
<span id="cb330-27"><a href="advanced-miscellaneous-topics.html#cb330-27" aria-hidden="true"></a>  <span class="kw">library</span>(MASS)</span>
<span id="cb330-28"><a href="advanced-miscellaneous-topics.html#cb330-28" aria-hidden="true"></a>  mv &lt;-</span>
<span id="cb330-29"><a href="advanced-miscellaneous-topics.html#cb330-29" aria-hidden="true"></a><span class="st">    </span><span class="kw">mvrnorm</span>(nsub, <span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">dim</span>(omega)[<span class="dv">1</span>]), omega) <span class="co"># Sample from covariance matrix</span></span>
<span id="cb330-30"><a href="advanced-miscellaneous-topics.html#cb330-30" aria-hidden="true"></a><span class="co">#Combine population parameters with IIV</span></span>
<span id="cb330-31"><a href="advanced-miscellaneous-topics.html#cb330-31" aria-hidden="true"></a>  params.all &lt;-</span>
<span id="cb330-32"><a href="advanced-miscellaneous-topics.html#cb330-32" aria-hidden="true"></a><span class="st">    </span><span class="kw">data.table</span>(</span>
<span id="cb330-33"><a href="advanced-miscellaneous-topics.html#cb330-33" aria-hidden="true"></a>      <span class="st">&quot;ID&quot;</span> =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span>nsub),</span>
<span id="cb330-34"><a href="advanced-miscellaneous-topics.html#cb330-34" aria-hidden="true"></a>      <span class="st">&quot;CL&quot;</span> =<span class="st"> </span><span class="kw">exp</span>(paramsl[<span class="st">&#39;CL&#39;</span>] <span class="op">+</span><span class="st"> </span>mv[, <span class="dv">1</span>]),</span>
<span id="cb330-35"><a href="advanced-miscellaneous-topics.html#cb330-35" aria-hidden="true"></a>      <span class="st">&quot;V&quot;</span> =<span class="st"> </span><span class="kw">exp</span>(paramsl[<span class="st">&#39;V&#39;</span>] <span class="op">+</span><span class="st"> </span>mv[, <span class="dv">2</span>]),</span>
<span id="cb330-36"><a href="advanced-miscellaneous-topics.html#cb330-36" aria-hidden="true"></a>      <span class="st">&quot;KA&quot;</span> =<span class="st"> </span><span class="kw">exp</span>(paramsl[<span class="st">&#39;KA&#39;</span>] <span class="op">+</span><span class="st"> </span>mv[, <span class="dv">3</span>])</span>
<span id="cb330-37"><a href="advanced-miscellaneous-topics.html#cb330-37" aria-hidden="true"></a>    )</span>
<span id="cb330-38"><a href="advanced-miscellaneous-topics.html#cb330-38" aria-hidden="true"></a><span class="co">#set the doses (looping through the 4 doses)</span></span>
<span id="cb330-39"><a href="advanced-miscellaneous-topics.html#cb330-39" aria-hidden="true"></a>params.all[, AMT <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">rep</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>doses,nsubg)]</span>
<span id="cb330-40"><a href="advanced-miscellaneous-topics.html#cb330-40" aria-hidden="true"></a></span>
<span id="cb330-41"><a href="advanced-miscellaneous-topics.html#cb330-41" aria-hidden="true"></a>Startlapply &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb330-42"><a href="advanced-miscellaneous-topics.html#cb330-42" aria-hidden="true"></a>  </span>
<span id="cb330-43"><a href="advanced-miscellaneous-topics.html#cb330-43" aria-hidden="true"></a><span class="co">#Run the simulations using lapply for speed</span></span>
<span id="cb330-44"><a href="advanced-miscellaneous-topics.html#cb330-44" aria-hidden="true"></a>  s =<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>nsub, <span class="cf">function</span>(i) {</span>
<span id="cb330-45"><a href="advanced-miscellaneous-topics.html#cb330-45" aria-hidden="true"></a><span class="co">#selects the parameters associated with the subject to be simulated</span></span>
<span id="cb330-46"><a href="advanced-miscellaneous-topics.html#cb330-46" aria-hidden="true"></a>    params &lt;-<span class="st"> </span>params.all[i]</span>
<span id="cb330-47"><a href="advanced-miscellaneous-topics.html#cb330-47" aria-hidden="true"></a><span class="co">#creates an eventTable with 7 doses every 24 hours</span></span>
<span id="cb330-48"><a href="advanced-miscellaneous-topics.html#cb330-48" aria-hidden="true"></a>    ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>()</span>
<span id="cb330-49"><a href="advanced-miscellaneous-topics.html#cb330-49" aria-hidden="true"></a>    ev<span class="op">$</span><span class="kw">add.dosing</span>(</span>
<span id="cb330-50"><a href="advanced-miscellaneous-topics.html#cb330-50" aria-hidden="true"></a>      <span class="dt">dose =</span> params<span class="op">$</span>AMT,</span>
<span id="cb330-51"><a href="advanced-miscellaneous-topics.html#cb330-51" aria-hidden="true"></a>      <span class="dt">nbr.doses =</span> <span class="dv">1</span>,</span>
<span id="cb330-52"><a href="advanced-miscellaneous-topics.html#cb330-52" aria-hidden="true"></a>      <span class="dt">dosing.to =</span> <span class="dv">1</span>,</span>
<span id="cb330-53"><a href="advanced-miscellaneous-topics.html#cb330-53" aria-hidden="true"></a>      <span class="dt">rate =</span> <span class="ot">NULL</span>,</span>
<span id="cb330-54"><a href="advanced-miscellaneous-topics.html#cb330-54" aria-hidden="true"></a>      <span class="dt">start.time =</span> <span class="dv">0</span></span>
<span id="cb330-55"><a href="advanced-miscellaneous-topics.html#cb330-55" aria-hidden="true"></a>    )</span>
<span id="cb330-56"><a href="advanced-miscellaneous-topics.html#cb330-56" aria-hidden="true"></a><span class="co">#generates 4 random samples in a 24 hour period</span></span>
<span id="cb330-57"><a href="advanced-miscellaneous-topics.html#cb330-57" aria-hidden="true"></a>    ev<span class="op">$</span><span class="kw">add.sampling</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">sort</span>(<span class="kw">round</span>(<span class="kw">sample</span>(<span class="kw">runif</span>(<span class="dv">600</span>, <span class="dv">0</span>, <span class="dv">1440</span>), <span class="dv">4</span>) <span class="op">/</span><span class="st"> </span><span class="dv">60</span>, <span class="dv">2</span>))))</span>
<span id="cb330-58"><a href="advanced-miscellaneous-topics.html#cb330-58" aria-hidden="true"></a><span class="co">#runs the rxode2 simulation</span></span>
<span id="cb330-59"><a href="advanced-miscellaneous-topics.html#cb330-59" aria-hidden="true"></a>    x &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(mod1<span class="op">$</span><span class="kw">run</span>(params, ev))</span>
<span id="cb330-60"><a href="advanced-miscellaneous-topics.html#cb330-60" aria-hidden="true"></a><span class="co">#merges the parameters and ID number to the simulation output</span></span>
<span id="cb330-61"><a href="advanced-miscellaneous-topics.html#cb330-61" aria-hidden="true"></a>    x[, <span class="kw">names</span>(params) <span class="op">:</span><span class="er">=</span><span class="st"> </span>params]</span>
<span id="cb330-62"><a href="advanced-miscellaneous-topics.html#cb330-62" aria-hidden="true"></a>  })</span>
<span id="cb330-63"><a href="advanced-miscellaneous-topics.html#cb330-63" aria-hidden="true"></a>  </span>
<span id="cb330-64"><a href="advanced-miscellaneous-topics.html#cb330-64" aria-hidden="true"></a><span class="co">#runs the entire sequence of 100 subjects and binds the results to the object res</span></span>
<span id="cb330-65"><a href="advanced-miscellaneous-topics.html#cb330-65" aria-hidden="true"></a>  res =<span class="st"> </span><span class="kw">as.data.table</span>(<span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, s))</span>
<span id="cb330-66"><a href="advanced-miscellaneous-topics.html#cb330-66" aria-hidden="true"></a>  </span>
<span id="cb330-67"><a href="advanced-miscellaneous-topics.html#cb330-67" aria-hidden="true"></a>Stoplapply &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb330-68"><a href="advanced-miscellaneous-topics.html#cb330-68" aria-hidden="true"></a>  </span>
<span id="cb330-69"><a href="advanced-miscellaneous-topics.html#cb330-69" aria-hidden="true"></a><span class="kw">print</span>(Stoplapply <span class="op">-</span><span class="st"> </span>Startlapply)</span>
<span id="cb330-70"><a href="advanced-miscellaneous-topics.html#cb330-70" aria-hidden="true"></a><span class="co">#&gt; Time difference of 14.49963 secs</span></span></code></pre></div>
<p>By applying some of the new parallel solving concepts you can simply
run the same simulation both with less code and faster:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="advanced-miscellaneous-topics.html#cb331-1" aria-hidden="true"></a>rx &lt;-<span class="st"> </span><span class="kw">rxode2</span>({</span>
<span id="cb331-2"><a href="advanced-miscellaneous-topics.html#cb331-2" aria-hidden="true"></a>    CL =<span class="st">  </span><span class="kw">log</span>(<span class="dv">4</span>)</span>
<span id="cb331-3"><a href="advanced-miscellaneous-topics.html#cb331-3" aria-hidden="true"></a>    V =<span class="st"> </span><span class="kw">log</span>(<span class="dv">70</span>)</span>
<span id="cb331-4"><a href="advanced-miscellaneous-topics.html#cb331-4" aria-hidden="true"></a>    KA =<span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span>)</span>
<span id="cb331-5"><a href="advanced-miscellaneous-topics.html#cb331-5" aria-hidden="true"></a>    CL =<span class="st"> </span><span class="kw">exp</span>(CL <span class="op">+</span><span class="st"> </span>eta.CL)</span>
<span id="cb331-6"><a href="advanced-miscellaneous-topics.html#cb331-6" aria-hidden="true"></a>    V =<span class="st"> </span><span class="kw">exp</span>(V <span class="op">+</span><span class="st"> </span>eta.V)</span>
<span id="cb331-7"><a href="advanced-miscellaneous-topics.html#cb331-7" aria-hidden="true"></a>    KA =<span class="st"> </span><span class="kw">exp</span>(KA <span class="op">+</span><span class="st"> </span>eta.KA)</span>
<span id="cb331-8"><a href="advanced-miscellaneous-topics.html#cb331-8" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(abs)    =<span class="st"> </span><span class="op">-</span>KA<span class="op">*</span>abs;</span>
<span id="cb331-9"><a href="advanced-miscellaneous-topics.html#cb331-9" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(centr)  =<span class="st">  </span>KA<span class="op">*</span>abs<span class="op">-</span>(CL<span class="op">/</span>V)<span class="op">*</span>centr;</span>
<span id="cb331-10"><a href="advanced-miscellaneous-topics.html#cb331-10" aria-hidden="true"></a>    C2=centr<span class="op">/</span>V;</span>
<span id="cb331-11"><a href="advanced-miscellaneous-topics.html#cb331-11" aria-hidden="true"></a>})</span>
<span id="cb331-12"><a href="advanced-miscellaneous-topics.html#cb331-12" aria-hidden="true"></a></span>
<span id="cb331-13"><a href="advanced-miscellaneous-topics.html#cb331-13" aria-hidden="true"></a>omega &lt;-<span class="st"> </span><span class="kw">lotri</span>(eta.CL <span class="op">~</span><span class="st"> </span><span class="fl">0.09</span>,</span>
<span id="cb331-14"><a href="advanced-miscellaneous-topics.html#cb331-14" aria-hidden="true"></a>               eta.V <span class="op">~</span><span class="st"> </span><span class="fl">0.09</span>,</span>
<span id="cb331-15"><a href="advanced-miscellaneous-topics.html#cb331-15" aria-hidden="true"></a>               eta.KA <span class="op">~</span><span class="st"> </span><span class="fl">0.09</span>)</span>
<span id="cb331-16"><a href="advanced-miscellaneous-topics.html#cb331-16" aria-hidden="true"></a></span>
<span id="cb331-17"><a href="advanced-miscellaneous-topics.html#cb331-17" aria-hidden="true"></a>doses &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">120</span>)</span>
<span id="cb331-18"><a href="advanced-miscellaneous-topics.html#cb331-18" aria-hidden="true"></a></span>
<span id="cb331-19"><a href="advanced-miscellaneous-topics.html#cb331-19" aria-hidden="true"></a></span>
<span id="cb331-20"><a href="advanced-miscellaneous-topics.html#cb331-20" aria-hidden="true"></a>startParallel &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb331-21"><a href="advanced-miscellaneous-topics.html#cb331-21" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>,</span>
<span id="cb331-22"><a href="advanced-miscellaneous-topics.html#cb331-22" aria-hidden="true"></a>        <span class="kw">lapply</span>(<span class="kw">seq_along</span>(doses), <span class="cf">function</span>(i){</span>
<span id="cb331-23"><a href="advanced-miscellaneous-topics.html#cb331-23" aria-hidden="true"></a>            <span class="kw">et</span>() <span class="op">%&gt;%</span></span>
<span id="cb331-24"><a href="advanced-miscellaneous-topics.html#cb331-24" aria-hidden="true"></a><span class="st">                </span><span class="kw">et</span>(<span class="dt">amt=</span>doses[i]) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add single dose</span></span>
<span id="cb331-25"><a href="advanced-miscellaneous-topics.html#cb331-25" aria-hidden="true"></a><span class="st">                </span><span class="kw">et</span>(<span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Add 0 observation</span></span>
<span id="cb331-26"><a href="advanced-miscellaneous-topics.html#cb331-26" aria-hidden="true"></a><span class="co">#### Generate 4 samples in 24 hour period</span></span>
<span id="cb331-27"><a href="advanced-miscellaneous-topics.html#cb331-27" aria-hidden="true"></a><span class="st">                </span><span class="kw">et</span>(<span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="cf">function</span>(...){<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">24</span>)})) <span class="op">%&gt;%</span></span>
<span id="cb331-28"><a href="advanced-miscellaneous-topics.html#cb331-28" aria-hidden="true"></a><span class="st">                </span><span class="kw">et</span>(<span class="dt">id=</span><span class="kw">seq</span>(<span class="dv">1</span>, nsubg) <span class="op">+</span><span class="st"> </span>(i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>nsubg) <span class="op">%&gt;%</span></span>
<span id="cb331-29"><a href="advanced-miscellaneous-topics.html#cb331-29" aria-hidden="true"></a><span class="co">#### Convert to data frame to skip sorting the data</span></span>
<span id="cb331-30"><a href="advanced-miscellaneous-topics.html#cb331-30" aria-hidden="true"></a><span class="co">#### When binding the data together</span></span>
<span id="cb331-31"><a href="advanced-miscellaneous-topics.html#cb331-31" aria-hidden="true"></a><span class="st">                </span>as.data.frame </span>
<span id="cb331-32"><a href="advanced-miscellaneous-topics.html#cb331-32" aria-hidden="true"></a>        }))</span>
<span id="cb331-33"><a href="advanced-miscellaneous-topics.html#cb331-33" aria-hidden="true"></a><span class="co">#### To better compare, use the same output, that is data.table</span></span>
<span id="cb331-34"><a href="advanced-miscellaneous-topics.html#cb331-34" aria-hidden="true"></a>res &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(rx, ev, <span class="dt">omega=</span>omega, <span class="dt">returnType=</span><span class="st">&quot;data.table&quot;</span>)</span>
<span id="cb331-35"><a href="advanced-miscellaneous-topics.html#cb331-35" aria-hidden="true"></a>endParallel &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb331-36"><a href="advanced-miscellaneous-topics.html#cb331-36" aria-hidden="true"></a><span class="kw">print</span>(endParallel <span class="op">-</span><span class="st"> </span>startParallel)</span>
<span id="cb331-37"><a href="advanced-miscellaneous-topics.html#cb331-37" aria-hidden="true"></a><span class="co">#&gt; Time difference of 0.1268315 secs</span></span></code></pre></div>
<p>You can see a striking time difference between the two methods; A few
things to keep in mind:</p>
<ul>
<li><p><code>rxode2</code> use the thread-safe sitmo <code>threefry</code> routines for simulation of <code>eta</code>
values. Therefore the results are expected to be different (also the random
samples are taken in a different order which would be different)</p></li>
<li><p>This prior simulation was run in R 3.5, which has a different
random number generator so the results in this simulation will be
different from the actual nlmixr comparison when using the slower
simulation.</p></li>
<li><p>This speed comparison used <code>data.table</code>. <code>rxode2</code> uses <code>data.table</code>
internally (when available) try to speed up sorting, so this would
be different than installations where <code>data.table</code> is not
installed. You can force rxode2 to use <code>order()</code> when sorting by
using <code>forderForceBase(TRUE)</code>. In this case there is little
difference between the two, though in other examples <code>data.table</code>’s
presence leads to a speed increase (and less likely it could lead
to a slowdown).</p></li>
</ul>
<div id="want-more-ways-to-run-multi-subject-simulations" class="section level4 hasAnchor" number="13.4.3.1">
<h4><span class="header-section-number">13.4.3.1</span> Want more ways to run multi-subject simulations<a href="advanced-miscellaneous-topics.html#want-more-ways-to-run-multi-subject-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The version since the tutorial has even more ways to run multi-subject
simulations, including adding variability in sampling and dosing times
with <code>et()</code> (see <a href="https://nlmixr2.github.io/rxode2/articles/rxode2-events.html#add-doses-and-samples-within-a-sampling-window">rxode2
events</a>
for more information), ability to supply both an <code>omega</code> and <code>sigma</code>
matrix as well as adding as a <code>thetaMat</code> to R to simulate with
uncertainty in the <code>omega</code>, <code>sigma</code> and <code>theta</code> matrices; see <a href="https://nlmixr2.github.io/rxode2/articles/rxode2-sim-var.html">rxode2
simulation
vignette</a>.</p>
</div>
</div>
</div>
<div id="integrating-rxode2-models-in-your-package" class="section level2 hasAnchor" number="13.5">
<h2><span class="header-section-number">13.5</span> Integrating rxode2 models in your package<a href="advanced-miscellaneous-topics.html#integrating-rxode2-models-in-your-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="using-pre-compiled-models-in-your-packages" class="section level3 hasAnchor" number="13.5.1">
<h3><span class="header-section-number">13.5.1</span> Using Pre-compiled models in your packages<a href="advanced-miscellaneous-topics.html#using-pre-compiled-models-in-your-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you have a package and would like to include pre-compiled rxode2
models in your package it is easy to create the package. You simple
make the package with the <code>rxPkg()</code> command.</p>
<pre><code>library(rxode2);
#### Now Create a model
idr &lt;- rxode2({
    C2 = centr/V2;
    C3 = peri/V3;
    d/dt(depot) =-KA*depot;
    d/dt(centr) = KA*depot - CL*C2 - Q*C2 + Q*C3;
    d/dt(peri)  =                    Q*C2 - Q*C3;
    d/dt(eff)  = Kin - Kout*(1-C2/(EC50+C2))*eff;
})

#### You can specify as many models as you want to add

rxPkg(idr, package=&quot;myPackage&quot;); ## Add the idr model to your package</code></pre>
<p>This will:</p>
<ul>
<li><p>Add the model to your package; You can use the package data as <code>idr</code> once the package loads</p></li>
<li><p>Add the right package requirements to the DESCRIPTION file. You
will want to update this to describe the package and modify authors,
license etc.</p></li>
<li><p>Create skeleton model documentation files you can add to for your
package documentation. In this case it would be the file
<code>idr-doc.R</code> in your <code>R</code> directory</p></li>
<li><p>Create a <code>configure</code> and <code>configure.win</code> script that removes and
regenerates the <code>src</code> directory based on whatever version of <code>rxode2</code>
this is compiled against. This should be modified if you plan to
have your own compiled code, though this is not suggested.</p></li>
<li><p>You can write your own R code in your package that interacts with
the rxode2 object so you can distribute shiny apps and similar things
in the package context.</p></li>
</ul>
<p>Once this is present you can add more models to your package by
<code>rxUse()</code>. Simply compile the rxode2 model in your package then add
the model with <code>rxUse()</code></p>
<pre><code>rxUse(model)</code></pre>
<p>Now both <code>model</code> and <code>idr</code> are in the model library. This will also
create <code>model-doc.R</code> in your R directory so you can document this
model.</p>
<p>You can then use <code>devtools</code> methods to install/test your model</p>
<pre><code>devtools::load_all() # Load all the functions in the package
devtools::document() # Create package documentation
devtools::install() # Install package
devtools::check() # Check the package
devtools::build() # build the package so you can submit it to places like CRAN</code></pre>
</div>
<div id="using-models-in-a-already-present-package" class="section level3 hasAnchor" number="13.5.2">
<h3><span class="header-section-number">13.5.2</span> Using Models in a already present package<a href="advanced-miscellaneous-topics.html#using-models-in-a-already-present-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To illustrate, lets start with a
blank package</p>
<pre><code>library(rxode2)
library(usethis)
pkgPath  &lt;- file.path(rxTempDir(),&quot;MyRxModel&quot;)
create_package(pkgPath);
use_gpl3_license(&quot;Matt&quot;)
use_package(&quot;rxode2&quot;, &quot;LinkingTo&quot;)
use_package(&quot;rxode2&quot;, &quot;Depends&quot;) ##  library(rxode2) on load; Can use imports instead.
use_roxygen_md()
##use_readme_md()
library(rxode2);
#### Now Create a model
idr &lt;- rxode2({
    C2 = centr/V2;
    C3 = peri/V3;
    d/dt(depot) =-KA*depot;
    d/dt(centr) = KA*depot - CL*C2 - Q*C2 + Q*C3;
    d/dt(peri)  =                    Q*C2 - Q*C3;
    d/dt(eff)  = Kin - Kout*(1-C2/(EC50+C2))*eff;
});

rxUse(idr); ## Add the idr model to your package
rxUse(); # Update the compiled rxode2 sources for all of your packages
</code></pre>
<p>The <code>rxUse()</code> will:
- Create <code>rxode2</code> sources and move them into the package’s <code>src/</code>
directory. If there is only R source in the package, it will also
finish off the directory with an <code>library-init.c</code> which registers
all the rxode2 models in the package for use in R.
- Create stub R documentation for each of the models your are
including in your package. You will be able to see the R
documentation when loading your package by the standard <code>?</code> interface.</p>
<p>You will still need to:
- Export at least one function. If you do not have a function that
you wish to export, you can add a re-export of <code>rxode2</code> using roxygen
as follows:</p>
<pre><code>##&#39; @importFrom rxode2 rxode2
##&#39; @export
rxode2::rxode2</code></pre>
<p>If you want to use <code>Suggests</code> instead of <code>Depends</code> in your package,
you way want to export all of rxode2’s normal routines</p>
<pre><code>##&#39; @importFrom rxode2 rxode2
##&#39; @export
rxode2::rxode2

##&#39; @importFrom rxode2 et
##&#39; @export
rxode2::et

##&#39; @importFrom rxode2 etRep
##&#39; @export
rxode2::etRep

##&#39; @importFrom rxode2 etSeq
##&#39; @export
rxode2::etSeq

##&#39; @importFrom rxode2 as.et
##&#39; @export
rxode2::as.et

##&#39; @importFrom rxode2 eventTable
##&#39; @export
rxode2::eventTable

##&#39; @importFrom rxode2 add.dosing
##&#39; @export
rxode2::add.dosing

##&#39; @importFrom rxode2 add.sampling
##&#39; @export
rxode2::add.sampling

##&#39; @importFrom rxode2 rxSolve
##&#39; @export
rxode2::rxSolve

##&#39; @importFrom rxode2 rxControl
##&#39; @export
rxode2::rxControl

##&#39; @importFrom rxode2 rxClean
##&#39; @export
rxode2::rxClean

##&#39; @importFrom rxode2 rxUse
##&#39; @export
rxode2::rxUse

##&#39; @importFrom rxode2 rxShiny
##&#39; @export
rxode2::rxShiny

##&#39; @importFrom rxode2 genShinyApp.template
##&#39; @export
rxode2::genShinyApp.template

##&#39; @importFrom rxode2 cvPost
##&#39; @export
rxode2::cvPost

### This is actually from `magrittr` but allows less imports
##&#39; @importFrom rxode2 %&gt;%
##&#39; @export
rxode2::`%&gt;%`</code></pre>
<ul>
<li>You also need to instruct R to load the model library models
included in the model’s dll. This is done by:</li>
</ul>
<pre><code>### In this case `rxModels` is the package name
##&#39; @useDynLib rxModels, .registration=TRUE</code></pre>
<p>If this is a R package with rxode2 models and you do not intend to add
any other compiled sources (recommended), you can add the following configure scripts</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb339-1"><a href="advanced-miscellaneous-topics.html#cb339-1" aria-hidden="true"></a><span class="co">#!/bin/sh</span></span>
<span id="cb339-2"><a href="advanced-miscellaneous-topics.html#cb339-2" aria-hidden="true"></a><span class="co">### This should be used for both configure and configure.win</span></span>
<span id="cb339-3"><a href="advanced-miscellaneous-topics.html#cb339-3" aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;unlink(&#39;src&#39;, recursive=TRUE);rxode2::rxUse()&quot;</span> <span class="op">&gt;</span> build.R</span>
<span id="cb339-4"><a href="advanced-miscellaneous-topics.html#cb339-4" aria-hidden="true"></a><span class="va">${R_HOME}</span><span class="ex">/bin/Rscript</span> build.R</span>
<span id="cb339-5"><a href="advanced-miscellaneous-topics.html#cb339-5" aria-hidden="true"></a><span class="fu">rm</span> build.R</span></code></pre></div>
<p>Depending on the <code>check</code> you may need a dummy autoconf script,</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb340-1"><a href="advanced-miscellaneous-topics.html#cb340-1" aria-hidden="true"></a><span class="co">#### dummy autoconf script</span></span>
<span id="cb340-2"><a href="advanced-miscellaneous-topics.html#cb340-2" aria-hidden="true"></a><span class="co">#### It is saved to configure.ac</span></span></code></pre></div>
<p>If you want to integrate with other sources in your <code>Rcpp</code> or
<code>C</code>/<code>Fortan</code> based packages, you need to include <code>rxModels-compiled.h</code> and:
- Add the define macro <code>compiledModelCall</code> to the list of registered
<code>.Call</code> functions.
- Register C interface to allow model solving by
<code>R_init0_rxModels_rxode2_models()</code> (again <code>rxModels</code> would be
replaced by your package name).</p>
<p>Once this is complete, you can compile/document by the standard methods:</p>
<pre><code>devtools::load_all()
devtools::document()
devtools::install()</code></pre>
<p>If you load the package with a new version of rxode2, the models
will be recompiled when they are used.</p>
<p>However, if you want the models recompiled for the most recent version
of rxode2, you simply need to call <code>rxUse()</code> again in the project
directory followed by the standard methods for install/create a
package.</p>
<pre><code>devtools::load_all()
devtools::document()
devtools::install()</code></pre>
<p><strong>Note</strong> you do not have to include the <code>rxode2</code> code required to
generate the model to regenerate the rxode2 c-code in the <code>src</code>
directory. As with all rxode2 objects, a <code>summary</code> will show one way to recreate the same model.</p>
<p>An example of compiled models package can be found in the
<a href="https://github.com/nlmixr2/rxModels">rxModels</a> repository.</p>
</div>
</div>
<div id="stiff-odes-with-jacobian-specification" class="section level2 hasAnchor" number="13.6">
<h2><span class="header-section-number">13.6</span> Stiff ODEs with Jacobian Specification<a href="advanced-miscellaneous-topics.html#stiff-odes-with-jacobian-specification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="stiff-odes-with-jacobian-specification-1" class="section level4 hasAnchor" number="13.6.0.1">
<h4><span class="header-section-number">13.6.0.1</span> Stiff ODEs with Jacobian Specification<a href="advanced-miscellaneous-topics.html#stiff-odes-with-jacobian-specification-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Occasionally, you may come across
a
<a href="https://en.wikipedia.org/wiki/Stiff_equation"><strong>stiff</strong> differential equation</a>,
that is a differential equation that is numerically unstable and small
variations in parameters cause different solutions to the ODEs. One
way to tackle this is to choose a stiff-solver, or hybrid stiff solver
(like the default LSODA). Typically this is enough. However exact
Jacobian solutions may increase the stability of the ODE. (Note the
Jacobian is the derivative of the ODE specification with respect to
each variable). In rxode2 you can specify the Jacobian with the
<code>df(state)/dy(variable)=</code> statement. A classic ODE that has stiff
properties under various conditions is
the
<a href="http://www.ece.northwestern.edu/local-apps/matlabhelp/techdoc/math_anal/diffeq6.html">Van der Pol</a> differential
equations.</p>
<p>In rxode2 these can be specified by the following:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="advanced-miscellaneous-topics.html#cb343-1" aria-hidden="true"></a><span class="kw">library</span>(rxode2)</span>
<span id="cb343-2"><a href="advanced-miscellaneous-topics.html#cb343-2" aria-hidden="true"></a></span>
<span id="cb343-3"><a href="advanced-miscellaneous-topics.html#cb343-3" aria-hidden="true"></a>Vtpol2 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb343-4"><a href="advanced-miscellaneous-topics.html#cb343-4" aria-hidden="true"></a>  <span class="kw">ini</span>({</span>
<span id="cb343-5"><a href="advanced-miscellaneous-topics.html#cb343-5" aria-hidden="true"></a>    mu &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co">## nonstiff; 10 moderately stiff; 1000 stiff</span></span>
<span id="cb343-6"><a href="advanced-miscellaneous-topics.html#cb343-6" aria-hidden="true"></a>  })</span>
<span id="cb343-7"><a href="advanced-miscellaneous-topics.html#cb343-7" aria-hidden="true"></a>  <span class="kw">model</span>({</span>
<span id="cb343-8"><a href="advanced-miscellaneous-topics.html#cb343-8" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(y)       &lt;-<span class="st"> </span>dy</span>
<span id="cb343-9"><a href="advanced-miscellaneous-topics.html#cb343-9" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(dy)      &lt;-<span class="st"> </span>mu<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>y<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>dy <span class="op">-</span><span class="st"> </span>y</span>
<span id="cb343-10"><a href="advanced-miscellaneous-topics.html#cb343-10" aria-hidden="true"></a><span class="co">##### Jacobian</span></span>
<span id="cb343-11"><a href="advanced-miscellaneous-topics.html#cb343-11" aria-hidden="true"></a>    <span class="kw">df</span>(y)<span class="op">/</span><span class="kw">dy</span>(dy)  &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb343-12"><a href="advanced-miscellaneous-topics.html#cb343-12" aria-hidden="true"></a>    <span class="kw">df</span>(dy)<span class="op">/</span><span class="kw">dy</span>(y)  &lt;-<span class="st"> </span><span class="dv">-2</span><span class="op">*</span>dy<span class="op">*</span>mu<span class="op">*</span>y <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb343-13"><a href="advanced-miscellaneous-topics.html#cb343-13" aria-hidden="true"></a>    <span class="kw">df</span>(dy)<span class="op">/</span><span class="kw">dy</span>(dy) &lt;-<span class="st"> </span>mu<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>y<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb343-14"><a href="advanced-miscellaneous-topics.html#cb343-14" aria-hidden="true"></a><span class="co">##### Initial conditions</span></span>
<span id="cb343-15"><a href="advanced-miscellaneous-topics.html#cb343-15" aria-hidden="true"></a>    <span class="kw">y</span>(<span class="dv">0</span>)          &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb343-16"><a href="advanced-miscellaneous-topics.html#cb343-16" aria-hidden="true"></a>    <span class="kw">dy</span>(<span class="dv">0</span>)         &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb343-17"><a href="advanced-miscellaneous-topics.html#cb343-17" aria-hidden="true"></a>  })</span>
<span id="cb343-18"><a href="advanced-miscellaneous-topics.html#cb343-18" aria-hidden="true"></a>}</span>
<span id="cb343-19"><a href="advanced-miscellaneous-topics.html#cb343-19" aria-hidden="true"></a></span>
<span id="cb343-20"><a href="advanced-miscellaneous-topics.html#cb343-20" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out=</span><span class="dv">200</span>) <span class="op">%&gt;%</span></span>
<span id="cb343-21"><a href="advanced-miscellaneous-topics.html#cb343-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">0</span>)</span>
<span id="cb343-22"><a href="advanced-miscellaneous-topics.html#cb343-22" aria-hidden="true"></a></span>
<span id="cb343-23"><a href="advanced-miscellaneous-topics.html#cb343-23" aria-hidden="true"></a>s1 &lt;-<span class="st"> </span>Vtpol2 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">solve</span>(et, <span class="dt">method=</span><span class="st">&quot;lsoda&quot;</span>)</span>
<span id="cb343-24"><a href="advanced-miscellaneous-topics.html#cb343-24" aria-hidden="true"></a><span class="kw">print</span>(s1)</span>
<span id="cb343-25"><a href="advanced-miscellaneous-topics.html#cb343-25" aria-hidden="true"></a><span class="co">#&gt; -- Solved rxode2 object --</span></span>
<span id="cb343-26"><a href="advanced-miscellaneous-topics.html#cb343-26" aria-hidden="true"></a><span class="co">#&gt; -- Parameters ($params): --</span></span>
<span id="cb343-27"><a href="advanced-miscellaneous-topics.html#cb343-27" aria-hidden="true"></a><span class="co">#&gt; mu </span></span>
<span id="cb343-28"><a href="advanced-miscellaneous-topics.html#cb343-28" aria-hidden="true"></a><span class="co">#&gt;  1 </span></span>
<span id="cb343-29"><a href="advanced-miscellaneous-topics.html#cb343-29" aria-hidden="true"></a><span class="co">#&gt; -- Initial Conditions ($inits): --</span></span>
<span id="cb343-30"><a href="advanced-miscellaneous-topics.html#cb343-30" aria-hidden="true"></a><span class="co">#&gt;  y dy </span></span>
<span id="cb343-31"><a href="advanced-miscellaneous-topics.html#cb343-31" aria-hidden="true"></a><span class="co">#&gt;  2  0 </span></span>
<span id="cb343-32"><a href="advanced-miscellaneous-topics.html#cb343-32" aria-hidden="true"></a><span class="co">#&gt; -- First part of data (object): --</span></span>
<span id="cb343-33"><a href="advanced-miscellaneous-topics.html#cb343-33" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 200 x 3</span></span>
<span id="cb343-34"><a href="advanced-miscellaneous-topics.html#cb343-34" aria-hidden="true"></a><span class="co">#&gt;     time     y      dy</span></span>
<span id="cb343-35"><a href="advanced-miscellaneous-topics.html#cb343-35" aria-hidden="true"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb343-36"><a href="advanced-miscellaneous-topics.html#cb343-36" aria-hidden="true"></a><span class="co">#&gt; 1 0       2     0     </span></span>
<span id="cb343-37"><a href="advanced-miscellaneous-topics.html#cb343-37" aria-hidden="true"></a><span class="co">#&gt; 2 0.0503  2.00 -0.0933</span></span>
<span id="cb343-38"><a href="advanced-miscellaneous-topics.html#cb343-38" aria-hidden="true"></a><span class="co">#&gt; 3 0.101   1.99 -0.173 </span></span>
<span id="cb343-39"><a href="advanced-miscellaneous-topics.html#cb343-39" aria-hidden="true"></a><span class="co">#&gt; 4 0.151   1.98 -0.242 </span></span>
<span id="cb343-40"><a href="advanced-miscellaneous-topics.html#cb343-40" aria-hidden="true"></a><span class="co">#&gt; 5 0.201   1.97 -0.302 </span></span>
<span id="cb343-41"><a href="advanced-miscellaneous-topics.html#cb343-41" aria-hidden="true"></a><span class="co">#&gt; 6 0.251   1.95 -0.353 </span></span>
<span id="cb343-42"><a href="advanced-miscellaneous-topics.html#cb343-42" aria-hidden="true"></a><span class="co">#&gt; # i 194 more rows</span></span></code></pre></div>
<p>While this is not stiff at mu=1, mu=1000 is a stiff system</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="advanced-miscellaneous-topics.html#cb344-1" aria-hidden="true"></a>s2 &lt;-<span class="st"> </span>Vtpol2 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">solve</span>(<span class="kw">c</span>(<span class="dt">mu=</span><span class="dv">1000</span>), et)</span>
<span id="cb344-2"><a href="advanced-miscellaneous-topics.html#cb344-2" aria-hidden="true"></a><span class="kw">print</span>(s2)</span>
<span id="cb344-3"><a href="advanced-miscellaneous-topics.html#cb344-3" aria-hidden="true"></a><span class="co">#&gt; -- Solved rxode2 object --</span></span>
<span id="cb344-4"><a href="advanced-miscellaneous-topics.html#cb344-4" aria-hidden="true"></a><span class="co">#&gt; -- Parameters ($params): --</span></span>
<span id="cb344-5"><a href="advanced-miscellaneous-topics.html#cb344-5" aria-hidden="true"></a><span class="co">#&gt;   mu </span></span>
<span id="cb344-6"><a href="advanced-miscellaneous-topics.html#cb344-6" aria-hidden="true"></a><span class="co">#&gt; 1000 </span></span>
<span id="cb344-7"><a href="advanced-miscellaneous-topics.html#cb344-7" aria-hidden="true"></a><span class="co">#&gt; -- Initial Conditions ($inits): --</span></span>
<span id="cb344-8"><a href="advanced-miscellaneous-topics.html#cb344-8" aria-hidden="true"></a><span class="co">#&gt;  y dy </span></span>
<span id="cb344-9"><a href="advanced-miscellaneous-topics.html#cb344-9" aria-hidden="true"></a><span class="co">#&gt;  2  0 </span></span>
<span id="cb344-10"><a href="advanced-miscellaneous-topics.html#cb344-10" aria-hidden="true"></a><span class="co">#&gt; -- First part of data (object): --</span></span>
<span id="cb344-11"><a href="advanced-miscellaneous-topics.html#cb344-11" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 200 x 3</span></span>
<span id="cb344-12"><a href="advanced-miscellaneous-topics.html#cb344-12" aria-hidden="true"></a><span class="co">#&gt;     time     y        dy</span></span>
<span id="cb344-13"><a href="advanced-miscellaneous-topics.html#cb344-13" aria-hidden="true"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb344-14"><a href="advanced-miscellaneous-topics.html#cb344-14" aria-hidden="true"></a><span class="co">#&gt; 1 0       2     0       </span></span>
<span id="cb344-15"><a href="advanced-miscellaneous-topics.html#cb344-15" aria-hidden="true"></a><span class="co">#&gt; 2 0.0503  2.00 -0.000667</span></span>
<span id="cb344-16"><a href="advanced-miscellaneous-topics.html#cb344-16" aria-hidden="true"></a><span class="co">#&gt; 3 0.101   2.00 -0.000667</span></span>
<span id="cb344-17"><a href="advanced-miscellaneous-topics.html#cb344-17" aria-hidden="true"></a><span class="co">#&gt; 4 0.151   2.00 -0.000667</span></span>
<span id="cb344-18"><a href="advanced-miscellaneous-topics.html#cb344-18" aria-hidden="true"></a><span class="co">#&gt; 5 0.201   2.00 -0.000667</span></span>
<span id="cb344-19"><a href="advanced-miscellaneous-topics.html#cb344-19" aria-hidden="true"></a><span class="co">#&gt; 6 0.251   2.00 -0.000667</span></span>
<span id="cb344-20"><a href="advanced-miscellaneous-topics.html#cb344-20" aria-hidden="true"></a><span class="co">#&gt; # i 194 more rows</span></span></code></pre></div>
<p>While this is easy enough to do, it is a bit tedious. If you have
rxode2 setup appropriately, you can use the computer algebra system
sympy to calculate the Jacobian automatically.</p>
<p>This is done by the rxode2 option <code>calcJac</code> option:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="advanced-miscellaneous-topics.html#cb345-1" aria-hidden="true"></a>Vtpol &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb345-2"><a href="advanced-miscellaneous-topics.html#cb345-2" aria-hidden="true"></a>  <span class="kw">ini</span>({</span>
<span id="cb345-3"><a href="advanced-miscellaneous-topics.html#cb345-3" aria-hidden="true"></a>    mu &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co">## nonstiff; 10 moderately stiff; 1000 stiff</span></span>
<span id="cb345-4"><a href="advanced-miscellaneous-topics.html#cb345-4" aria-hidden="true"></a>  })</span>
<span id="cb345-5"><a href="advanced-miscellaneous-topics.html#cb345-5" aria-hidden="true"></a>  <span class="kw">model</span>({</span>
<span id="cb345-6"><a href="advanced-miscellaneous-topics.html#cb345-6" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(y)       &lt;-<span class="st"> </span>dy</span>
<span id="cb345-7"><a href="advanced-miscellaneous-topics.html#cb345-7" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(dy)      &lt;-<span class="st"> </span>mu<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>y<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>dy <span class="op">-</span><span class="st"> </span>y</span>
<span id="cb345-8"><a href="advanced-miscellaneous-topics.html#cb345-8" aria-hidden="true"></a>    <span class="kw">y</span>(<span class="dv">0</span>)          &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb345-9"><a href="advanced-miscellaneous-topics.html#cb345-9" aria-hidden="true"></a>    <span class="kw">dy</span>(<span class="dv">0</span>)         &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb345-10"><a href="advanced-miscellaneous-topics.html#cb345-10" aria-hidden="true"></a>  })</span>
<span id="cb345-11"><a href="advanced-miscellaneous-topics.html#cb345-11" aria-hidden="true"></a>}</span>
<span id="cb345-12"><a href="advanced-miscellaneous-topics.html#cb345-12" aria-hidden="true"></a></span>
<span id="cb345-13"><a href="advanced-miscellaneous-topics.html#cb345-13" aria-hidden="true"></a>Vtpol &lt;-<span class="st"> </span><span class="kw">Vtpol</span>()</span>
<span id="cb345-14"><a href="advanced-miscellaneous-topics.html#cb345-14" aria-hidden="true"></a></span>
<span id="cb345-15"><a href="advanced-miscellaneous-topics.html#cb345-15" aria-hidden="true"></a><span class="co">#### you can also use $symengineModelPrune if there is if/else blocks</span></span>
<span id="cb345-16"><a href="advanced-miscellaneous-topics.html#cb345-16" aria-hidden="true"></a><span class="co">#### that need to be converted:</span></span>
<span id="cb345-17"><a href="advanced-miscellaneous-topics.html#cb345-17" aria-hidden="true"></a>Vtpol &lt;-<span class="st"> </span><span class="kw">rxode2</span>(Vtpol<span class="op">$</span>symengineModelNoPrune,  <span class="dt">calcJac=</span><span class="ot">TRUE</span>)</span>
<span id="cb345-18"><a href="advanced-miscellaneous-topics.html#cb345-18" aria-hidden="true"></a><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span id="cb345-19"><a href="advanced-miscellaneous-topics.html#cb345-19" aria-hidden="true"></a></span>
<span id="cb345-20"><a href="advanced-miscellaneous-topics.html#cb345-20" aria-hidden="true"></a><span class="kw">summary</span>(Vtpol)</span>
<span id="cb345-21"><a href="advanced-miscellaneous-topics.html#cb345-21" aria-hidden="true"></a><span class="co">#&gt; rxode2 2.0.13.9000 model named rx_63a2e70a0dc6f6824bd7f0cc2c712813 model (ready). </span></span>
<span id="cb345-22"><a href="advanced-miscellaneous-topics.html#cb345-22" aria-hidden="true"></a><span class="co">#&gt; DLL: /tmp/RtmpbXPxP7/rxode2/rx_63a2e70a0dc6f6824bd7f0cc2c712813__.rxd/rx_63a2e70a0dc6f6824bd7f0cc2c712813_.so</span></span>
<span id="cb345-23"><a href="advanced-miscellaneous-topics.html#cb345-23" aria-hidden="true"></a><span class="co">#&gt; NULL</span></span>
<span id="cb345-24"><a href="advanced-miscellaneous-topics.html#cb345-24" aria-hidden="true"></a><span class="co">#&gt; -- rxode2 Model Syntax --</span></span>
<span id="cb345-25"><a href="advanced-miscellaneous-topics.html#cb345-25" aria-hidden="true"></a><span class="co">#&gt; rxode2({</span></span>
<span id="cb345-26"><a href="advanced-miscellaneous-topics.html#cb345-26" aria-hidden="true"></a><span class="co">#&gt;     cmt(y)</span></span>
<span id="cb345-27"><a href="advanced-miscellaneous-topics.html#cb345-27" aria-hidden="true"></a><span class="co">#&gt;     cmt(dy)</span></span>
<span id="cb345-28"><a href="advanced-miscellaneous-topics.html#cb345-28" aria-hidden="true"></a><span class="co">#&gt;     d/dt(y) = dy</span></span>
<span id="cb345-29"><a href="advanced-miscellaneous-topics.html#cb345-29" aria-hidden="true"></a><span class="co">#&gt;     d/dt(dy) = -y + mu * dy * (1 - Rx_pow_di(y, 2))</span></span>
<span id="cb345-30"><a href="advanced-miscellaneous-topics.html#cb345-30" aria-hidden="true"></a><span class="co">#&gt;     y(0) = 2</span></span>
<span id="cb345-31"><a href="advanced-miscellaneous-topics.html#cb345-31" aria-hidden="true"></a><span class="co">#&gt;     dy(0) = 0</span></span>
<span id="cb345-32"><a href="advanced-miscellaneous-topics.html#cb345-32" aria-hidden="true"></a><span class="co">#&gt;     df(y)/dy(y) = 0</span></span>
<span id="cb345-33"><a href="advanced-miscellaneous-topics.html#cb345-33" aria-hidden="true"></a><span class="co">#&gt;     df(dy)/dy(y) = -1 - 2 * y * mu * dy</span></span>
<span id="cb345-34"><a href="advanced-miscellaneous-topics.html#cb345-34" aria-hidden="true"></a><span class="co">#&gt;     df(y)/dy(dy) = 1</span></span>
<span id="cb345-35"><a href="advanced-miscellaneous-topics.html#cb345-35" aria-hidden="true"></a><span class="co">#&gt;     df(dy)/dy(dy) = mu * (1 - Rx_pow_di(y, 2))</span></span>
<span id="cb345-36"><a href="advanced-miscellaneous-topics.html#cb345-36" aria-hidden="true"></a><span class="co">#&gt;     df(y)/dy(mu) = 0</span></span>
<span id="cb345-37"><a href="advanced-miscellaneous-topics.html#cb345-37" aria-hidden="true"></a><span class="co">#&gt;     df(dy)/dy(mu) = dy * (1 - Rx_pow_di(y, 2))</span></span>
<span id="cb345-38"><a href="advanced-miscellaneous-topics.html#cb345-38" aria-hidden="true"></a><span class="co">#&gt; })</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="examples.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["rxode2-manual.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
